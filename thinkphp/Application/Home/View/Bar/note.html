<extend name="index" />
<block name="the_head">
<div class="bar_head">
    <div class="n_left">
        <img src="__UPLOAD__/<{$data[0]['bhpic']}>" alt="" width="100%" height="100%">
    </div>
    <div class="bar_head_center fl">
        <ul>
            <li class="lione fl"><b><{$data[0]['bname']}></b></li>
            <if condition="$atten eq 0">
            <li class="lione fl"><a href="<{:U('Bar/attentionBars',array('barid'=>$data[0]['bar_id']))}>" class="litwo"><span class="glyphicon glyphicon-plus"></span>关注</a></li>
            <else />
            <li class="lithree fl" style="color:orange;">已关注</li>
            </if>
            <li class="lithree fl">关注：<{$data[0]['attention']}></li>
            <li class="lithree fl">帖子：<{$count[0]['count']}></li>
        </ul>
    </div>
</div> <!--bar_head--> 
<div class="page">
    <ul>
        <li style="width:60px"><a href="">首页</a></li>
        <li style="width:60px"><a href="">上一页</a></li>
        <li><a href="">1</a></li>
        <li><a href="">2</a></li>
        <li><a href="">3</a></li>
        <li><a href="">4</a></li>
        <li style="width:60px"><a href="">下一页</a></li>
        <li style="width:60px"><a href="">尾页</a></li>
        <li style="width:160px;"><span style="font-size:10px;">跳到 </span><input type="text" style="width:30px;height:20px;"><a style="width:30px;height:20px;"> 确定</a></li>
    </ul>
</div>
</block>
<block name="main_head">

    <div class="note_title"><b><{$data[0]['title']}></b></div>
</block>
<block name="the_main">
    <!-- 一楼帖主楼 -->
    <div class="note_main">
        <div class="note_main_left">
            <div class="user_tx"><img src="__ROOT__/<{$data[0]['uhpic']}>" alt="heihei" width="100%" height="100%"></div>
            <div class="user_name"><{$data[0]['uname']}></div>
            <div class="user_grade">初入江湖</div>
        </div>
        <div class="note_main_main"><p><{$data[0]['content']}></p></div>
        <div class="note_main_right">
            <a href="javascript:;"><span style="float:right"> 回 复 &nbsp;&nbsp;</span></a>
            <span class="createtime"><{$data[0]['createtime']|date="Y-m-d H:i:s",###}></span>
            <span class="floor">1楼</span>
        </div>
    </div>
    
    <!-- 评论楼 -->
    <volist name="replys" id="reply">
        <div class="note_main">
            <div class="note_main_left">
                <div class="user_tx"><img src="__ROOT__/<{$reply['uhpic']}>" alt="heihei" width="100%" height="100%"></div>
                <div class="user_name"><{$reply['uname']}></div>
                <div class="user_grade">初入江湖</div>
            </div>
            <div class="note_main_main"><p><{$reply['content']}></p></div>
            <div class="note_main_right">
                <a href="javascript:;" class="huifu" style="width:60px;text-align:center;">查看回复</a>
                <span class="createtime"><{$reply['createtime']|date="Y-m-d H:i:s",###}></span>
                <span class="floor"><{$reply['floor']}>楼</span>
                <div class="reply" id="reply">
                    <br>
                    <!-- 评论区 -->
                    <div class="replytop">
                        <volist name="comments" id="comment">
                            <eq name="reply.floor" value="$comment.cfloor">
                            <li style="margin-left:30px;"><span><a href=""><{$comment['uname']}>：</a></span><{$comment['content']}><span style="float:right;margin-right:30px"><{$comment['createtime']|date="Y-m-d H:i",###}> <a  class="a-comment" href="javascript:;"  style="margin-left:30px;">回复</a></span></li>
                            </eq>
                        </volist>
                    </div>
                    <br>
                    <div class="replybottom">
                        <!-- <form method="post"> -->
                            <input type="text" style="margin-left:20px;width:580px" name="content" value="" placeholder=""></input><br>
                            <input type="hidden" name="floor" value="<{$reply['floor']}>">
                            <input type="hidden" name="note_id" value="<{$reply['note_id']}>">
                            <input class="btn btn-primary btn-reply" type="submit" value="发表">
                        <!-- </form> -->
                    </div>
                </div>
            </div>
        </div><!--note_main-->
    </volist>
    
</block>

<block name="myjs">
    <script>
        $(function(){
            $(document).on('click','.huifu',function(){
                    if($(this).text()=='收起回复'){
                        $(this).text('查看回复');
                        $(this).css('background','white');
                    }else{
                        $(this).text('收起回复');
                        $(this).css('background','#F7F8FA');
                    }
                    $(this).siblings('div').fadeToggle('slow');
            });

            $(document).on('click','.btn-reply',function(){
                    if("<{$Think.session.user}>"==''){
                        alert('请登录');
                        window.location.href="<{:U('Login/login')}>";

                        // var height=$(document).height();
                        // var width=$(document).width();
                        // $('#poplogin-layout').css({'height':height,'width':width,'display':'block',position:'fixed',top:'0px',left:'0px'});
                     
                        // return false;
                    }
                    var placeholder = $(this).parent().children(":first").attr("placeholder");
                    var content = $(this).parent().children(":first").val();
                    var userid = <{$Think.session.user.id}>;
                    var noteid = $(this).prev().attr('value');
                    var floor = $(this).prev().prev().attr('value');
                    // var time = time();
                    // console.log(content);
                    // console.log(userid);
                    // console.log(noteid);
                    // console.log(floor);
                    // console.log(time);

                    if(content==''){
                        return false;
                    }
                    var contents = placeholder+content;
                    var handle = $(this);

                    $.ajax({
                        type:'post',
                        url:"<{:U('Bar/doComment')}>",
                        data:"content="+contents+"&user_id="+userid+"&note_id="+noteid+"&floor="+floor,
                        // data:"bar_id="+<{$data[0].bid}>+"&content="+content+"&bar_as_id="+bsid+"&reception="+recid,
                        success:function(results){
                            // console.log(results);
                            handle.parent().prev().prev().children("li:last").after('<li style="margin-left:30px;"><span><a href=""><{$Think.session.user.name}>：</a></span>'+contents+'<span style="float:right;margin-right:30px">刚刚发布 <a  class="a-comment" href="javascript:;"  style="margin-left:30px;">回复</a></span></li>');
                            // console.log()
                            handle.parent().children(":first").val("");
                            handle.parent().children(":first").attr("placeholder","");
                        },
                        error:function(results){
                            // console.log(results);
                            alert("回复失败！！！");
                        }
                    });

                    return false;
            });

            // console.log($('.a-comment'));
            $(document).on('click','.a-comment',function(){
                    // alert('111');.prev().children().val()

                    var placeholder = $(this).parent().prev().children().html();
                    // console.log(placeholder);

                    var con = $(this).parent().parent().parent().next().next().children("input:first");
                    // console.log(con);

                    // alert(placeholder);
                    con.attr('placeholder','回复'+placeholder);
                    con.focus();
            });

        });
    </script>
</block>
