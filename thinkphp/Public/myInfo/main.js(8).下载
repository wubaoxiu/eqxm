define("picture/main",["require","jquery","etpl","common/js/Remoter","common/js/config","./picture.tpl"],function(require){function e(e){p.compile(m),f=h(e),f.html(p.render("picture-title")),d=h("#ibx-picture"),t(),n(),h(".ibx-picture-hotTop").trigger("click")}function t(){var e=h("#ibx-mod-picture");e.on("click",".ibx-inner-title-tabitem",function(){if(!h(this).hasClass("current")&&!_)if(_=!0,i(h("#ibx-mod-picture .ibx-inner-title-tabitem"),h(this)),d.html(p.render("loading")),h(this).hasClass("ibx-picture-my"))d.html(p.render("my-picture")),myPicBox=h("#my-picture"),v.remote().error(function(){M=null,myPicBox.html(p.render("loading-error")),_=!1}),b.remote().error(function(){k=null,myPicBox.html(p.render("loading-error")),_=!1});else y.remote().error(function(){r(),h("#hot-picture").html(p.render("loading-error")),_=!1})}),e.on("click",".hot-picture-tab-item",function(){if(!h(this).hasClass("current")){if(i(h(".hot-picture-tab-item"),h(this)),"图说天下"===h(this).data("id")){if(0==E.length)h("#hot-picture").html(p.render("loading")),x.remote().error(function(){h("#hot-picture").html(p.render("loading-error")),_=!1});else a(E);return}var e=T[h(this).data("id")],t=h("#hot-picture");if(t.html(p.render("loading")),u(),h.isEmptyObject(e))t.html(p.render("picture-empty"));else s(t,e,"","hot-list")}}),h("#ibx-mod-picture").on("click",".my-picture-tab-item",function(){if(!h(this).hasClass("current"))switch(i(h(".my-picture-tab-item"),h(this)),myPicBox.html(p.render("loading")),u(),+h(this).attr("data-id")){case 0:if(null===M)return void myPicBox.html(p.render("loading-error"));if(M[0])o(myPicBox,M[0].picture_list,M.url,"picture-list");else myPicBox.html(p.render("picture-empty"));break;case 1:if(null===k)return void myPicBox.html(p.render("loading-error"));if(k[0])o(myPicBox,k[0],k.url,"alb-list");else myPicBox.html(p.render("picture-empty"))}}),h("#ibx-mod-picture").on("mouseenter","#my-picture .ibx-picture-item,#hot-picture .ibx-picture-item",function(){h(this).addClass("onhover")}),h("#ibx-mod-picture").on("mouseleave","#hot-picture .ibx-picture-item, #my-picture .ibx-picture-item",function(){h(this).removeClass("onhover")}),h("#ibx-mod-picture").on("click",".ibx-card-pager-item",function(){var e=h(this).closest(".ibx-card-pager"),t=+h(this).attr("data-page");if(!h(this).hasClass("current"))e.find(".ibx-card-pager-item").removeClass("current"),h(this).addClass("current"),h(".ibx-picture-list").animate({left:-140*w.centerNum*t+"px"},1e3)}),h("#ibx-mod-picture").on("click",".ibx-card-pager-prev",function(){var e=h(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")-1;t>-1&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")}),h("#ibx-mod-picture").on("click",".ibx-card-pager-next",function(){var e=h(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")+1;t!==e.find(".ibx-card-pager-item").length&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")}),h(window).resize(function(){h(".ibx-picture-list").css("left","0"),w.boxWidth=Math.ceil(h(".my-picture:eq(0)").width()),w.centerNum=Math.floor((w.boxWidth+10)/140),w.dataLength&&l(w.dataLength)})}function i(e,t){e.removeClass("current"),t.addClass("current")}function n(){y.on("success",function(e){T={},S=[],h.each(e,function(e,t){if("errno"!==e&&"msg"!==e){var i=[];S.push(e),h.each(t,function(e,t){i.push({name:e,picMess:t})}),T[e]=i}}),r(),h(".hot-picture-tab-item").eq(0).trigger("click"),_=!1}),v.on("success",function(e){M=[],M=e,o(myPicBox,M[0].picture_list,M.url,"picture-list");var t=h(".my-picture-tab-mypic");if(e[0].picture_total)t.html("图片数（"+e[0].picture_total+"）");_=!1}),b.on("success",function(e){k=[],k=e;var t=h(".my-picture-tab-alb");if(e[0].length)t.html("专辑数（"+e[0].length+"）");_=!1}),x.on("success",function(e){E=[],E=e,a(E),_=!1}),y.on("fail",function(){h("#ibx-picture").html(p.render("loading-error")),_=!1}),x.on("fail",function(){h("#hot-picture").html(p.render("loading-error")),_=!1}),b.on("fail",function(){myPicBox.html(p.render("loading-error")),_=!1}),v.on("fail",function(){myPicBox.html(p.render("loading-error")),_=!1})}function r(){d.html(p.render("hot-picture",{list:S}))}function a(e){var t=h("#hot-picture");if(h.each(h(".hot-picture-tab-item"),function(){if("图说天下"==h(this).data("id"))h(this).addClass("current")}),h.isEmptyObject(e))t.html(p.render("picture-empty"));else s(t,e,"","hot-say-list")}function o(e,t,i,n){if(t.length)s(e,t,i,n);else e.html(p.render("picture-empty"))}function s(e,t,i,n){var r=h.extend(!0,[],t),a=r.length;w.boxWidth=Math.ceil(h(".my-picture:eq(0)").width()),w.centerNum=Math.floor((w.boxWidth+10)/140),w.dataLength=a,width=l(a),h.each(r,function(e,t){t.index=(e+101+"").substr(1),t.isfront=e>2?"":"front"}),e.html(p.render(n,{list:r,width:width,url:i}))}function l(e){var t=Math.ceil(e/w.centerNum);if(e)h("#ibx-picture .ibx-card-pager").html(p.render("picture-pager",{length:new Array(t)})),h(".ibx-picture-mask").toggleClass("hidden",1===t);return t*w.boxWidth}function u(){h(".ibx-picture-mask").addClass("hidden"),h("#ibx-picture .ibx-card-pager").html("")}function c(){f.empty()}var f,d,h=require("jquery"),p=require("etpl"),g=require("common/js/Remoter"),m=(require("common/js/config"),require("./picture.tpl")),y=new g("HOME_PICTURE_HOT"),v=new g("HOME_PICTURE_MY"),b=new g("HOME_PICTURE_ALB"),x=new g("HOME_PICTURE_SAY"),_=!1,w={},T={},E=[],S=[],M=[],k=[];return{render:e,dispose:c}}),define("picture",["picture/main"],function(e){return e});