define("tieba/tieba.tpl",[],function(){return'<!-- target: tieba-title --><div class="ibx-inner-title"><a data-click=\'{"act": "card_tieba_link"}\' target="_blank" href="http://tieba.baidu.com" class="ibx-inner-title-ctx">百度贴吧</a><ul class="ibx-inner-title-tab"><li data-click=\'{"act": "card_tieba_forum"}\' class="ibx-inner-title-tabitem ibx-my-tieba OP_LOG_TITLE">我的贴吧</li><li data-click=\'{"act": "card_tieba_frs"}\' class="ibx-inner-title-tabitem ibx-my-frs OP_LOG_TITLE">我的帖子</li><li data-click=\'{"act": "card_tieba_hot"}\' class="ibx-inner-title-tabitem ibx-tieba-top OP_LOG_TITLE">热门推荐</li></ul></div><div class="ibx-inner-content" id="ibx-tieba"><div class="ibx-loading"></div></div><!-- /target --><!-- ···························   贴吧empty   ····························· --><!-- target: tieba-empty --><div class="tieba-empty"><div class="tieba-empty-box"><span class="tieba-empty-detail"><div class="tieba-empty-tip">${tip}</div><!-- if: ${link} --><div class="tieba-empty-link"><a href="${url}" target="_blank">${link} &gt;</a></div><!-- /if --></span></div></div><!-- /target --><!-- ···························   贴吧pager   ····························· --><!-- target: tieba-pager --><div class="ibx-card-pager"><span class="ibx-card-pager-prev"></span><!-- for: ${length} as ${item}, ${index} --><!-- if: ${index} == 0 --><span class="ibx-card-pager-item current" data-page="${index}"></span><!-- else --><span class="ibx-card-pager-item" data-page="${index}"></span><!-- /if --><!-- /for --><span class="ibx-card-pager-next"></span></div><!-- /target --><!-- ···························   贴吧frs片段   ····························· --><!-- target: tieba-frs --><div class="tieba-frs"><ul class="tieba-frs-list tieba-pager-ul"><!-- for: ${list} as ${thread}, ${index} --><li class="tieba-frs-item"><div class="tieba-frs-ba"><img class="tieba-frs-baimg" src="${thread.forum_avatar}" width="60" height="60" /><!-- if: ${type} != \'mystore\'--><div class="tieba-frs-bname-bg"></div><a href="http://tieba.baidu.com/f?ie=utf-8&kw=${thread.forum_name}&fr=ibaidu" target="_blank" class="tieba-frs-bname" title="${thread.forum_name}吧">${thread.forum_name}吧</a><!-- /if --></div><div class="tieba-pb"><div class="tieba-pb-item"><a class="tieba-pb-title" href="http://tieba.baidu.com/p/${thread.thread_id}?fr=ibaidu" target="_blank" title="${thread.title}">${thread.title}</a><!-- if: ${type} != \'mystore\'--><span class="tieba-pb-reply" title="回复${thread.post_num}">${thread.post_num}</span><!-- /if --></div><div class="tieba-pb-item"><!-- if: ${type} == \'mystore\'--><a href="http://tieba.baidu.com/f?ie=utf-8&kw=${thread.forum_name}&fr=ibaidu" target="_blank" class="tieba-pb-item-bname" title="${thread.forum_name}吧">${thread.forum_name}吧</a><!-- else --><span class="tieba-pb-context" title="${thread.abstract}">${thread.abstract}</span><!-- /if --></div><div class="tieba-pb-item"><a href="http://tieba.baidu.com/home/main?un=${thread.user_name}&ie=utf-8&fr=ibaidu" target="_blank" class="tieba-pb-user" title="${thread.user_name}">${thread.user_name}</a><span class="tieba-pb-time">${thread.lastTimeInfo}</span></div></div></li><!-- /for --></ul></div><!-- /target --><!-- ···························   常逛吧片段   ····························· --><!-- target: my-tieba-clist --><ul class="my-tieba-clist tieba-pager-ul"><!-- for: ${list} as ${forum}, ${index} --><li class="my-tieba-citem"><a target="_blank" href="http://tieba.baidu.com/f?ie=utf-8&kw=${forum.forum_name}&fr=ibaidu" class="my-tieba-citem-box"><img class="my-tieba-bimg" src="${forum.forum_avatar}" width="55" height="50" /><div class="my-tieba-detail"><h2 class="my-tieba-bname" title="${forum.forum_name}吧">${forum.forum_name}吧</h2><!-- if: ${type} == \'myforum\' --><span class="my-tieba-rank rank-${forum.level_id}" title="${forum.level_name}"></span><!-- else --><span class="my-tieba-tag" title="${forum.tag_name}">${forum.tag_name}</span><span class="my-tieba-space"></span><span class="my-tieba-user" title="${forum.member_count}成员">${forum.member_count}</span><!-- /if --></div></a></li><!-- /for --></ul><!-- /target --><!-- ···························   我发表的片段   ····························· --><!-- target: my-frs-list --><div class="my-tieba-content"><ul class="my-frs-list tieba-pager-ul"><!-- for: ${list} as ${item}, ${index} --><li class="my-frs-item"><div class="my-frs-litem"><!-- if: ${item.is_thread} == \'1\' --><span class="my-frs-type my-frs-tiezi">贴子<span class="my-frs-type-trangle"></span></span><!-- else --><span class="my-frs-type my-frs-reply">回复<span class="my-frs-type-trangle"></span></span><!-- /if --><a class="my-frs-title" href="http://tieba.baidu.com/p/${item.thread_id}" target="_blank" title="${item.title}">${item.title}</a></div><div class="my-frs-litem"><span class="my-frs-content"><a class="my-frs-user" href="http://tieba.baidu.com/home/main?un=${item.user_name}&ie=utf-8&fr=ibaidu" target="_blank" title="${item.user_name}">${item.user_name}</a><!-- if: ${item.is_thread} == \'1\' -->发帖：${item.content}<!-- else -->回复：${item.content}<!-- /if --></span></div><div class="my-frs-litem"><span class="my-frs-from">来自：${item.forum_name}吧</span><span class="my-frs-time">${item.lastTimeInfo}</span></div></li><!-- /for --></ul></div><!-- /target --><!-- ···························   贴吧母版   ····························· --><!-- master: tieba --><div class="col my-tieba"><div class="span_4_2 "><div class="ibx-tieba-left"><div class="ibx-inner-card-title"><span class="ibx-inner-card-title-ctx"><!-- contentplaceholder: left-title--> <!-- /contentplaceholder--></span><span class="ibx-inner-card-title-border"></span></div><div class="ibx-tieba-center"><!-- contentplaceholder: left-content--> <!-- /contentplaceholder--></div></div></div><div class="span_4_2 ibx-tieba-list "><div class="ibx-inner-card-title"><span class="ibx-inner-card-title-ctx"><!-- contentplaceholder: right-title--> <!-- /contentplaceholder--></span><span class="ibx-inner-card-title-border"></span></div><div class="ibx-tieba-center"><!-- contentplaceholder: right-content--> <!-- /contentplaceholder--></div></div></div><!-- /master --><!-- ···························   我的贴吧   ····························· --><!-- target: my-tieba(master=tieba) --><!-- content: left-title -->常逛吧<!-- content: left-content --><!-- import: my-tieba-clist --><!-- content: right-title -->个性动态<!-- content: right-content --><!-- import: tieba-frs --><!-- /target --><!-- ···························   我的帖子   ····························· --><!-- target: my-frs(master=tieba) --><!-- content: left-title -->我发表的<!-- content: left-content --><!-- import: my-frs-list --><!-- content: right-title -->我收藏的<!-- content: right-content --><!-- import: tieba-frs --><!-- /target --><!-- ···························   热门推荐   ····························· --><!-- target: tieba-hot(master=tieba) --><!-- content: left-title -->热门贴吧<!-- content: left-content --><!-- import: my-tieba-clist --><!-- content: right-title -->热门帖子<!-- content: right-content --><!-- import: tieba-frs --><!-- /target -->'}),define("tieba/main",["require","jquery","etpl","moment","common/js/Remoter","common/js/config","./tieba.tpl"],function(require){function e(e){x.compile(E),h=b(e),h.html(x.render("tieba-title",{})),v=b("#ibx-tieba"),s(),l(),b(".ibx-my-tieba").trigger("click")}function t(e){var t=e.user_infos;A.myForum=t&&t.myfavoforum&&t.myfavoforum.forum}function i(e){var t=e.user_infos;if(t)A.myFeed=t&&t.myfeed&&t.myfeed.goodthreadfeed,A.hotForum=t&&t.hotfavoforum&&t.hotfavoforum.forum,A.hotFeed=t&&t.hotfeed&&t.hotfeed.goodthreadfeed}function n(e){A.myforumNum=Math.ceil(e.length/8),c("myforum","left","my-tieba-clist",A.myforumNum,{list:e,type:"myforum"})}function r(e){var t;if(!e)return void g.html(x.render("loading-error"));else return A.myfeedforum=e,A.mydynamicNum=Math.ceil(e.length/4),b.each(e,function(e,i){t=1e3*+i.last_modified_time,i.lastTimeInfo=_(t).format("M月D日 HH:mm")}),void c("myfeed","right","tieba-frs",A.mydynamicNum,{list:e})}function a(e){if(!e)return void p.html(x.render("loading-error"));else return A.hotforumNum=Math.ceil(e.length/8),void c(null,"left","my-tieba-clist",A.hotforumNum,{list:e,type:"hotforum"})}function o(e){if(!e)return void g.html(x.render("loading-error"));var t;A.mydynamicNum=Math.ceil(e.length/4),b.each(e,function(e,i){t=1e3*+i.last_modified_time,i.lastTimeInfo=_(t).format("M月D日 HH:mm")}),c(null,"right","tieba-frs",A.mydynamicNum,{list:e})}function s(){b("#ibx-mod-tieba").delegate(".ibx-inner-title-tabitem","click",function(){if(!b(this).hasClass("current"))if(b("#ibx-mod-tieba .ibx-inner-title-tabitem").removeClass("current"),b(this).addClass("current"),b(this).hasClass("ibx-my-tieba"))v.html(x.render("my-tieba")),u(function(){if(!A.myForum)M.remote().error(function(){p.html(x.render("loading-error"))});else n(A.myForum);if(!A.myFeed)S.remote().error(function(){g.html(x.render("loading-error"))});else r(A.myFeed)});else if(b(this).hasClass("ibx-my-frs"))v.html(x.render("my-frs")),u(function(){k.remote().error(function(){p.html(x.render("loading-error"))}),C.remote().error(function(){g.html(x.render("loading-error"))})});else v.html(x.render("tieba-hot")),u(function(){var e=!1;if(A.hotForum)a(A.hotForum);else e=!0;if(A.hotFeed)o(A.hotFeed);else e=!0;if(e)L.remote().error(function(){g.html(x.render("loading-error"))})})}),b("#ibx-mod-tieba").delegate(".ibx-card-pager-item","click",function(){var e=b(this).closest(".ibx-card-pager"),t=b(this).closest(".span_4_2").find(".tieba-pager-ul:eq(0)"),i=+b(this).attr("data-page");if(!b(this).hasClass("current"))e.find(".ibx-card-pager-item").removeClass("current"),b(this).addClass("current"),t.css("top",-320*i+"px")}),b("#ibx-mod-tieba").delegate(".ibx-card-pager-prev","click",function(){var e=b(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")-1;t>-1&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")}),b("#ibx-mod-tieba").delegate(".ibx-card-pager-next","click",function(){var e=b(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")+1;t!==e.find(".ibx-card-pager-item").length&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")})}function l(){function e(e){if(l[e]="1","11"==l.join(""))if(s)f(),s=!1}var s=!1;M.on("success",function(e){var t=e.user_infos&&e.user_infos.myfavoforum;if(t&&t.forum){if(n(t.forum),0===t.forum.length)s=!0}else s=!0,p.html(x.render("loading-error"))}),S.on("success",function(e){var t=e.user_infos&&e.user_infos.myfeed;if(t&&t.goodthreadfeed)r(t.goodthreadfeed);else g.html(x.render("tieba-empty",D.myfeed))}),k.on("success",function(e){var t,i=e.user_infos&&e.user_infos.mypost;if(i)A.mypostNum=Math.ceil(i.length/4),b.each(i,function(e,i){t=1e3*+i.create_time,i.lastTimeInfo=_(t).format("M月D日 HH:mm")}),c("mypost","left","my-frs-list",A.mypostNum,{list:i});else p.html(x.render("loading-error"))}),C.on("success",function(e){var t,i=e.user_infos&&e.user_infos.mystore;if(i&&i.replys)A.mypostNum=Math.ceil(i.replys.length/4),b.each(i.replys,function(e,i){if(t=1e3*+i.time,i.lastTimeInfo=_(t).format("M月D日 HH:mm"),i.user_name=i.lz_name,!i.forum_avatar)i.forum_avatar=T.URL.FE_ASSET+"/home/css/img/timg.jpeg"}),c("mystore","right","tieba-frs",A.mypostNum,{list:i.replys,type:"mystore"});else g.html(x.render("loading-error"))}),L.on("success",function(e){var t=e.user_infos,i=t&&t.hotfavoforum;if(i&&i.forum)a(i.forum);else p.html(x.render("loading-error"))}),L.on("success",function(e){var t=e.user_infos,i=t&&t.hotfeed;if(i&&i.forum)o(i.goodthreadfeed);else g.html(x.render("loading-error"))}),M.on("success",t),S.on("success",i),L.on("success",i);var l=[0,0];M.once("success",function(){e(0)}),S.once("success",function(){e(1)})}function u(e){p=b(".ibx-tieba-left .ibx-tieba-center"),g=b(".ibx-tieba-list .ibx-tieba-center"),m=b(".ibx-tieba-left .ibx-inner-card-title"),y=b(".ibx-tieba-list .ibx-inner-card-title"),p.html(x.render("loading")),g.html(x.render("loading")),e&&e()}function c(e,t,i,n,r){var a,o;if("left"===t)a=p,o=m;else a=g,o=y;if(n)a.html(x.render(i,r)),o.append(b(x.render("tieba-pager",{length:new Array(n)})));else a.html(x.render("tieba-empty",D[e]))}function f(){b("#ibx-mod-tieba").find(".ibx-tieba-top").trigger("click")}function d(){h.empty()}var h,p,g,m,y,v,b=require("jquery"),x=require("etpl"),_=require("moment"),w=require("common/js/Remoter"),T=require("common/js/config"),E=require("./tieba.tpl"),M=new w("HOME_TIEBA_FORUM"),S=new w("HOME_TIEBA_FRS"),k=new w("HOME_TIEBA_POST"),C=new w("HOME_TIEBA_STORE"),L=new w("HOME_TIEBA_FRS"),A={},D={myforum:{tip:"暂无常逛的吧",link:"快去贴吧关注更多“喜爱的吧”吧",url:"http://tieba.baidu.com"},myfeed:{tip:"个性动态为空",link:"快去贴吧关注更多“喜爱的吧”吧",url:"http://tieba.baidu.com"},mypost:{tip:"这个家伙很懒，还没发表过帖子"},mystore:{tip:"这个家伙很懒，还没发表过帖子"}};return{render:e,dispose:d}}),define("tieba",["tieba/main"],function(e){return e});