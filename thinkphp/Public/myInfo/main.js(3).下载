define("music/music.tpl",[],function(){return'<!-- target: music-title --><div class="ibx-inner-title"><a data-click=\'{"act": "card_music_link"}\' target="_blank" href="http://music.baidu.com" class="ibx-inner-title-ctx">百度音乐</a><ul class="ibx-inner-title-tab"><li data-click=\'{"act": "card_music_my"}\' class="ibx-inner-title-tabitem ibx-my-music OP_LOG_TITLE">我的音乐</li><li data-click=\'{"act": "card_music_hot"}\' class="ibx-inner-title-tabitem ibx-hot-music OP_LOG_TITLE">热门音乐</li></ul></div><div class="ibx-inner-content" id="ibx-music"><div class="ibx-music-player span_4_2" id="ibx-music-player"><div class="ibx-music-player-box"><div class="player-left"><div class="player-img-box"><img class="player-img" src="" width="90" height="90" /><div class="player-img-mask"></div><div class="player-img-tool player-tool"><span data-click=\'{"act": "card_music_play"}\' class="player-tool-play OP_LOG_TITLE" title="播放"></span><span data-click=\'{"act": "card_music_pause"}\' class="player-tool-pause OP_LOG_TITLE" title="暂停"></span></div></div></div><div class="player-body"><div class="player-title"></div><div class="player-detail"><div id="player-process" class="player-process"><div class="player-process-bar"></div></div><span class="player-time"></span></div><div class="player-tool"><span data-click=\'{"act": "card_music_play"}\' class="player-tool-play OP_LOG_TITLE" title="播放"></span><span data-click=\'{"act": "card_music_pause"}\' class="player-tool-pause OP_LOG_TITLE" title="暂停"></span><span data-click=\'{"act": "card_music_next"}\' id="player-tool-next" class="player-tool-next OP_LOG_TITLE" title="切歌"></span><a data-click=\'{"act": "card_music_download"}\' target="_blank" href="###" id="player-tool-download" class="player-tool-download" title="下载"></a></div><div class="player-lyric" id="player-lyric"><ul class="player-lyric-box" id="player-lyric-box"></ul></div></div><div class="player-logo"><span class="player-logo-img"></span></div></div></div><div class="ibx-music-list span_4_2" id="ibx-music-list"><div class="ibx-loading"></div></div></div><!-- /target --><!-- ···························   随心听歌曲详情   ····························· --><!-- target: song-info --><a target="_blank" href="http://music.baidu.com/song/${songId}?fr=ibaidu" class="player-song" data-id="${songId}" title="${songName}">${songName}</a><a target="_blank" href="http://music.baidu.com/artist/${artistId}?fr=ibaidu" class="player-artist" title="${artistName}">${artistName}</a><!-- /target --><!-- ···························   音乐empty   ····························· --><!-- target: music-empty --><div class="music-empty"><div class="music-empty-box"><span class="music-empty-detail"><div class="music-empty-tip">${tip}</div><!-- if: ${link} --><div class="music-empty-link"><a href="${url}" target="_blank">${link} &gt;</a></div><!-- /if --></span></div></div><!-- /target --><!-- ···························   音乐列表   ····························· --><!-- target: music-list --><ul class="ibx-music-list"><!-- for: ${list} as ${song}, ${index} --><li class="ibx-music-item"><a href="http://play.baidu.com/?__methodName=mboxCtrl.playSong&__argsValue=${song.songId}&fm=ibaidu&__o=ibaidu" target="_blank" title="${song.songName}" class="ibx-music-item-title">${song.songName}</a><a href="http://music.baidu.com/artist/${song.tingUid}" target="_blank" title="${song.artistName}" class="ibx-music-item-artist">- ${song.artistName}</a><a href="http://play.baidu.com/?__methodName=mboxCtrl.playSong&__argsValue=${song.songId}&fm=ibaidu&__o=ibaidu" target="_blank" title="播放" class="ibx-music-item-play"></a></li><!-- /for --></ul><!-- /target --><!-- ···························   热门音乐列表   ····························· --><!-- target: hot-music-list --><ul class="hot-music-box"><!-- for: ${list} as ${song}, ${index} --><li class="hot-music-item"><a href="http://play.baidu.com/?__methodName=mboxCtrl.playSong&__argsValue=${song.song_id}&fm=ibaidu&__o=ibaidu" target="_blank" title="${song.title}" class="ibx-music-item-title"><!-- if: ${song.indexNum} < 4 --><span class="hot-music-rank current">${song.indexNum}</span>${song.title}<!-- else --><span class="hot-music-rank">${song.indexNum}</span>${song.title}<!-- /if --></a><a href="http://music.baidu.com/artist/${song.ting_uid}" target="_blank" title="${song.author}" class="ibx-music-item-artist">- ${song.author}</a><a href="http://play.baidu.com/?__methodName=mboxCtrl.playSong&__argsValue=${song.song_id}&fm=ibaidu&__o=ibaidu" target="_blank" title="播放" class="ibx-music-item-play"></a></li><!-- /for --></ul><!-- /target --><!-- ···························   我的音乐   ····························· --><!-- target: my-music --><div class="my-music"><div class="span_4_2"><div class="ibx-inner-card-title"><span class="ibx-inner-card-title-ctx">最近听过</span><span class="ibx-inner-card-title-border"></span></div><div class="my-music-late"></div></div><div class="span_4_2"><div class="ibx-inner-card-title"><span class="ibx-inner-card-title-ctx">我收藏的</span><span class="ibx-inner-card-title-border"></span></div><div class="my-music-fav"></div></div></div><!-- ···························   热门推荐   ····························· --><!-- target: hot-music --><div class="hot-music"><div class="ibx-inner-card-title"><span class="ibx-inner-card-title-ctx">热门歌曲</span><span class="ibx-inner-card-title-border"></span></div><div class="hot-music-list"></div></div><!-- target: hot-music-box --><div class="span_4_2"><div class="hot-music-list-left"><!-- use: hot-music-list(list=${leftList}) --></div></div><div class="span_4_2"><div class="hot-music-list-right"><!-- use: hot-music-list(list=${rightList}) --></div></div>'}),define("music/lyric",["require","jquery"],function(require){function e(e){m=p("#"+e+"-box"),y=p("#"+e),n()}function t(){m.html("")}function i(){if(E)clearTimeout(E),E=null}function n(){var e=p(y),t=p(document);y.css({cursor:"pointer"}),e.on("mousedown",function(n){n.preventDefault();var r=e.scrollTop(),a=n.clientY,o=a;t.on("mousemove",function(t){i(),w=!0,o=a,a=t.clientY,r-=a-o,e.scrollTop(r)}),t.on("mouseup",function(){t.off("mousemove"),t.off("mouseup"),t.off("mousedown"),w=!1,i(),E=setTimeout(function(){T=!0,u()},400)})})}function r(e){var t=e.replace(/\n|\r/gim," "),i={},n=[],r=0,o=0,s="",l=0,u=0;if(b=!1,g=[],x.lastIndex=0,!x.test(t))for(var f=t.split(" "),d=(h.getDuration()-1e3)/f.length,u=0,p=f.length;p>u;u++)g.push({time:u*d+1e3,content:f[u]});else{for(;i=x.exec(t);){switch(n=i[1].split(":"),s=i[2],n[0]){case"al":case"ar":case"by":case"re":case"ti":case"ve":break;case"offset":r=parseInt(n[1])}if(/^\d+$/i.test(n[0])){if(o=1e3*(60*parseInt(i[1].substr(0,2))+parseFloat(i[1].substring(3)))-r," "===s)s="   ";if(g.push({time:o,content:s}),""!==s){for(u=g.length-1;u-->l;){if(""===g[u].content)g[u].content=s;if(g[u].time>o&&" "===g[u].content)g[u].content=s}l=g.length}else l=g.length-1}else;}g=g.sort(c)}a()}function a(){var e,t,i,n="";for(t=0,i=g.length;i>t;t++)n+='<li id="lyrics-li-'+t+'">'+g[t].content+"</li>";for(m.append(n),y.scrollTop(0),t=0,i=g.length;i>t;t++)e=p("#lyrics-li-"+t),g[t].top=e.position().top;b=b||""!==n}function o(){if(!b)a();u()}function s(e){if(0!==g.length)if(!(Math.abs(e-v)<500))v=e,u()}function l(e,i){if(h=e,"update"!==i)t()}function u(){if(!w){var e=d(v),t=-1;if(e!==_||T){if(i(),T=!1,t=_,_=e,f(_,t),e-=3,0>e)return void y.animate({scrollTop:0,scrollLeft:0},100);var n=g[e].top;y.animate({scrollTop:n,scrollLeft:0},400)}}}function c(e,t){if(e.time===t.time)return 0;else return e.time>t.time?1:-1}function f(e,t){p("#lyrics-li-"+t).removeClass("current"),p("#lyrics-li-"+e).addClass("current")}function d(e){for(var t=g.length;t--&&g[t].time>e;);return Math.min(Math.max(t,0),g.length-1)}var h,p=require("jquery"),g=[],m=p("#player-lyric-box"),y=p("#player-lyric"),v=0,b=!1,x=/\[(.*?)\](.*?)(?=(\[|$))/gim,_=0,w=!1,T=!1,E=null;return{render:e,load:r,reset:t,refresh:o,setPosition:s,setCurrentSong:l}}),define("home/music/lyric",["music/lyric"],function(e){return e}),define("music/player",["require","jquery","etpl","moment","muplayer","./lyric","common/js/config","common/js/global","common/js/Remoter"],function(require){function e(){t(),r(),d.render("player-lyric"),g.on("success",function(e){d.reset(),d.load(e)})}function t(){l.getJSON(h.URL.PLAYER_LIST,{id:"public_tuijian_suibiantingting"},function(e){y.songList=e.list||[],i()})}function i(){if(y.songList&&y.songList.length){for(var e,t=y.songList.length,i=[],r=0;10>r;r++){var a=Math.floor(Math.random()*t);if(e=y.songList[a],!(e.id in i))i.push(e.id);else r--}l.getJSON(h.URL.PLAYER_SONGS,{songIds:i.join(",")},function(e){if(22e3===+e.errorCode)y.songs=e.data.songList,n()})}else return!1}function n(){if(y.songs&&y.songs.length){var e=y.songs.shift();!s&&r(),a(e)}else i()}function r(){m.box=l("#ibx-music-player"),m.process=l("#player-process"),m.play=l(".player-tool-play"),m.pause=l(".player-tool-pause"),m.love=l("#player-tool-love"),m.delSong=l("#player-tool-del"),m.nextSong=l("#player-tool-next"),m.downloadSong=l("#player-tool-download"),s=new f({baseDir:"http://music.baidu.com/cms/app/muplayer/0_9_1/"}),m.play.click(function(){s.play()}),m.pause.click(function(){s.pause()}),m.nextSong.click(function(){o=1,n()}),s.on("timeupdate",function(){var e=s.curPos(),t=s.duration(),i=m.process.width(),n="-"+c(1e3*(t-e)).format("m:ss");l(".player-process-bar").width(i*e/t),l(".player-time").html(n),d.setPosition(1e3*e)}).on("player:reset",function(){l(".player-time").html("")}).on("ended",function(){if(o)o=0;else n()}).on("player:play",function(){l(".player-tool").addClass("playing")}).on("player:pause",function(){l(".player-tool").removeClass("playing")})}function a(e){var t=e.songPicBig||h.URL.FE_ASSET+"/welcome/css/img/music_default.png";if(m.box.find(".player-img").attr("src",t),m.box.find(".player-title").html(u.render("song-info",e)),m.downloadSong.attr("href","http://music.baidu.com/song/"+e.songId+"/download?fr=ibaidu"),d.reset(),g.remote({lrcLink:e.lrcLink}),y.first)s.playlist.reset(),s.add(e.songLink),l(".player-time").html(""),y.first=!1;else s.reset().add(e.songLink).play(),m.play.closest(".player-tool").addClass("playing")}var o,s,l=require("jquery"),u=require("etpl"),c=require("moment"),f=require("muplayer"),d=require("./lyric"),h=require("common/js/config"),p=(require("common/js/global"),require("common/js/Remoter")),g=new p("PLAYER_LYRIC"),m={},y={first:!0};return{render:e}}),define("home/music/player",["music/player"],function(e){return e}),define("music/main",["require","jquery","etpl","common/js/Remoter","./music.tpl","./player"],function(require){function e(e){u.compile(p),r=l(e),r.html(u.render("music-title")),a=l("#ibx-music-list"),g.render(),i(),t(),l(".ibx-my-music").trigger("click")}function t(){l("#ibx-mod-music").delegate(".ibx-inner-title-tabitem","click",function(){if(!l(this).hasClass("current"))if(l("#ibx-mod-music .ibx-inner-title-tabitem").removeClass("current"),l(this).addClass("current"),l(this).hasClass("ibx-my-music"))a.html(u.render("my-music")),o=l(".my-music-late"),s=l(".my-music-fav"),o.html(u.render("loading")),s.html(u.render("loading")),d.remote().error(function(){o.html(u.render("loading-error"))}),f.remote().error(function(){s.html(u.render("loading-error"))});else a.html(u.render("hot-music")),l(".hot-music-list").html(u.render("loading")),h.remote().error(function(){l(".hot-music-list").html(u.render("loading-error"))})})}function i(){d.on("success",function(e){if(e.list.length)o.html(u.render("music-list",{list:e.list.slice(0,6)}));else o.html(u.render("music-empty",{tip:"暂无最近听的音乐",link:"快来百度音乐，感受音乐世界的精彩",url:"http://music.baidu.com"}))}),f.on("success",function(e){if(e.list.length)s.html(u.render("music-list",{list:e.list.slice(0,6)}));else s.html(u.render("music-empty",{tip:"暂无收藏的音乐"}))}),h.on("success",function(e){if(e.list.length)l.each(e.list,function(e,t){t.indexNum=e+1}),l(".hot-music-list").html(u.render("hot-music-box",{leftList:e.list.slice(0,6),rightList:e.list.slice(6,12)}));else l(".hot-music-list").html(u.render("music-empty",{tip:"还没有内容喔~",link:"去听听音乐吧",url:"http://music.baidu.com"}))})}function n(){r.empty()}var r,a,o,s,l=require("jquery"),u=require("etpl"),c=require("common/js/Remoter"),f=new c("HOME_MUSIC_FAV"),d=new c("HOME_MUSIC_LATE"),h=new c("HOME_MUSIC_BILLORD"),p=require("./music.tpl"),g=require("./player");return{render:e,dispose:n}}),define("music",["music/main"],function(e){return e});