define("lvyou/main",["require","jquery","common/js/Remoter","etpl","./lvyou.tpl"],function(require){function e(e){h.compile(p),c(e).html(h.render("lvyou-title")),t()}function t(){c(".ibx-lvyou-mytrip").on("click",function(){f(c(this)),u(),g.remote()}),c(".ibx-lvyou-gowhere").on("click",function(){f(c(this)),u(),m.remote()}),c(".ibx-lvyou-guide").on("click",function(){f(c(this)),u(),y.remote()}),i(),c(".ibx-lvyou-gowhere").trigger("click"),l()}function i(){g.on("success",function(e){if(c(".ibx-lvyou-mytrip").hasClass("current"))c("#ibx-lvyou").html(h.render("lvyou-mytrip",e))}).on("fail",function(){c("#ibx-lvyou").html(h.render("loading-error"))}),m.on("success",function(e){if(c(".ibx-lvyou-gowhere").hasClass("current"))w=320,b=e,c("#ibx-lvyou").html(h.render("lvyou-gowhere",n())),c(".lvyou-gowhere-tab-item").on("click",function(){c(".lvyou-gowhere-tab-item").removeClass("current"),c(this).addClass("current");var e=c(this).attr("data-id");c("#lvyou-gowhere-main").html(h.render("lvyou-loading")),r(e)}),c(".lvyou-gowhere-tab-item").eq(0).trigger("click")}).on("fail",function(){c("#ibx-lvyou").html(h.render("loading-error"))}),y.on("success",function(e){if(c(".ibx-lvyou-guide").hasClass("current"))guideDataCache=e,w=230,c("#ibx-lvyou").html(h.render("lvyou-guide",a())),c(".lvyou-guide-tab-item").on("click",function(){c(".lvyou-guide-tab-item").removeClass("current"),c(this).addClass("current");var e=c(this).attr("data-id");c("#lvyou-guide-main").html(h.render("lvyou-loading")),o(e)}),c(".lvyou-guide-tab-item").eq(0).trigger("click")}).on("fail",function(){c("#ibx-lvyou").html(h.render("loading-error"))})}function n(){for(var e=[],t=0;t<x.length;t++)if(b[x[t].id])e.push(x[t]);return{list:e}}function r(e){var t=b[e];v.boxWidth=Math.ceil(c("#lvyou-gowhere-main").width()),v.centerNum=Math.floor((v.boxWidth+10)/320),v.dataLength=t.list.length||t.total;var i=s(v.dataLength);c.each(t.list,function(e,t){t.index=e+1}),c("#lvyou-gowhere-main").html(h.render("lvyou-gowhere-list",{width:i,list:t.list})),c(".lvyou-gowhere-detail").on("click",function(){c(this).parents("li").find(".lvyou-common-list-item-img-container")[0].click()})}function a(){for(var e=[],t=0;t<_.length;t++)if(guideDataCache[_[t].id])e.push(_[t]);return{list:e}}function o(e){var t=guideDataCache[e];v.boxWidth=Math.ceil(c("#lvyou-guide-main").width()),v.centerNum=Math.floor((v.boxWidth+10)/230),v.dataLength=t.list.length||t.total;var i=s(v.dataLength);c.each(t.list,function(e,t){if(+t.recommend_count>9999)t.recommend_count="9999+";if(+t.common_posts_count>9999)t.common_posts_count="9999+"}),c("#lvyou-guide-main").html(h.render("lvyou-guide-list",{width:i,list:t.list})),c(".lvyou-guide-detail").on("click",function(){c(this).parents("li").find(".lvyou-guide-container-img-container")[0].click()})}function s(e){var t=Math.ceil(e/v.centerNum);if(e)c("#ibx-lvyou .ibx-card-pager").html(h.render("lvyou-pager",{length:new Array(t)})),c(".ibx-lvyou-mask").toggleClass("hidden",1===t);return t*v.boxWidth}function l(){c("#ibx-mod-lvyou").on("click",".ibx-card-pager-item",function(){var e=c(this).closest(".ibx-card-pager"),t=+c(this).attr("data-page");if(!c(this).hasClass("current"))e.find(".ibx-card-pager-item").removeClass("current"),c(this).addClass("current"),c(".lvyou-common-list").animate({left:-w*v.centerNum*t+"px"},1e3)}),c("#ibx-mod-lvyou").on("click",".ibx-card-pager-prev",function(){var e=c(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")-1;t>-1&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")}),c("#ibx-mod-lvyou").on("click",".ibx-card-pager-next",function(){var e=c(this).closest(".ibx-card-pager"),t=+e.find(".ibx-card-pager-item.current").attr("data-page")+1;t!==e.find(".ibx-card-pager-item").length&&e.find(".ibx-card-pager-item:eq("+t+")").trigger("click")})}function u(){c("#ibx-lvyou").html(h.render("lvyou-loading"))}function f(e){c("#ibx-mod-lvyou .ibx-inner-title-tabitem").removeClass("current"),e.addClass("current")}var c=require("jquery"),d=require("common/js/Remoter"),h=require("etpl"),p=require("./lvyou.tpl"),g=new d("HOME_LVYOU_MYTRIP"),m=new d("HOME_LVYOU_GOWHERE"),y=new d("HOME_LVYOU_GUIDE"),v={},b={},x=[{id:"cur_season",name:"当季游"},{id:"in_china",name:"国内游"},{id:"out_china",name:"国外游"}],_={},_=[{id:"hot",name:"热门"},{id:"good",name:"精华优质"}],w=0;return c(window).resize(function(){c(".ibx-lvyou-list").css("left","0");var e=c("#lvyou-gowhere-main").width()||c("#lvyou-guide-main").width()||c("#ibx-lvyou").width();v.boxWidth=Math.ceil(e),v.centerNum=Math.floor((v.boxWidth+10)/w),v.dataLength&&s(v.dataLength)}),{render:e}}),define("lvyou",["lvyou/main"],function(e){return e});