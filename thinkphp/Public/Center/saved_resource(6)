_.Module.define({path:"props/component/PropsApi",requires:["common/component/JsPager"],sub:{initial:function(t){this.dataObj=t,this.initOptions(),this.bindEvents()},initOptions:function(){this.titleMap={"1070001_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070001_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070002_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D","1070002_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D"},this.urlMap={0:"/tbmall/getUserAppraise",1:"/tbmall/getPostAppraise"}},bindEvents:function(){var t=this,i=t.dataObj;$(".props_item_tail").live("click",function(){return t.propsData={props_id:$(this).data("propsid"),props_type:i.props_type},"0"==i.props_type&&(t.propsData.user_id=$(this).data("userid"),t.propsData.user_sex=$(this).data("usersex")),"1"==i.props_type&&(t.propsData.post_id=$(this).data("postid")),t.initPager=!0,t.showDialog(),!1})},getAttrsHtml:function(t){for(var i=null,s=[],a="",p=["user_id","user_sex","post_id","props_id"],e=0;e<p.length;e++)i=p[e],t[i]&&(a="data-"+i.replace(/_/,"")+'="'+t[i]+'"',s.push(a));return s.join(" ")},showUIHtml:function(t){for(var i=[],s=t.props||{},a=null,p=0,e=["1070001","1070002"],r=0;r<e.length;r++)t.props_id=e[r],a=s[e[r]],a&&(i.push('<li class="props_item_split"><span class="userinfo_split"></span></li>'),i.push('<li class="props_item props_item_'+e[r]+'">'),i.push('<a href="#" '+this.getAttrsHtml(t)+' class="props_item_tail">'),i.push('<span class="props_item_icon"></span>'),i.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),i.push('<span class="props_item_num">'+a.num+"</span></li>"),i.push("</a>"),p++);return 0>p?"":i.join("")},showUI:function(t){var i=this.showUIHtml(t);i&&t.wrap.html(i)},showDialog:function(){this.initDialogData(),this.initDialogUI(),this.showOrUpdateList()},initDialogData:function(){var t=this.propsData,i=t.props_id+"_"+t.props_type,s=this.titleMap[i];if(t.user_id!==PageData.user.id){var a=t.user_sex;s=s.replace(/\u6211/,a)}this.dialogTitle=s,this.dataurl=this.urlMap[t.props_type],this.pn=0,this.pageSize=10,this.pageCount=8},initDialogUI:function(){var t=this;this.$wrap=$('<div class="props_userlist_wrap"></div>'),this.$userlist=$('<div class="props_userlist_main"></div>'),this.$wrap.append(this.$userlist),this.dialog=new $.dialog({title:t.dialogTitle,width:554,height:340,show:!1,html:this.$wrap})},showOrUpdateList:function(){var t=this,i=t.propsData,s={props_id:i.props_id,look_user_id:i.user_id||"",post_id:i.post_id||"",pn:t.pn,c:t.pageSize};$.tb.get(t.dataurl,s,function(i){i&&0==i.no?(t.list=i.data.list,t.updateList(),t.initPager&&i.data.total>1&&(t.initPager=!1,t.total=Math.ceil(i.data.total/t.pageSize),t.buildPager()),t.dialog.show()):t.showErrorDialog()})},showErrorDialog:function(){new $.dialog({title:"\u63D0\u793A",width:300,height:50,html:'<p style="text-align:center;font-size:14px;line-height:40px;">\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5</p>'})},buildPager:function(){var t=$('<div class="props_userlist_pager"></div>');this.$wrap.append(t);var i=this,s=this.use("common/component/JsPager",{container:t,current:1,amount:i.pageCount,total:i.total});s.bind("pageChange",function(t,a){s.initial({current:a}),i.pn=a,i.showOrUpdateList()}),this.pager=s},updateList:function(){var t=this.list,i=[],s=null;i.push('<ul class="props_userlist">');for(var a=0;a<t.length;a++)s=t[a],i.push('<li class="userlist_item">'),i.push('<a class="userlist_head" href="/home/main?id='+s.portrait+'&fr=props" target="_blank"><img src="http://tb.himg.baidu.com/sys/portrait/item/'+s.portrait+'"/></a>'),i.push('<a class="userlist_name" href="/home/main?id='+s.portrait+'&fr=props" target="_blank">'+s.user_name+"</a>"),i.push('<p class="userlist_time">'+this.getShowtime(s.create_time)+"</p>"),i.push("</li>");i.push("</ul>"),this.$userlist.html(i.join(""))},getShowtime:function(t){t*=1e3;var i=new Date($.dateFormat(new Date(Env.server_time),"yyyy-MM-dd 00:00:00")).getTime();return t=t>i?$.dateFormat(new Date(t),"HH:mm"):$.dateFormat(new Date(t),"yyyy-MM-dd")}}});_.Module.define({path:"props/widget/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},s=null,n="",t=["1070002","1070001"],a=0;a<t.length;a++)if(s=e[t[a]],s&&s.num>0&&s.end_time>Env.server_time/1e3){n=this.options[t[a]];break}return n},showUI:function(i){var e=i.wrap,s="",n=null,t=i.key||this.getResidualKey(i);t&&(s="residual_wrap residual_wrap_"+t,n=e.find(".residual_wrap"),n[0]?n.removeClass().addClass(s):(n=$('<div class="'+s+'"></div>'),e.append(n)))}}});_.Module.define({path:"bawu/widget/complaintBarOwner",requires:["bawu/widget/complaintBarOwner/complaintBarOwnerTemplate"],sub:{isAddDialogTop:!1,initial:function(t){this.options=$.extend({uname:""},t),this.template=this.getInstance("bawu/widget/complaintBarOwner/complaintBarOwnerTemplate"),this.complaintWrapperTemplate=baidu.template(this.template.wrapper,this.options),this.complaintFailTemplate=this.template.fail,this.complaintSuccessTemplate=this.template.success,this.barItemTemplate=this.template.barItem,this.defaultFormData={manager_uid:"",manager_uname:"",forum_id:"",forum_name:"",complaint_type:"",reason:""},this.initDialog(),this._bindEvent()},initDialog:function(){if(this.$dialog)this.$dialog.setContent(this.complaintWrapperTemplate);else{this.$dialog=new $.dialog({html:this.complaintWrapperTemplate,title:"\u6295\u8BC9\u5427\u4E3B",show:!1,width:500,holderClassName:"complaint_bar_owner_dialog"});var t=this;this.$dialog.bind("onclose",function(e){return e.stopImmediatePropagation(),t.$dialog.hide(),!1});var e=this.$dialog.hide;this.$dialogElement=this.$dialog.element,this.$dialogElement.css("z-index",51e3),this.$dialog.hide=function(){t.isAddDialogTop&&(t.$dialogElement.css("top",parseInt(t.$dialogElement.css("top"),10)+70),t.isAddDialogTop=!1),e.call(t.$dialog)}}this.$submitBtn=this.$dialogElement.find(".submit_btn"),this.$barTypeList=this.$dialogElement.find(".j_bar_type"),this.$complaintReasonLayer=this.$dialogElement.find(".j_complaint_reason"),this.formData=$.extend({},this.defaultFormData)},_bindEvent:function(){var t=this,e=t.$dialogElement;e.on("blur",".j_bar_owner_id",function(e){var a=$(e.currentTarget),i=$.trim(a.val());t.checkBarOwnerName(i)}).on("keyup",".j_complaint_reason .textarea",function(e){var a=$(e.currentTarget);t.formData.reason=window.encodeURI($.trim(a.val())),t.checkCanSubmit()}).delegate(".radio","click",function(a){var i=$(a.currentTarget);"type"===i.tbattr("name")?(t.formData.forum_id=i.val(),t.formData.forum_name=window.encodeURI(i.data("name"))):(t.$complaintReasonLayer.show(),t.formData.complaint_type=i.val(),t.isAddDialogTop||(e.css("top",parseInt(e.css("top"),10)-70),t.isAddDialogTop=!0)),t.checkCanSubmit()}).delegate(".j_submit_btn","click",function(){if(t.checkCanSubmit()){var e=t.formData;$.post("/pmc/tousu/commitTousu",e,function(e){var a;a=0===e.errno?t.complaintSuccessTemplate:t.complaintFailTemplate,t.$resultDialog?t.$resultDialog.setContent(a):(t.$resultDialog=new $.dialog({html:a,title:"\u6295\u8BC9\u5427\u4E3B",show:!1,width:500}),t.$resultDialog.element.delegate(".j_back_btn","click",function(){t.$dialog.show(),t.$resultDialog.hide()}).delegate(".j_close_btn","click",function(){t.$dialog.hide(),t.$resultDialog.hide(),t.formData=$.extend({},this.defaultFormData)}).bind("onclose",function(e){return e.stopImmediatePropagation(),t.$resultDialog.hide(),!1})),202===e.errno&&t.$resultDialog.element.find(".j_error_remind").html("\u60A8\u5DF2\u7ECF\u6295\u8BC9\u8FC7\u8BE5\u5427\u4E3B"),t.$resultDialog.show(),t.$dialog.hide()},"json")}})},checkBarOwnerName:function(t){var e=this;return t?(t=window.encodeURI(t),$.get("/pmc/tousu/getRole",{manager_uname:t},function(a){var i=$.extend({},e.defaultFormData),o=a.data,n=a.errno;if(0===n)i={manager_uid:o.manager_uid,manager_uname:t},e.$barTypeList.html(baidu.template(e.barItemTemplate,o)),e.$dialogElement.removeClass("check_error"),1===o.roles.length&&(i.forum_id=o.roles[0].forum_id,i.forum_name=window.encodeURI($("<span>"+o.roles[0].forum_name+"</span>").text()));else{var l={207:"\u8BE5\u5427\u4E3B\u4E3A\u5B98\u65B9\u6307\u5B9A\u5427\u4E3B\uFF0C\u6709\u4E13\u95E8\u4EBA\u5458\u8FDB\u884C\u76D1\u7763\uFF0C\u76EE\u524D\u4E0D\u63A5\u53D7\u7528\u6237</br>\u6295\u8BC9\u54E6~",204:"\u6B64\u4EBA\u4E0D\u662F\u5427\u4E3B\u54E6~"},r=e.$dialogElement.find(".id_remind");e.$dialogElement.addClass("check_error"),l[n]&&r.html(l[n]),e.$barTypeList.html("")}i.tbs=a.tbs,$.extend(e.formData,i),e.checkCanSubmit()},"json"),void 0):(e.formData.manager_uname="",e.$barTypeList.html(""),e.checkCanSubmit(),void 0)},checkCanSubmit:function(){var t=this;for(var e in t.formData)if(t.formData.hasOwnProperty(e)){var a=t.formData[e];if(void 0!==a&&""===a)return t.$submitBtn.removeClass("j_submit_btn").addClass("disable"),!1}return t.$submitBtn.removeClass("disable").addClass("j_submit_btn"),!0},showDialog:function(){this.initDialog(),this.$dialog.show(),this.options&&this.options.uname&&this.checkBarOwnerName(this.options.uname)}}});_.Module.define({requires:["common/widget/LoginDialog","common/widget/payMember"],path:"common/widget/JoinVipDialog",sub:{objGet:function(i,e,o){o=void 0===o?null:o,e=e.split(".");var t,n=i;for(t in e){if(!("object"==typeof n&&e[t]in n))return o;n=n[e[t]]}return n},objSet:function(i,e,o){return i[e]=o,i},initial:function(){},getMemberDialog:function(i,e){var o=this;return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(i,e),!1):(o.requireInstance("common/widget/LoginDialog"),!1)},gotoCashier:function(i,e){var o=this.requireInstance("common/widget/payMember"),t=this.objSet({},"fr",i||"\u8D2D\u4E70\u4F1A\u5458");t=this.objSet(t,"scene_id",e||0),o.showCashier(t)}}});_.Module.define({path:"encourage/widget/forbid_speech",requires:["user/widget/userApi","common/widget/JoinVipDialog"],sub:{initial:function(e){e=e||{},this.userApi=this.requireInstance("user/widget/userApi"),this.isSuperMember=void 0===e.isSuperMember?this.userApi.checkSuperMemberShipOf($.getPageData("user")):e.isSuperMember,this.isAnnualMember=void 0===e.isAnnualMember?3===+$.getPageData("user.vipInfo.v_status",0):e.isAnnualMember,this.memberLevel=void 0===e.memberLevel?$.getPageData("user.vipInfo.v_level"):e.memberLevel,this.forbidTime=this.getForbidTime(),this.maxForbidUser=this.getMaxForbidUser()},getForbidTime:function(){var e=["24\u5C0F\u65F6","24\u5C0F\u65F6","72\u5C0F\u65F6","5\u5929","7\u5929","14\u5929"],i=new Date,t=new Date(i.getFullYear(),1,1),s=new Date(i.getFullYear()+1,1,1),a=(s-t)/864e5;return a=366,this.isAnnualMember?a+"\u5929":e[this.memberLevel]},getMaxForbidUser:function(){var e=[10,10,20,30,40,50];return(this.isAnnualMember?100:e[this.memberLevel])+"\u4E2A"},forbidSpeechConfirm:function(e,i,t){var s="",a=this,o=null;this.isSuperMember?(s='<div style="margin:15px auto 0;text-align:center;">#{forbidTime}\u5185\u7981\u6B62#{userName}\u56DE\u590D\u6211\u7684\u8D34\u5B50<div><div>\u786E\u5B9A\u7981\u8A00\uFF1F</div>',s=$.tb.format(s,{forbidTime:this.forbidTime,userName:'<a href="http://tieba.baidu.com/home/main?un='+e.authorName+'" target="_blank">'+e.authorName+"</a>"}),o=$.dialog.confirm(s,{showTitle:!1}),o.bind("onaccept",function(){a.forbidSpeech(e,i,t)})):(s='<div style="margin:15px auto 0;text-align:center;">\u7981\u6B62#{userName}\u56DE\u590D\u6211\u7684\u8D34\u5B50<div><div>\u7981\u8A00\u4E3A\u8D85\u7EA7\u4F1A\u5458\u529F\u80FD\uFF0C\u73B0\u5728\u53BB\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\uFF1F</div><div class="button-area-middle"><button class="btn-sub btn-middle btn-cancel">\u53D6\u6D88</button><button class="btn-encourage btn-middle"><i class="icon-vip2-16"></i>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</button></div>',s=$.tb.format(s,{userName:'<a href="http://tieba.baidu.com/home/main?un='+e.authorName+'" target="_blank">'+e.authorName+"</a>"}),o=$.dialog.open(s,{showTitle:!1,holderClassName:"forbid-speech-dialog"})),o.element.on("click",".btn-encourage",function(){var e="2000141",i=a.requireInstance("common/widget/JoinVipDialog",[]);i.getMemberDialog(e)}).on("click",".btn-cancel",function(){o.close()})},forbidSpeech:function(e,i,t){var s="/member/submit/mute/setUserMute",a=null,o={is_mute:1,user_name:e.authorName,post_id:e.postId,thread_id:e.threadId,tbs:$.getPageData("tbs")},r=this,n=$.ajax({type:"POST",url:s,data:o,dataType:"json"});n.success(function(e){if(0===e.no)a=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">\u7981\u8A00\u6210\u529F</div>',{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"}),$.isFunction(i)&&i();else if(220017===e.no)a=$.dialog.open('<div class="middle-text">\u6700\u591A\u53EF\u540C\u65F6\u7981\u8A00'+r.maxForbidUser+'\u7528\u6237</div><div class="button-area-middle"><button class="btn-default btn-middle btn-cancel">\u77E5\u9053\u4E86</button></div>',{showTitle:!1,holderClassName:"forbid-speech-dialog"}),$.isFunction(t)&&t();else{var s="\u7981\u8A00\u5931\u8D25";switch(e.no){case 952801:s="\u6B64\u7528\u6237\u4E0D\u53EF\u88AB\u5C4F\u853D";break;default:s="\u7981\u8A00\u5931\u8D25"}a=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">'+s+"</div>",{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"}),$.isFunction(t)&&t()}a.element.on("click",".btn-cancel",function(){a.close()})}),n.error(function(){a=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">\u7981\u8A00\u5931\u8D25</div>',{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"}),$.isFunction(t)&&t()})},cancelForbidSpeech:function(e,i,t){var s="/member/submit/mute/setUserMute",a={is_mute:0,user_name:e.authorName,post_id:e.postId,thread_id:e.threadId,tbs:$.getPageData("tbs")},o=null,r=$.ajax({type:"POST",url:s,data:a,dataType:"json"});r.success(function(e){0===e.no?(o=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">\u89E3\u7981\u6210\u529F</div>',{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"}),$.isFunction(i)&&i()):(o=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">\u89E3\u7981\u5931\u8D25</div>',{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"}),$.isFunction(t)&&t())}),r.error(function(){o=$.dialog.assert('<div class="forbid-speech-assert-dialog-content">\u89E3\u7981\u5931\u8D25</div>',{showTitle:!1,width:210,holderClassName:"forbid-speech-assert-dialog"})})}}});_.Module.define({path:"common/widget/payment_dialog_title",requires:["common/widget/base_user_data","user/widget/icons"],sub:{initial:function(e){var s=this,t={title:"",isNameShow:!1,isTdouShow:!1,isMemberShow:!1,onClose:$.noop};s.opts=$.extend(t,e),s.$container=e.$container,s.baseUserData=s.requireInstance("common/widget/base_user_data"),s.userIcon=s.requireInstance("user/widget/icons"),s.rendTitle(),s.bindEvents()},getMemberIcon:function(){var e=window.PageData.user,s=this.userIcon.getPreIconHtml($.getPageData("mParr_props",{},e),e,!0);return s},getIsMember:function(){var e=this.baseUserData.getMemberIcon().icon,s="";return("ordinary_member_icon"==$.trim(e)||"super_member_icon"==$.trim(e)||e.indexOf("vip1-18")>0||e.indexOf("vip2-18")>0)&&(s=" member-red "),s},getUserName:function(){var e=this.baseUserData.getUserName()||"";return{name:e,formateName:e.length>8?e.slice(0,8)+"...":e}},getUserTdou:function(){return this.baseUserData.getUserTdou()||0},getTreasureNum:function(){return this.baseUserData.getUserTreasure()||0},rendTitle:function(){var e=this,s=e.opts,t=_.template('<div class="payment-dialog-title">         <h4 class="payment-dialog-title-txt"><%=title%></h4>     <div class="payment-dialog-title-user">         <%if(isNameShow){%>         <div class="user-name">             \u5E10\u53F7\uFF1A<%=memberIcon%><span title="<%=userName[\'name\']%>" class="orange-txt <%=memberClass%>"><%=userName[\'formateName\']%></span>         </div>         <%}%>         <%if(isTdouShow){%>         <div class="user-tdou">             T\u8C46\u4F59\u989D\uFF1A<i class="icon-tbean"></i><span class="orange-txt"><%=userTdouNum%></span>         </div>         <%}%>         <%if(isMemberShow){%>         <div class="user-member">         </div>         <%}%>         <%if(isTreasureShow){%>         <div class="user-treasure">             \u593A\u5B9D\u5E01\uFF1A<span class="orange-txt"><%=userTreasureNum%></span>         </div>         <%}%>     </div>     <a href="javascript:;" class="payment-dialog-title-close j-payment-close"></a> </div>')({title:s.title||"",isNameShow:s.isNameShow,isTdouShow:s.isTdouShow,isMemberShow:s.isMemberShow,isTreasureShow:s.isTreasureShow,memberClass:e.getIsMember(),userName:e.getUserName(),userTdouNum:e.getUserTdou(),memberIcon:e.getMemberIcon(),userTreasureNum:e.getTreasureNum()});e.$container&&e.$container.html(t)},bindEvents:function(){var e=this;e.$container.on("click",".j-payment-close",function(){e.opts.onClose()})}}});_.Module.define({path:"common/widget/show_dialog",sub:{initial:function(t){var e=this;e.container=t.container,e.$container=e.container.element,e.type=t.type,e.top=parseInt(e.$container.css("top"),10),e.height=e.$container.outerHeight()},show:function(){var t=this,e="show";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},close:function(){var t=this,e="close";switch(t.type){case"top-pop":t.topPop(e);break;case"bigger":t.biggerShow(e);break;default:t.showDefault(e)}},getOriginSize:function(){var t=$(".dialogJ");if($.isEmptyObject(t))return{width:0,height:0};var e=t.eq(t.length-2);return{width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}},getEndSize:function(){return{width:this.$container.outerWidth(),height:this.$container.outerHeight(),top:this.$container.css("top"),left:this.$container.css("left")}},biggerShow:function(t){var e=this,i=e.getOriginSize(),o=e.getEndSize();"show"===t?(e.$container.css({width:i.width,height:i.height,top:i.top,left:i.left}),e.container.show(),e.$container.animate({width:o.width,height:o.height,top:o.top,left:o.left})):e.$container.animate({width:i.width,height:i.height,top:i.top,left:i.left},function(){e.container.close()})},topPop:function(t){var e=this;"show"===t?(e.$container.css({top:-(e.top+e.height)}),e.container.show(),e.$container.animate({top:e.top})):e.$container.animate({top:-(e.top+e.height)},function(){e.container.close()})},showDefault:function(t){var e=this;"show"===t?e.container.show():e.container.close()}}});_.Module.define({path:"common/widget/qianbaoPurchaseTdou",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,tryOptions:null,payOptions:null,initial:function(){var a=this;a.cashierDialog=a.requireInstance("common/widget/qianbaoCashierDialog"),a.baseData=a.requireInstance("common/widget/baseUserData"),a.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),a.cashierDialog.bind("event_tdou_qianbao_pay_again",a.payAgain,a)},payAgain:function(){var a=this;a._buy_icon_ajax&&a._buy_icon_ajax.abort(),a._buy_icon_ajax=$.ajax({type:"get",url:"/tbmall/getPayUrl",data:a.tryOptions,cache:!1,dataType:"json"}).success(function(i){var o=i.data;a.payOptions.qianbao_params=o.return_url,a.payOptions.iconCount=o.iconCount,a.payOptions.iconId=o.iconId,a.showDialog(a.payOptions,a.tryOptions)})},showDialog:function(a,i){var o=this;o.tryOptions=i,o.payOptions=a,o.product=a.product||"tdou";var s=a.iconId||"suiji",e=a.iconCount||1,n={};o.getIconInfo(function(i){var t=i.data;for(var c in t)t[c].iconId==s&&(n={iconId:s,iconCount:e,iconImg:t[c].picUrl,memeberTdou:parseInt(1.05*e*t[c].non_member_t),tdou:e*t[c].non_member_t,name:t[c].name,qianbao_params:a.qianbao_params},n.pay_tdou=2==o.baseData.getMemberLevel()?n.memeberTdou:n.tdou);o.showIcon(n)},o)},showIcon:function(a){var i=this,o=a.qianbao_params||"",s=$.extend(a,{baseDialogUserBarTpl:i.baseDialogUserBar.getUserBarTemplate(),isSuperMember:2==i.baseData.getMemberIcon().level?!0:!1}),e=_.template('<div class="qianbao_cashier_purchase_tdou ">     <%=baseDialogUserBarTpl%>     <div class="qianbao_cashier_goods">         <div class="order_info clearfix" style="display: block;">             <label class="title order_label">\u5546\u54C1\u8BA2\u5355\uFF1A</label>             <section class="order_desc clearfix">                 \u672C\u6B21\u83B7\u53D6<i class="icon-tbean"></i><span class="tdou_num"><%=pay_tdou%></span>\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210             </section>         </div>         <div class="goods_list">             <label class="title goods_title">\u8D2D\u4E70\u5546\u54C1\uFF1A</label>              <div class="icon_item">                 <div class="icon_desc">                     <%if(isSuperMember) {%>                         <p>\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span></p>                     <%} else {%>                         <p>\u975E\u8D85\u7EA7\u4F1A\u5458\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=tdou%></span></p>                     <%}%>                 </div>                 <div class="icon_img_box">                     <div class="icon_info" data-id="<%=iconId%>" data-price="1000" data-amount="110000">                         <img class="icon_img" src="<%=iconImg%>">                         <p class="tdou_text"><%=name%><span id="iconCount"><%=iconCount%></span>\u4E2A<span class="expire_date">\uFF08\u6709\u6548\u671F\uFF1A<span class="day"><%=iconCount%></span>\u5929\uFF09</span></p>                     </div>                 </div>             </div>             <%if(!isSuperMember) {%>                 <p class="super-member-tips"><i class="icon-crown-super-vip"></i>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\u52A0\u9001<span class="orange-txt">5%</span>\uFF0C\u83B7\u8D60<i class="icon-tbean"></i><span class="orange-txt"><%=memeberTdou%></span></p>             <%}%>         </div>     </div> </div> ')(s),n={qianbao_params:o,product:i.product};i.cashierDialog.showDialog(n,e,function(a){i.$root=a,i.bindEvents()})},bindEvents:function(){var a=this;a.$root.find(".j_header_close").on("click",function(){a.cashierDialog.closeDialog()})},getIconInfo:function(a,i){var o=this,s={ie:"utf-8"};s.tbs=PageData.tbs,o._get_icon_ajax&&o._get_icon_ajax.abort(),o._get_icon_ajax=$.ajax({type:"get",url:"/tbmall/gettdouiconinfo",data:s,cache:!1,dataType:"json"}).success(function(o){a.call(i,o)})}}});_.Module.define({path:"common/widget/tdou_get",requires:["common/widget/base_user_data","common/widget/payment_dialog_title","common/widget/show_dialog","common/widget/tdou/tdou_data","common/widget/qianbao_purchase_tdou"],sub:{tdouOptionsHeight:71,payChannel:2,URL:{getTdouIconInfo:"/tbmall/gettdouiconinfo"},iconInfoList:[],orderNum:0,iconId:"",initial:function(t){var e=this;e.opts=t,e.initDialog(),e.isPlus=window.PageData.user.id%2?!0:!1,e.baseUserData=e.requireInstance("common/widget/base_user_data"),e.dataProxy=e.requireInstance("common/widget/tdou/tdou_data",{scores:e.baseUserData.getUserTdou(),level:e.baseUserData.getMemberIcon().level}),e.getUserMember(),e.getTdouIconInfo(function(){e.renderContainer(),e.bindEvents(),e.defaultSelect(),e.clearLoading()})},defaultSelect:function(){this.$dialog.find(".tdou-options").eq(1).click(),this.$tdouSelectView.show(),this.orderNumCtrl("add")},getUserMember:function(){var t=this.baseUserData.getMemberIcon();this.isSuperMember=2==t.level?!0:!1},getTdouIconInfo:function(t){var e=this,i={tbs:window.PageData.tbs,ie:"utf-8"};$.get(e.URL.getTdouIconInfo,i,function(i){0==i.no?(e.formateIconData(i.data),t&&t()):e.errorTips("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u5019\u91CD\u8BD5")})},formateIconData:function(t){this.iconInfoList=[t.tbxiaotietie,t.ff14,t.tbzhangyu,t.tbxiaoxiong]},errorTips:function(t){console.log(t)},initDialog:function(){var t=this;$(".tdou-get-dialog").length&&$(".tdou-get-dialog").remove(),t.dialog=new $.dialog({html:_.template('<div class="tdou-get-dialog-container">     <section class="tdou-get-dialog-container-loading">         <img src="<%=url%>" class="loading-img">         <p>\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </section> </div>')({url:"http://tb2.bdstatic.com/tb/static-common/widget/tdou_get/images/icon-loading_f0da091.gif"}),show:!1,holderClassName:"tdou-get-dialog",escable:!1,showTitle:!1,height:500,width:620}),t.$dialog=t.dialog.element,t.dialogCtrl=t.requireInstance("common/widget/show_dialog",{container:t.dialog,type:"top-pop"}),t.dialogCtrl.show()},renderContainer:function(){var t=this,e=_.template('<section class="tdou-get-dialog-container-title"> </section> <section class="tdou-get-dialog-container-selection <%=isPlus%>">     <p class="tdou-get-dialog-container-selection-tips">\u83B7\u53D6T\u8C46\uFF0C\u9700\u8981\u8D2D\u4E70\u4EE5\u4E0B\u5370\u8BB0\u6765\u5B8C\u6210</p>     <ul class="tdou-selection-list">         <%              var top = -73;             var left = -142;             for(var i in list) {             var item = list[i];             top += 71;             left += 140;                          var tbmall_price = item[\'non_member_t\'] / 1000;             var given_tdou = item[\'non_member_t\'] * 0.05;         %>          <li class="tdou-options j-tdou-select" id="<%=item[\'iconId\']%>" data-top="<%=top%>" data-left="<%=left%>" data-icon={"num":"<%=item[\'non_member_t\']%>","price":"<%=tbmall_price%>"}>             <div class="price-div">                 <span class="price-name">                     <span class="price-title">\u4EF7\u683C:</span><span class="price"><%=tbmall_price%></span>\u5143                 </span>                              </div>             <div class="info-div">                 <div class="tdou-info">                     \u8D60\u9001<i class="icon-tbean"></i><span class="tdou-num orange-txt"><%=item[\'non_member_t\']%></span>                 </div>                 <div class="member-info">                     <i class="icon-crown-super-vip"></i>                     <p class="member-info-div j-get-member">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\u52A0\u9001<span class="orange-txt">5%</span></p>                     <span class="member-info-div"><i class="orange-txt"><%=given_tdou%></i>T\u8C46</span>                     <p class="member-info-div-plus j-get-member">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458<span class="orange-txt">+<%=given_tdou%></span></p>                 </div>             </div>             <div class="icon-div">                 <div class="icon-img">                     <img src="<%=item[\'picUrl\']%>" />                 </div>                 <div class="icon-txt">                     <p><%=item[\'name\']%></p>                     <p>\u6709\u6548\u671F\uFF1A<%=item[\'duration\']%>\u5929</p>                 </div>             </div>         </li>         <%}%>         <li class="tdou-options-active">             <i class="icon-select"></i>         </li>     </ul> </section> <section class="tdou-get-dialog-container-order">     <div>         <span class="payment-txt">\u8D2D\u4E70\u6570\u91CF\uFF1A</span>         <div class="tdou-num-ctrl">             <a href="javascript:;" class="tdou-num min j-change-num" data-type="min">-</a><input class="tdou-num-input j-input-num" data-type="input" type="text" maxlength="6"/><a href="javascript:;" class="tdou-num add j-change-num" data-type="add">+</a>         </div>         <div class="cash-num-view">             \u9700\u652F\u4ED8\uFF1A<span class="cash-num-view-txt orange-txt">0</span>\u5143         </div>         <div class="tdou-num-view">             \u83B7\u8D60\uFF1A<span class="tdou-num-view-txt orange-txt">0</span>T\u8C46         </div>     </div> </section> <section class="tdou-get-dialog-container-btn">     <a href="javascript:;" class="payment-btn j-get-tdou">\u7ACB\u5373\u652F\u4ED8</a> </section> <section class="tdou-get-dialog-container-bottom">     \u63D0\u9192\uFF1A\u60A8\u5728PC\u4EE5\u53CA\u5B89\u5353\u624B\u673A\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0EIOS\u624B\u673A\u4E0A\u83B7\u53D6\u7684T\u8C46\u4E0D\u540C\u7528 </section>')({list:t.iconInfoList,isPlus:t.isPlus?"dialog-plus":""});t.$dialog.find(".tdou-get-dialog-container").append(e),t.$dialogTitle=t.$dialog.find(".tdou-get-dialog-container-title"),t.$tdouSelectView=t.$dialog.find(".tdou-options-active"),t.$cashView=t.$dialog.find(".cash-num-view-txt"),t.$tdouNumView=t.$dialog.find(".tdou-num-view-txt"),t.$orderInput=t.$dialog.find(".tdou-num-input"),t.$minOrderBtn=t.$dialog.find(".j-change-num").eq(0),t.$loadingView=t.$dialog.find(".tdou-get-dialog-container-loading"),t.$getTouBtn=t.$dialog.find(".j-get-tdou"),t.addTitle(),t.trackCtrl("view")},addTitle:function(){var t=this,e={$container:t.$dialogTitle,title:"\u83B7\u53D6T\u8C46",isNameShow:!0,isTdouShow:!0,onClose:function(){t.dialogCtrl.close()}};t.requireInstance("common/widget/payment_dialog_title",e)},changeTdouOptions:function(t){var e=t.tbattr("id"),i=Number(t.data("top")),o=Number(t.data("left")),a=this.$tdouSelectView;this.iconData=t.data("icon"),this.isPlus?a.animate({left:o},"fast","swing"):a.animate({top:i},"fast","swing"),this.iconId=e,this.orderViewUpdate()},orderNumCtrl:function(t){var e=this,i=e.orderNum;"add"===t?e.$orderInput.val(++i):e.$orderInput.val(--i),1==i?e.$minOrderBtn.addClass("disabled"):e.$minOrderBtn.removeClass("disabled"),e.orderNum=i,e.orderViewUpdate()},orderInputNumCtrl:function(t){var e=this,i=t.val(),o=parseInt(i,10)||0;""===i?(e.orderNum=0,e.$minOrderBtn.addClass("disabled")):0===o?(e.orderNum=0,e.$minOrderBtn.addClass("disabled"),e.$orderInput.val("")):(1!==o&&e.$minOrderBtn.removeClass("disabled"),i!=o?(e.orderNum=o,e.$orderInput.val(o)):e.orderNum=o),e.orderViewUpdate()},orderViewUpdate:function(){var t=this;if(t.orderNum&&t.iconId){var e=t.iconData,i=t.orderNum,o=Number(e.price)*i,a=Number(e.num)*i;t.isSuperMember&&(a+=.05*a),t.$cashView.html(o),t.$tdouNumView.html(a)}else t.$cashView.html(0),t.$tdouNumView.html(0)},getTdou:function(){var t=this,e=$.tb.location.getHref();t.setLoading();var i=t.opts&&t.opts.consumption_path||0;t.dataProxy.payIcon(t.iconId,t.orderNum,t.buyIcon,t,e,i,t.payChannel)},buyIcon:function(t){var e=this;if(t&&0==t.no){e.cashier=e.requireInstance("common/widget/qianbao_purchase_tdou");var i=t.data,o=e.$tdouNumView.html(),a=e.opts&&e.opts.consumption_path||0,n=$.extend({product:"tdou",consumption_path:a,goods_cost_tdou:o,pay_type:6,pay_channel:e.payChannel},{qianbao_params:i.return_url,iconCount:i.iconCount,iconId:i.iconId}),s={ie:"utf-8",tbs:window.PageData.tbs,terminal:"pc",pay_type:6,iconId:i.iconId,pageUrl:i.return_url||"",margin:o,goodsCost:o,fr:a||0,channel:e.payChannel};e.cashier.showDialog(n,s),setTimeout(function(){e.clearLoading()},1e3)}else t&&11e4===t.no?e.requireInstance("common/widget/login_dialog"):setTimeout(function(){e.clearLoading()},1e3)},updateTdou:function(t){console.log(t)},clearLoading:function(){var t=this;t.$loadingView.hide(),t.$getTouBtn.removeClass("loading")},setLoading:function(){this.$loadingView.show(),this.$getTouBtn.addClass("loading")},bindEvents:function(){var t=this;t.$dialog.on("click",".j-tdou-select",function(e){var i=$(e.currentTarget);t.changeTdouOptions(i),t.trackCtrl("choose")}).on("click",".j-change-num",function(e){var i=$(e.target),o=i.data("type");t.orderNumCtrl(o)}).on("input",".j-input-num",function(e){var i=$(e.target);t.orderInputNumCtrl(i)}).on("click",".j-get-tdou",function(e){var i=$(e.target);i.hasClass("loading")||(t.getTdou(),t.dialogCtrl.close(),t.trackCtrl("pay"))}).on("click",".j-get-member",function(){$.stats.track("T\u8C46\u94B1\u5305","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u83B7\u53D6T\u8C46\u70B9\u51FB\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"})})},trackCtrl:function(t){var e=this,i=e.isPlus?"new":"old";switch(t){case"view":$.stats.track("show-"+i,"TdouCashier","","view",{tdouViewType:i});break;case"choose":$.stats.track("choose-"+i,"TdouCashier","","click",{tdouViewType:i});break;case"pay":$.stats.track("buy-"+i,"TdouCashier","","click",{tdouViewType:i})}}}});_.Module.define({requires:["common/widget/tdou_get"],path:"common/widget/tchargeDialog",sub:{initial:function(e){var t=this;t.requireInstanceAsync("common/widget/Tdou",[],function(c){e&&e.chargeType&&"platform"==e.chargeType?c.factory("payment",e):(e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier),e&&t.is_direct_cashier?c.factory("auto_direct",e):t.requireInstance("common/widget/tdou_get",e))})}}});_.Module.define({path:"ihome/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,0);$.tb.post("/home/post/follow",{un:t.un,tbs:t.tbs},function(t){t?0==t.no?o._clearLoading(n,e,0):1130036==t.no?o._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,t,o){var e=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});e.bind("onclose",function(){var n=1==o?"btn-sub btn-middle btn_concern_done":"btn_concern btn-attention btn-middle",e=1==o?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";t.text(e).removeClass().addClass(n)})},_addLoading:function(n,t){var o=$("<span></span>"),e="",r=0,a=[".","..","..."],i=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],s=setInterval(function(){e=a[r++%3],o.text(e)},400);return n.text(i[t]).append(o),s},_clearLoading:function(n,t,o){var e=1==o?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",r=1==o?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(r).removeClass().addClass(e),clearInterval(t)},_unfollow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:t.un,tbs:t.tbs},function(t){t&&0==t.no?o._clearLoading(n,e,1):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({path:"ihome/widget/MonthIcon",sub:{iconTitle:{"01":"\u6469\u7FAF\u5EA7","02":"\u6C34\u74F6\u5EA7","03":"\u53CC\u9C7C\u5EA7","04":"\u767D\u7F8A\u5EA7","05":"\u91D1\u725B\u5EA7","06":"\u53CC\u5B50\u5EA7","07":"\u5DE8\u87F9\u5EA7","08":"\u72EE\u5B50\u5EA7","09":"\u5904\u5973\u5EA7",10:"\u5929\u79E4\u5EA7",11:"\u5929\u874E\u5EA7",12:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(i,n){i=i||{},n=n||1;var t='<div class="month_icon_theme_'+n+'">',o="",e={};for(var a in i){var c=a.length;if(6==c){var h=a.substr(c-2,2);e[h]=i[a]}else 2==c&&(e[a]=i[a])}for(var l in this.iconTitle)o=e&&e[l]?" month_icon_"+l:" month_icon_gray_"+l,t+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[l]+'" class="'+o+'"></a>';return t+="</div>"}}});_.Module.define({requires:["user/widget/userApi"],path:"common/widget/MemberApi",sub:{initial:function(){},getMemberNameClass:function(e,r){var i="";if(Env.server_time>13962816e5&&Env.server_time<1396368e6&&4!=r)return i=" vip_red ";var t=this.requireInstance("user/widget/userApi",[]),n=$.getPageData("forum.forum_id",0),s={mParr_props:e};return t.checkSingleForumMembershipOf(s,n)&&(i=" vip_red "),e&&e.level&&e.level.end_time>Env.server_time/1e3&&(i=" vip_red "),i}}});_.Module.define({path:"tbmall/widget/blue_info_detail",sub:{URL:{getOrderList:"/bluediamond/record/getUserRecordList"},initial:function(i){this.type=i?i.type:"income",this.initDialog(),this.bindEvent()},initDialog:function(){this.orderHistoryDialog(this.type)},orderHistoryDialog:function(i,t){var a=this;t||(t=1),a.withdrawTipDialog("fail","\u8BF7\u6C42\u4E2D...");var l='<div class="blue-diamond-orderlist-dialog" >     <div class="blue-diamond-orderlist-dialog-nav">         <ul>              <li class="<%= type == "income" ? "active" : ""  %>" j-blue-diamond-orderlist-income >\u83B7\u53D6\u8BB0\u5F55</li>             <li class="<%= type == "consume" ? "active" : ""  %>"  j-blue-diamond-orderlist-consume>\u6D88\u8017\u8BB0\u5F55</li>             <li class="<%= type == "withdraw" ? "active" : ""  %>"  j-blue-diamond-orderlist-withdraw>\u4EA4\u6613\u8BB0\u5F55</li>         </ul>     </div>      <div class="blue-diamond-orderlist-dialog-list">         <ul>             <% if (list.length > 0) {             %>             <% for( var i=0; i< list.length; i++) {                  var item = list[i];             %>             <li>                 <span class=\'blue-diamond-orderlist-dialog-list-main\'><%=item[\'msg\'] %></span>                 <span class=\'blue-diamond-orderlist-dialog-list-tip\'><%=item[\'date\'] %></span>             </li>             <% } %>             <% } else { %>                 <li>                     <p>\u6682\u65E0\u4EFB\u4F55\u6570\u636E\u3002</p>                 </li>             <% } %>         </ul>     </div>     <div class="blue-diamond-orderlist-dialog-pagenav" >         <div class="blue-diamond-orderlist-dialog-pagenav-header" >\u5171<%=total_count %>\u6761</div>         <ul class="blue-diamond-orderlist-dialog-pagenav-main" >              <li j-blue-diamond-orderlist-dialog-pagenav-left data-pn=\'1\' >&lt;</li>              <%               var diff = 4;              var pagecount = Math.ceil(total_count / pagination.c);              var leftcount = 1;              if( pagination.pn - leftcount > diff) {                 leftcount = pagination.pn - diff;              }              var rightcount= pagecount;              if( rightcount - pagination.pn > diff) {                 rightcount = pagination.pn + diff;              }              for( var i=leftcount; i <= rightcount; i++) {                              %>             <li j-blue-diamond-orderlist-dialog-pagenav-item class="<%= i == pagination.pn ? "active" : "" %>" data-pn=\'<%= i %>\' ><%= i %></li>              <% } %>                                      <li j-blue-diamond-orderlist-dialog-pagenav-right  data-pn=\'<%= pagecount %>\' >&gt;</li>         </ul>     </div> </div>',o="type="+i+"&pn="+t+"&rn=5&tbs="+window.PageData.tbs;$.get(a.URL.getOrderList+"?"+o,function(o){if("0"==o.no){var d=o.data[i],e=[];if(d.pagination.c=d.pagination.rn,d.order_list&&d.order_list.length>0)for(var n=0;n<d.order_list.length;n++){var r=d.order_list[n],s={};s.msg=r.str_ext;var g=new Date(1e3*r.time);s.date=$.dateFormat(g,"yyyy\u5E74MM\u6708dd\u65E5 HH:mm:ss"),e.push(s)}d.type=i,d.list=e,a.dialog&&a.dialog.close();var c=_.template(l)(d);a.dialog=new $.dialog({html:c,title:"\u84DD\u94BB\u6536\u652F\u660E\u7EC6",width:560,height:350,closeable:!0}),a.dialog.element.on("click","[j-blue-diamond-orderlist-income]",function(){a.orderHistoryDialog("income")}).on("click","[j-blue-diamond-orderlist-consume]",function(){a.orderHistoryDialog("consume")}).on("click","[j-blue-diamond-orderlist-withdraw]",function(){a.orderHistoryDialog("withdraw")}).on("click","[j-blue-diamond-orderlist-dialog-pagenav-item]",function(){t=$(this).tbattr("data-pn"),a.orderHistoryDialog(i,t)}).on("click","[j-blue-diamond-orderlist-dialog-pagenav-left]",function(){t=$(this).tbattr("data-pn"),a.orderHistoryDialog(i,t)}).on("click","[j-blue-diamond-orderlist-dialog-pagenav-right]",function(){t=$(this).tbattr("data-pn"),a.orderHistoryDialog(i,t)})}},"json")},withdrawTipDialog:function(i,t,a){var l='<div class="blue-diamond-withdraw-dialog" >     <p class="blue-diamond-withdraw-tip-dialog-title">         <%= title %>     </p>     <% if (type === \'success\') { %>     <p class="blue-diamond-withdraw-tip-dialog-msg">         <%= msg %>     </p>     <% } %>     <div class="blue-diamond-withdraw-tip-dialog-btnwrap">         <a class="btn-middle btn-default" j-blue-diamond-withdraw-tip-dialog-closebtn >\u77E5\u9053\u4E86</a>     </div> </div>',o="",d=this;o=_.template(l)({type:i,title:t,msg:a}),d.dialog&&d.dialog.close(),d.dialog=new $.dialog({html:o,title:"\u63D0\u793A",width:560,height:350,closeable:!0})},bindEvent:function(){}}});_.Module.define({path:"ihome/widget/interactionMod",requires:["tbmall/widget/blueInfoDetail"],sub:{initial:function(){this.bindEvents()},bindEvents:function(){var i=this;$(".j_userinfo_diamond_num").on("click",function(){i.requireInstance("tbmall/widget/blueInfoDetail")})}}});_.Module.define({path:"encourage/widget/paypost_guide",sub:{_options:{},initial:function(i){this._guideClassName="paypost_guide_"+i.position,this._guideStorageName="pg-"+i.position,this._payType=i.payType,this._options=i,this._render(),"link"==i.position?this._linkGuide():this._showGuide()},_render:function(){$.tb.Storage.get(this._guideStorageName)||this._options.$root.addClass(this._guideClassName)},_showGuide:function(){$.tb.Storage.set(this._guideStorageName,1)},_linkGuide:function(){var i=this;this._options.$root.on("click",function(){$.tb.Storage.set(i._guideStorageName,1),window.open("http://tieba.baidu.com/p/3702205481")})}}});_.Module.define({path:"tbmall/component/captcha_payment",sub:{initial:function(a){this.reCommitUrl=a.url,this.data=a.data},showCaptcha:function(a,t){var e=this,c=PageData.tbs||PageData.user.tbs,o=2150040==e.data.no?"\u6B63\u786E\u8F93\u5165\u9A8C\u8BC1\u7801\u540E\uFF0C\u53EF\u7EE7\u7EED\u8D2D\u4E70":"\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";this.requireInstanceAsync("common/component/CaptchaDialog",{message:e.data.data.captcha_str_reason,vCode:e.data.data.captcha_vcode_str,vCodeType:e.data.data.captcha_code_type,exceptionalAccount:0,title:"T\u8C46\u652F\u4ED8\u9A8C\u8BC1\u7801",message:o,forumName:"",modal:!0,forumId:0,checkUrl:"/tbmall/vcode/safecheckvcode?tbs="+c,vCodeUrl:"/tbmall/vcode/safegetvcode",paramsCallback:function(){return{tbs:c}}},function(e){e.bind("onclose",function(){e.hide(),$.tb.location.reload()}),e.bind("onaccept",function(){var c={};c.captcha_input_str=e.getInputValue(),c.captcha_vcode_str=e.getVCode(),"function"==typeof a&&(t?a.call(t,c):a(c))}),e.show()})}}});_.Module.define({path:"tbmall/widget/paykey_rsa",requires:[],sub:{RSA:{},publicKey:"",setKey:function(){this.publicKey=pkey},getKey:function(){var t=this;$.ajax({url:"/tbmall/pass/getpubkey",type:"get",dataType:"json",success:function(e){PageData.publicKey=e.data.pubkey,t.publicKey=PageData.publicKey}})},vcode:function(t){var e=new this.RSA;return e.setKey(this.publicKey),encodeURIComponent(e.encrypt(t))},initial:function(t){var e=this,i=$.extend({},t);PageData.publicKey||i.publicKey?this.publicKey=PageData.publicKey:this.getKey(),function(t){function e(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function i(){return new e(null)}function r(t,e,i,r,s,n){for(;--n>=0;){var o=e*this[t++]+i[r]+s;s=Math.floor(o/67108864),i[r++]=67108863&o}return s}function s(t,e,i,r,s,n){for(var o=32767&e,h=e>>15;--n>=0;){var a=32767&this[t],u=this[t++]>>15,c=h*a+u*o;a=o*a+((32767&c)<<15)+i[r]+(1073741823&s),s=(a>>>30)+(c>>>15)+h*u+(s>>>30),i[r++]=1073741823&a}return s}function n(t,e,i,r,s,n){for(var o=16383&e,h=e>>14;--n>=0;){var a=16383&this[t],u=this[t++]>>14,c=h*a+u*o;a=o*a+((16383&c)<<14)+i[r]+s,s=(a>>28)+(c>>14)+h*u,i[r++]=268435455&a}return s}function o(t){return Ui.charAt(t)}function h(t,e){var i=Oi[t.charCodeAt(e)];return null==i?-1:i}function a(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function u(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+DV:this.t=0}function c(t){var e=i();return e.fromInt(t),e}function f(t,i){var r;if(16==i)r=4;else if(8==i)r=3;else if(256==i)r=8;else if(2==i)r=1;else if(32==i)r=5;else{if(4!=i)return this.fromRadix(t,i),void 0;r=2}this.t=0,this.s=0;for(var s=t.length,n=!1,o=0;--s>=0;){var a=8==r?255&t[s]:h(t,s);0>a?"-"==t.charAt(s)&&(n=!0):(n=!1,0==o?this[this.t++]=a:o+r>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,o+=r,o>=this.DB&&(o-=this.DB))}8==r&&0!=(128&t[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&e.ZERO.subTo(this,this)}function p(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function l(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,r=(1<<e)-1,s=!1,n="",h=this.t,a=this.DB-h*this.DB%e;if(h-->0)for(a<this.DB&&(i=this[h]>>a)>0&&(s=!0,n=o(i));h>=0;)e>a?(i=(this[h]&(1<<a)-1)<<e-a,i|=this[--h]>>(a+=this.DB-e)):(i=this[h]>>(a-=e)&r,0>=a&&(a+=this.DB,--h)),i>0&&(s=!0),s&&(n+=o(i));return s?n:"0"}function d(){var t=i();return e.ZERO.subTo(this,t),t}function g(){return this.s<0?this.negate():this}function y(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return this.s<0?-e:e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function m(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function b(){return this.t<=0?0:this.DB*(this.t-1)+m(this[this.t-1]^this.s&this.DM)}function T(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function S(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function R(t,e){var i,r=t%this.DB,s=this.DB-r,n=(1<<s)-1,o=Math.floor(t/this.DB),h=this.s<<r&this.DM;for(i=this.t-1;i>=0;--i)e[i+o+1]=this[i]>>s|h,h=(this[i]&n)<<r;for(i=o-1;i>=0;--i)e[i]=0;e[o]=h,e.t=this.t+o+1,e.s=this.s,e.clamp()}function D(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return e.t=0,void 0;var r=t%this.DB,s=this.DB-r,n=(1<<r)-1;e[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)e[o-i-1]|=(this[o]&n)<<s,e[o-i]=this[o]>>r;r>0&&(e[this.t-i-1]|=(this.s&n)<<s),e.t=this.t-i,e.clamp()}function E(t,e){for(var i=0,r=0,s=Math.min(t.t,this.t);s>i;)r+=this[i]-t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r-=t[i],e[i++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=0>r?-1:0,-1>r?e[i++]=this.DV+r:r>0&&(e[i++]=r),e.t=i,e.clamp()}function x(t,i){var r=this.abs(),s=t.abs(),n=r.t;for(i.t=n+s.t;--n>=0;)i[n]=0;for(n=0;n<s.t;++n)i[n+r.t]=r.am(0,s[n],i,n,0,r.t);i.s=0,i.clamp(),this.s!=t.s&&e.ZERO.subTo(i,i)}function w(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var r=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,r,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function K(t,r,s){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=r&&r.fromInt(0),null!=s&&this.copyTo(s),void 0;null==s&&(s=i());var h=i(),a=this.s,u=t.s,c=this.DB-m(n[n.t-1]);c>0?(n.lShiftTo(c,h),o.lShiftTo(c,s)):(n.copyTo(h),o.copyTo(s));var f=h.t,p=h[f-1];if(0!=p){var l=p*(1<<this.F1)+(f>1?h[f-2]>>this.F2:0),d=this.FV/l,g=(1<<this.F1)/l,y=1<<this.F2,v=s.t,b=v-f,T=null==r?i():r;for(h.dlShiftTo(b,T),s.compareTo(T)>=0&&(s[s.t++]=1,s.subTo(T,s)),e.ONE.dlShiftTo(f,T),T.subTo(h,h);h.t<f;)h[h.t++]=0;for(;--b>=0;){var S=s[--v]==p?this.DM:Math.floor(s[v]*d+(s[v-1]+y)*g);if((s[v]+=h.am(0,S,s,b,0,f))<S)for(h.dlShiftTo(b,T),s.subTo(T,s);s[v]<--S;)s.subTo(T,s)}null!=r&&(s.drShiftTo(f,r),a!=u&&e.ZERO.subTo(r,r)),s.t=f,s.clamp(),c>0&&s.rShiftTo(c,s),0>a&&e.ZERO.subTo(s,s)}}}function A(t){var r=i();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(e.ZERO)>0&&t.subTo(r,r),r}function B(t){this.m=t}function U(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function O(t){return t}function V(t){t.divRemTo(this.m,null,t)}function N(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function J(t,e){t.squareTo(e),this.reduce(e)}function I(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function P(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function M(t){var r=i();return t.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),t.s<0&&r.compareTo(e.ZERO)>0&&this.m.subTo(r,r),r}function L(t){var e=i();return t.copyTo(e),this.reduce(e),e}function q(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],r=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,r,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function C(t,e){t.squareTo(e),this.reduce(e)}function H(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function j(){return 0==(this.t>0?1&this[0]:this.s)}function k(t,r){if(t>4294967295||1>t)return e.ONE;var s=i(),n=i(),o=r.convert(this),h=m(t)-1;for(o.copyTo(s);--h>=0;)if(r.sqrTo(s,n),(t&1<<h)>0)r.mulTo(n,o,s);else{var a=s;s=n,n=a}return r.revert(s)}function F(t,e){var i;return i=256>t||e.isEven()?new B(e):new P(e),this.exp(t,i)}function _(){var t=i();return this.copyTo(t),t}function z(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Z(){return 0==this.t?this.s:this[0]<<24>>24}function G(){return 0==this.t?this.s:this[0]<<16>>16}function Y(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function W(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function Q(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),s=c(r),n=i(),o=i(),h="";for(this.divRemTo(s,n,o);n.signum()>0;)h=(r+o.intValue()).toString(t).substr(1)+h,n.divRemTo(s,n,o);return o.intValue().toString(t)+h}function X(t,i){this.fromInt(0),null==i&&(i=10);for(var r=this.chunkSize(i),s=Math.pow(i,r),n=!1,o=0,a=0,u=0;u<t.length;++u){var c=h(t,u);0>c?"-"==t.charAt(u)&&0==this.signum()&&(n=!0):(a=i*a+c,++o>=r&&(this.dMultiply(s),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(i,o)),this.dAddOffset(a,0)),n&&e.ZERO.subTo(this,this)}function te(t,i,r){if("number"==typeof i)if(2>t)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ae,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var s=new Array,n=7&t;s.length=(t>>3)+1,i.nextBytes(s),n>0?s[0]&=(1<<n)-1:s[0]=0,this.fromString(s,256)}}function ee(){var t=this.t,e=new Array;e[0]=this.s;var i,r=this.DB-t*this.DB%8,s=0;if(t-->0)for(r<this.DB&&(i=this[t]>>r)!=(this.s&this.DM)>>r&&(e[s++]=i|this.s<<this.DB-r);t>=0;)8>r?(i=(this[t]&(1<<r)-1)<<8-r,i|=this[--t]>>(r+=this.DB-8)):(i=this[t]>>(r-=8)&255,0>=r&&(r+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==s&&(128&this.s)!=(128&i)&&++s,(s>0||i!=this.s)&&(e[s++]=i);return e}function ie(t){return 0==this.compareTo(t)}function re(t){return this.compareTo(t)<0?this:t}function se(t){return this.compareTo(t)>0?this:t}function ne(t,e,i){var r,s,n=Math.min(t.t,this.t);for(r=0;n>r;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(s=t.s&this.DM,r=n;r<this.t;++r)i[r]=e(this[r],s);i.t=this.t}else{for(s=this.s&this.DM,r=n;r<t.t;++r)i[r]=e(s,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function oe(t,e){return t&e}function he(t){var e=i();return this.bitwiseTo(t,oe,e),e}function ae(t,e){return t|e}function ue(t){var e=i();return this.bitwiseTo(t,ae,e),e}function ce(t,e){return t^e}function fe(t){var e=i();return this.bitwiseTo(t,ce,e),e}function pe(t,e){return t&~e}function le(t){var e=i();return this.bitwiseTo(t,pe,e),e}function de(){for(var t=i(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function ge(t){var e=i();return 0>t?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function ye(t){var e=i();return 0>t?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function me(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function ve(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+me(this[t]);return this.s<0?this.t*this.DB:-1}function be(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Te(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=be(this[i]^e);return t}function Se(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function Re(t,i){var r=e.ONE.shiftLeft(t);return this.bitwiseTo(r,i,r),r}function De(t){return this.changeBit(t,ae)}function Ee(t){return this.changeBit(t,pe)}function xe(t){return this.changeBit(t,ce)}function we(t,e){for(var i=0,r=0,s=Math.min(t.t,this.t);s>i;)r+=this[i]+t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r+=t[i],e[i++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=0>r?-1:0,r>0?e[i++]=r:-1>r&&(e[i++]=this.DV+r),e.t=i,e.clamp()}function Ke(t){var e=i();return this.addTo(t,e),e}function Ae(t){var e=i();return this.subTo(t,e),e}function Be(t){var e=i();return this.multiplyTo(t,e),e}function Ue(){var t=i();return this.squareTo(t),t}function Oe(t){var e=i();return this.divRemTo(t,e,null),e}function Ve(t){var e=i();return this.divRemTo(t,null,e),e}function Ne(t){var e=i(),r=i();return this.divRemTo(t,e,r),new Array(e,r)}function Je(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Ie(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Pe(){}function Me(t){return t}function Le(t,e,i){t.multiplyTo(e,i)}function qe(t,e){t.squareTo(e)}function Ce(t){return this.exp(t,new Pe)}function He(t,e,i){var r=Math.min(this.t+t.t,e);for(i.s=0,i.t=r;r>0;)i[--r]=0;var s;for(s=i.t-this.t;s>r;++r)i[r+this.t]=this.am(0,t[r],i,r,0,this.t);for(s=Math.min(t.t,e);s>r;++r)this.am(0,t[r],i,r,0,e-r);i.clamp()}function je(t,e,i){--e;var r=i.t=this.t+t.t-e;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)i[this.t+r-e]=this.am(e-r,t[r],i,0,0,this.t+r-e);i.clamp(),i.drShiftTo(1,i)}function ke(t){this.r2=i(),this.q3=i(),e.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Fe(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=i();return t.copyTo(e),this.reduce(e),e}function _e(t){return t}function ze(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Ze(t,e){t.squareTo(e),this.reduce(e)}function Ge(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function $e(t,e){var r,s,n=t.bitLength(),o=c(1);if(0>=n)return o;r=18>n?1:48>n?3:144>n?4:768>n?5:6,s=8>n?new B(e):e.isEven()?new ke(e):new P(e);var h=new Array,a=3,u=r-1,f=(1<<r)-1;if(h[1]=s.convert(this),r>1){var p=i();for(s.sqrTo(h[1],p);f>=a;)h[a]=i(),s.mulTo(p,h[a-2],h[a]),a+=2}var l,d,g=t.t-1,y=!0,v=i();for(n=m(t[g])-1;g>=0;){for(n>=u?l=t[g]>>n-u&f:(l=(t[g]&(1<<n+1)-1)<<u-n,g>0&&(l|=t[g-1]>>this.DB+n-u)),a=r;0==(1&l);)l>>=1,--a;if((n-=a)<0&&(n+=this.DB,--g),y)h[l].copyTo(o),y=!1;else{for(;a>1;)s.sqrTo(o,v),s.sqrTo(v,o),a-=2;a>0?s.sqrTo(o,v):(d=o,o=v,v=d),s.mulTo(v,h[l],o)}for(;g>=0&&0==(t[g]&1<<n);)s.sqrTo(o,v),d=o,o=v,v=d,--n<0&&(n=this.DB-1,--g)}return s.revert(o)}function Ye(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var r=e;e=i,i=r}var s=e.getLowestSetBit(),n=i.getLowestSetBit();if(0>n)return e;for(n>s&&(n=s),n>0&&(e.rShiftTo(n,e),i.rShiftTo(n,i));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return n>0&&i.lShiftTo(n,i),i}function We(t){if(0>=t)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var r=this.t-1;r>=0;--r)i=(e*i+this[r])%t;return i}function Qe(t){var i=t.isEven();if(this.isEven()&&i||0==t.signum())return e.ZERO;for(var r=t.clone(),s=this.clone(),n=c(1),o=c(0),h=c(0),a=c(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),i?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(t,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);for(;s.isEven();)s.rShiftTo(1,s),i?(h.isEven()&&a.isEven()||(h.addTo(this,h),a.subTo(t,a)),h.rShiftTo(1,h)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(s)>=0?(r.subTo(s,r),i&&n.subTo(h,n),o.subTo(a,o)):(s.subTo(r,s),i&&h.subTo(n,h),a.subTo(o,a))}return 0!=s.compareTo(e.ONE)?e.ZERO:a.compareTo(t)>=0?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a}function Xe(t){var e,i=this.abs();if(1==i.t&&i[0]<=Vi[Vi.length-1]){for(e=0;e<Vi.length;++e)if(i[0]==Vi[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<Vi.length;){for(var r=Vi[e],s=e+1;s<Vi.length&&Ni>r;)r*=Vi[s++];for(r=i.modInt(r);s>e;)if(r%Vi[e++]==0)return!1}return i.millerRabin(t)}function ti(t){var r=this.subtract(e.ONE),s=r.getLowestSetBit();if(0>=s)return!1;var n=r.shiftRight(s);t=t+1>>1,t>Vi.length&&(t=Vi.length);for(var o=i(),h=0;t>h;++h){o.fromInt(Vi[Math.floor(Math.random()*Vi.length)]);var a=o.modPow(n,this);if(0!=a.compareTo(e.ONE)&&0!=a.compareTo(r)){for(var u=1;u++<s&&0!=a.compareTo(r);)if(a=a.modPowInt(2,this),0==a.compareTo(e.ONE))return!1;if(0!=a.compareTo(r))return!1}}return!0}function ei(){this.i=0,this.j=0,this.S=new Array}function ii(t){var e,i,r;for(e=0;256>e;++e)this.S[e]=e;for(i=0,e=0;256>e;++e)i=i+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[i],this.S[i]=r;this.i=0,this.j=0}function ri(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function si(){return new ei}function ni(t){Ii[Pi++]^=255&t,Ii[Pi++]^=t>>8&255,Ii[Pi++]^=t>>16&255,Ii[Pi++]^=t>>24&255,Pi>=Mi&&(Pi-=Mi)}function oi(){ni((new Date).getTime())}function hi(){if(null==Ji){for(oi(),Ji=si(),Ji.init(Ii),Pi=0;Pi<Ii.length;++Pi)Ii[Pi]=0;Pi=0}return Ji.next()}function ai(t){var e;for(e=0;e<t.length;++e)t[e]=hi()}function ui(){}function ci(t,i){return new e(t,i)}function fi(t,i){if(i<t.length+11)return console.error("Message too long for RSA"),null;for(var r=new Array,s=t.length-1;s>=0&&i>0;){var n=t.charCodeAt(s--);128>n?r[--i]=n:n>127&&2048>n?(r[--i]=63&n|128,r[--i]=n>>6|192):(r[--i]=63&n|128,r[--i]=n>>6&63|128,r[--i]=n>>12|224)}r[--i]=0;for(var o=new ui,h=new Array;i>2;){for(h[0]=0;0==h[0];)o.nextBytes(h);r[--i]=h[0]}return r[--i]=2,r[--i]=0,new e(r)}function pi(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function li(t,e){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16)):console.error("Invalid RSA public key")}function di(t){return t.modPowInt(this.e,this.n)}function gi(t){var e=fi(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPublic(e);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r}function yi(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var s="";++r<i.length;){var n=255&i[r];128>n?s+=String.fromCharCode(n):n>191&&224>n?(s+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(s+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return s}function mi(t,e,i){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16),this.d=ci(i,16)):console.error("Invalid RSA private key")}function vi(t,e,i,r,s,n,o,h){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=ci(t,16),this.e=parseInt(e,16),this.d=ci(i,16),this.p=ci(r,16),this.q=ci(s,16),this.dmp1=ci(n,16),this.dmq1=ci(o,16),this.coeff=ci(h,16)):console.error("Invalid RSA private key")}function bi(t,i){var r=new ui,s=t>>1;this.e=parseInt(i,16);for(var n=new e(i,16);;){for(;this.p=new e(t-s,1,r),0!=this.p.subtract(e.ONE).gcd(n).compareTo(e.ONE)||!this.p.isProbablePrime(10););for(;this.q=new e(s,1,r),0!=this.q.subtract(e.ONE).gcd(n).compareTo(e.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var h=this.p.subtract(e.ONE),a=this.q.subtract(e.ONE),u=h.multiply(a);if(0==u.gcd(n).compareTo(e.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(u),this.dmp1=this.d.mod(h),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}}function Ti(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function Si(t){var e=ci(t,16),i=this.doPrivate(e);return null==i?null:yi(i,this.n.bitLength()+7>>3)}function Ri(t){var e,i,r="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),r+=Ci.charAt(i>>6)+Ci.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),r+=Ci.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),r+=Ci.charAt(i>>2)+Ci.charAt((3&i)<<4));(3&r.length)>0;)r+=Hi;return r}function Di(t){var e,i,r="",s=0;for(e=0;e<t.length&&t.charAt(e)!=Hi;++e)v=Ci.indexOf(t.charAt(e)),0>v||(0==s?(r+=o(v>>2),i=3&v,s=1):1==s?(r+=o(i<<2|v>>4),i=15&v,s=2):2==s?(r+=o(i),r+=o(v>>2),i=3&v,s=3):(r+=o(i<<2|v>>4),r+=o(15&v),s=0));return 1==s&&(r+=o(i<<2)),r}var Ei,xi=0xdeadbeefcafe,wi=15715070==(16777215&xi);wi&&"Microsoft Internet Explorer"==navigator.appName?(e.prototype.am=s,Ei=30):wi&&"Netscape"!=navigator.appName?(e.prototype.am=r,Ei=26):(e.prototype.am=n,Ei=28),e.prototype.DB=Ei,e.prototype.DM=(1<<Ei)-1,e.prototype.DV=1<<Ei;var Ki=52;e.prototype.FV=Math.pow(2,Ki),e.prototype.F1=Ki-Ei,e.prototype.F2=2*Ei-Ki;var Ai,Bi,Ui="0123456789abcdefghijklmnopqrstuvwxyz",Oi=new Array;for(Ai="0".charCodeAt(0),Bi=0;9>=Bi;++Bi)Oi[Ai++]=Bi;for(Ai="a".charCodeAt(0),Bi=10;36>Bi;++Bi)Oi[Ai++]=Bi;for(Ai="A".charCodeAt(0),Bi=10;36>Bi;++Bi)Oi[Ai++]=Bi;B.prototype.convert=U,B.prototype.revert=O,B.prototype.reduce=V,B.prototype.mulTo=N,B.prototype.sqrTo=J,P.prototype.convert=M,P.prototype.revert=L,P.prototype.reduce=q,P.prototype.mulTo=H,P.prototype.sqrTo=C,e.prototype.copyTo=a,e.prototype.fromInt=u,e.prototype.fromString=f,e.prototype.clamp=p,e.prototype.dlShiftTo=T,e.prototype.drShiftTo=S,e.prototype.lShiftTo=R,e.prototype.rShiftTo=D,e.prototype.subTo=E,e.prototype.multiplyTo=x,e.prototype.squareTo=w,e.prototype.divRemTo=K,e.prototype.invDigit=I,e.prototype.isEven=j,e.prototype.exp=k,e.prototype.toString=l,e.prototype.negate=d,e.prototype.abs=g,e.prototype.compareTo=y,e.prototype.bitLength=b,e.prototype.mod=A,e.prototype.modPowInt=F,e.ZERO=c(0),e.ONE=c(1),Pe.prototype.convert=Me,Pe.prototype.revert=Me,Pe.prototype.mulTo=Le,Pe.prototype.sqrTo=qe,ke.prototype.convert=Fe,ke.prototype.revert=_e,ke.prototype.reduce=ze,ke.prototype.mulTo=Ge,ke.prototype.sqrTo=Ze;var Vi=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ni=(1<<26)/Vi[Vi.length-1];e.prototype.chunkSize=Y,e.prototype.toRadix=Q,e.prototype.fromRadix=X,e.prototype.fromNumber=te,e.prototype.bitwiseTo=ne,e.prototype.changeBit=Re,e.prototype.addTo=we,e.prototype.dMultiply=Je,e.prototype.dAddOffset=Ie,e.prototype.multiplyLowerTo=He,e.prototype.multiplyUpperTo=je,e.prototype.modInt=We,e.prototype.millerRabin=ti,e.prototype.clone=_,e.prototype.intValue=z,e.prototype.byteValue=Z,e.prototype.shortValue=G,e.prototype.signum=W,e.prototype.toByteArray=ee,e.prototype.equals=ie,e.prototype.min=re,e.prototype.max=se,e.prototype.and=he,e.prototype.or=ue,e.prototype.xor=fe,e.prototype.andNot=le,e.prototype.not=de,e.prototype.shiftLeft=ge,e.prototype.shiftRight=ye,e.prototype.getLowestSetBit=ve,e.prototype.bitCount=Te,e.prototype.testBit=Se,e.prototype.setBit=De,e.prototype.clearBit=Ee,e.prototype.flipBit=xe,e.prototype.add=Ke,e.prototype.subtract=Ae,e.prototype.multiply=Be,e.prototype.divide=Oe,e.prototype.remainder=Ve,e.prototype.divideAndRemainder=Ne,e.prototype.modPow=$e,e.prototype.modInverse=Qe,e.prototype.pow=Ce,e.prototype.gcd=Ye,e.prototype.isProbablePrime=Xe,e.prototype.square=Ue,ei.prototype.init=ii,ei.prototype.next=ri;var Ji,Ii,Pi,Mi=256;if(null==Ii){Ii=new Array,Pi=0;var Li;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var qi=window.crypto.random(32);for(Li=0;Li<qi.length;++Li)Ii[Pi++]=255&qi.charCodeAt(Li)}for(;Mi>Pi;)Li=Math.floor(65536*Math.random()),Ii[Pi++]=Li>>>8,Ii[Pi++]=255&Li;Pi=0,oi()}ui.prototype.nextBytes=ai,pi.prototype.doPublic=di,pi.prototype.setPublic=li,pi.prototype.encrypt=gi,pi.prototype.doPrivate=Ti,pi.prototype.setPrivate=mi,pi.prototype.setPrivateEx=vi,pi.prototype.generate=bi,pi.prototype.decrypt=Si,function(){var t=function(t,r,s){var n=new ui,o=t>>1;this.e=parseInt(r,16);var h=new e(r,16),a=this,u=function(){var r=function(){if(a.p.compareTo(a.q)<=0){var t=a.p;a.p=a.q,a.q=t}var i=a.p.subtract(e.ONE),r=a.q.subtract(e.ONE),n=i.multiply(r);0==n.gcd(h).compareTo(e.ONE)?(a.n=a.p.multiply(a.q),a.d=h.modInverse(n),a.dmp1=a.d.mod(i),a.dmq1=a.d.mod(r),a.coeff=a.q.modInverse(a.p),setTimeout(function(){s()},0)):setTimeout(u,0)},c=function(){a.q=i(),a.q.fromNumberAsync(o,1,n,function(){a.q.subtract(e.ONE).gcda(h,function(t){0==t.compareTo(e.ONE)&&a.q.isProbablePrime(10)?setTimeout(r,0):setTimeout(c,0)})})},f=function(){a.p=i(),a.p.fromNumberAsync(t-o,1,n,function(){a.p.subtract(e.ONE).gcda(h,function(t){0==t.compareTo(e.ONE)&&a.p.isProbablePrime(10)?setTimeout(c,0):setTimeout(f,0)})})};setTimeout(f,0)};setTimeout(u,0)};pi.prototype.generateAsync=t;var r=function(t,e){var i=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(i.compareTo(r)<0){var s=i;i=r,r=s}var n=i.getLowestSetBit(),o=r.getLowestSetBit();if(0>o)return e(i),void 0;o>n&&(o=n),o>0&&(i.rShiftTo(o,i),r.rShiftTo(o,r));var h=function(){(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),(n=r.getLowestSetBit())>0&&r.rShiftTo(n,r),i.compareTo(r)>=0?(i.subTo(r,i),i.rShiftTo(1,i)):(r.subTo(i,r),r.rShiftTo(1,r)),i.signum()>0?setTimeout(h,0):(o>0&&r.lShiftTo(o,r),setTimeout(function(){e(r)},0))};setTimeout(h,10)};e.prototype.gcda=r;var s=function(t,i,r,s){if("number"==typeof i)if(2>t)this.fromInt(1);else{this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),ae,this),this.isEven()&&this.dAddOffset(1,0);var n=this,o=function(){n.dAddOffset(2,0),n.bitLength()>t&&n.subTo(e.ONE.shiftLeft(t-1),n),n.isProbablePrime(i)?setTimeout(function(){s()},0):setTimeout(o,0)};setTimeout(o,0)}else{var h=new Array,a=7&t;h.length=(t>>3)+1,i.nextBytes(h),a>0?h[0]&=(1<<a)-1:h[0]=0,this.fromString(h,256)}};e.prototype.fromNumberAsync=s}();var Ci="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hi="=",ji=ji||{};ji.env=ji.env||{};var ki=ji,Fi=Object.prototype,_i="[object Function]",zi=["toString","valueOf"];ji.env.parseUA=function(t){var e,i=function(t){var e=0;return parseFloat(t.replace(/\./g,function(){return 1==e++?"":"."}))},r=navigator,s={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:r&&r.cajaVersion,secure:!1,os:null},n=t||navigator&&navigator.userAgent,o=$.tb.location,h=o&&o.getHref();return s.secure=h&&0===h.toLowerCase().indexOf("https"),n&&(/windows|win32/i.test(n)?s.os="windows":/macintosh/i.test(n)?s.os="macintosh":/rhino/i.test(n)&&(s.os="rhino"),/KHTML/.test(n)&&(s.webkit=1),e=n.match(/AppleWebKit\/([^\s]*)/),e&&e[1]&&(s.webkit=i(e[1]),/ Mobile\//.test(n)?(s.mobile="Apple",e=n.match(/OS ([^\s]*)/),e&&e[1]&&(e=i(e[1].replace("_","."))),s.ios=e,s.ipad=s.ipod=s.iphone=0,e=n.match(/iPad|iPod|iPhone/),e&&e[0]&&(s[e[0].toLowerCase()]=s.ios)):(e=n.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/),e&&(s.mobile=e[0]),/webOS/.test(n)&&(s.mobile="WebOS",e=n.match(/webOS\/([^\s]*);/),e&&e[1]&&(s.webos=i(e[1]))),/ Android/.test(n)&&(s.mobile="Android",e=n.match(/Android ([^\s]*);/),e&&e[1]&&(s.android=i(e[1])))),e=n.match(/Chrome\/([^\s]*)/),e&&e[1]?s.chrome=i(e[1]):(e=n.match(/AdobeAIR\/([^\s]*)/),e&&(s.air=e[0]))),s.webkit||(e=n.match(/Opera[\s\/]([^\s]*)/),e&&e[1]?(s.opera=i(e[1]),e=n.match(/Version\/([^\s]*)/),e&&e[1]&&(s.opera=i(e[1])),e=n.match(/Opera Mini[^;]*/),e&&(s.mobile=e[0])):(e=n.match(/MSIE\s([^;]*)/),e&&e[1]?s.ie=i(e[1]):(e=n.match(/Gecko\/([^\s]*)/),e&&(s.gecko=1,e=n.match(/rv:([^\s\)]*)/),e&&e[1]&&(s.gecko=i(e[1]))))))),s},ji.env.ua=ji.env.parseUA(),ji.isFunction=function(t){return"function"==typeof t||Fi.toString.apply(t)===_i},ji._IEEnumFix=ji.env.ua.ie?function(t,e){var i,r,s;for(i=0;i<zi.length;i+=1)r=zi[i],s=e[r],ki.isFunction(s)&&s!=Fi[r]&&(t[r]=s)}:function(){},ji.extend=function(t,e,i){if(!e||!t)throw new Error("extend failed, please check that all dependencies are included.");var r,s=function(){};if(s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Fi.constructor&&(e.prototype.constructor=e),i){for(r in i)ki.hasOwnProperty(i,r)&&(t.prototype[r]=i[r]);ki._IEEnumFix(t.prototype,i)}},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var i=t.toString(16);if("-"!=i.substr(0,1))i.length%2==1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{var r=i.substr(1),s=r.length;s%2==1?s+=1:i.match(/^[0-7]/)||(s+=2);for(var n="",o=0;s>o;o++)n+="f";var h=new e(n,16),a=h.xor(t).add(e.ONE);i=a.toString(16).replace(/^-/,"")}return i},this.getPEMStringFromHex=function(t,e){var i=CryptoJS.enc.Hex.parse(t),r=CryptoJS.enc.Base64.stringify(i),s=r.replace(/(.{64})/g,"$1\r\n");return s=s.replace(/\r\n$/,""),"-----BEGIN "+e+"-----\r\n"+s+"\r\n-----END "+e+"-----\r\n"}},KJUR.asn1.ASN1Object=function(){var t="";this.getLengthHexFromValue=function(){if("undefined"==typeof this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+t.length+",v="+this.hV;var e=this.hV.length/2,i=e.toString(16);if(i.length%2==1&&(i="0"+i),128>e)return i;var r=i.length/2;if(r>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);var s=128+r;return s.toString(16)+i},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},KJUR.asn1.DERAbstractString=function(t){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex&&this.setStringHex(t.hex))},ji.extend(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractTime=function(){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(t){utc=t.getTime()+6e4*t.getTimezoneOffset();var e=new Date(utc);return e},this.formatDate=function(t,e){var i=this.zeroPadding,r=this.localDateToUTC(t),s=String(r.getFullYear());"utc"==e&&(s=s.substr(2,2));var n=i(String(r.getMonth()+1),2),o=i(String(r.getDate()),2),h=i(String(r.getHours()),2),a=i(String(r.getMinutes()),2),u=i(String(r.getSeconds()),2);return s+n+o+h+a+u+"Z"},this.zeroPadding=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setByDateValue=function(t,e,i,r,s,n){var o=new Date(Date.UTC(t,e-1,i,r,s,n,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},ji.extend(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractStructured=function(t){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,"undefined"!=typeof t&&"undefined"!=typeof t.array&&(this.asn1Array=t.array)},ji.extend(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object),KJUR.asn1.DERBoolean=function(){KJUR.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},ji.extend(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object),KJUR.asn1.DERInteger=function(t){KJUR.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var i=new e(String(t),10);this.setByBigInteger(i)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.bigint?this.setByBigInteger(t.bigint):"undefined"!=typeof t["int"]?this.setByInteger(t["int"]):"undefined"!=typeof t.hex&&this.setValueHex(t.hex))},ji.extend(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object),KJUR.asn1.DERBitString=function(t){KJUR.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t
},this.setUnusedBitsAndHexValue=function(t,e){if(0>t||t>7)throw"unused bits shall be from 0 to 7: u = "+t;var i="0"+t;this.hTLV=null,this.isModified=!0,this.hV=i+e},this.setByBinaryString=function(t){t=t.replace(/0+$/,"");var e=8-t.length%8;8==e&&(e=0);for(var i=0;e>=i;i++)t+="0";for(var r="",i=0;i<t.length-1;i+=8){var s=t.substr(i,8),n=parseInt(s,2).toString(16);1==n.length&&(n="0"+n),r+=n}this.hTLV=null,this.isModified=!0,this.hV="0"+e+r},this.setByBooleanArray=function(t){for(var e="",i=0;i<t.length;i++)e+=1==t[i]?"1":"0";this.setByBinaryString(e)},this.newFalseArray=function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=!1;return e},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.hex?this.setHexValueIncludingUnusedBits(t.hex):"undefined"!=typeof t.bin?this.setByBinaryString(t.bin):"undefined"!=typeof t.array&&this.setByBooleanArray(t.array))},ji.extend(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object),KJUR.asn1.DEROctetString=function(t){KJUR.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},ji.extend(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ji.extend(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object),KJUR.asn1.DERObjectIdentifier=function(t){var i=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},r=function(t){var r="",s=new e(t,10),n=s.toString(2),o=7-n.length%7;7==o&&(o=0);for(var h="",a=0;o>a;a++)h+="0";n=h+n;for(var a=0;a<n.length-1;a+=7){var u=n.substr(a,7);a!=n.length-7&&(u="1"+u),r+=i(parseInt(u,2))}return r};KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var e="",s=t.split("."),n=40*parseInt(s[0])+parseInt(s[1]);e+=i(n),s.splice(0,2);for(var o=0;o<s.length;o++)e+=r(s[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueName=function(t){if("undefined"==typeof KJUR.asn1.x509.OID.name2oidList[t])throw"DERObjectIdentifier oidName undefined: "+t;var e=KJUR.asn1.x509.OID.name2oidList[t];this.setValueOidString(e)},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.oid?this.setValueOidString(t.oid):"undefined"!=typeof t.hex?this.setValueHex(t.hex):"undefined"!=typeof t.name&&this.setValueName(t.name))},ji.extend(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.DERUTF8String=function(t){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},ji.extend(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNumericString=function(t){KJUR.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},ji.extend(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERPrintableString=function(t){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},ji.extend(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERTeletexString=function(t){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},ji.extend(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERIA5String=function(t){KJUR.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},ji.extend(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERUTCTime=function(t){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex?this.setStringHex(t.hex):"undefined"!=typeof t.date&&this.setByDate(t.date))},ji.extend(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERGeneralizedTime=function(t){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen"),this.hV=stohex(this.s)},"undefined"!=typeof t&&("undefined"!=typeof t.str?this.setString(t.str):"undefined"!=typeof t.hex?this.setStringHex(t.hex):"undefined"!=typeof t.date&&this.setByDate(t.date))},ji.extend(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERSequence=function(t){KJUR.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var t="",e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t+=i.getEncodedHex()}return this.hV=t,this.hV}},ji.extend(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERSet=function(t){KJUR.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.getFreshValueHex=function(){for(var t=new Array,e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t.push(i.getEncodedHex())}return t.sort(),this.hV=t.join(""),this.hV}},ji.extend(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERTaggedObject=function(t){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(t,e,i){this.hT=e,this.isExplicit=t,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,e),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof t&&("undefined"!=typeof t.tag&&(this.hT=t.tag),"undefined"!=typeof t.explicit&&(this.isExplicit=t.explicit),"undefined"!=typeof t.obj&&(this.asn1Object=t.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},ji.extend(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object),function(t){"use strict";var e,i={};i.decode=function(i){var r;if(e===t){var s="0123456789ABCDEF",n=" \f\n\r	\u2028\u2029";for(e=[],r=0;16>r;++r)e[s.charAt(r)]=r;for(s=s.toLowerCase(),r=10;16>r;++r)e[s.charAt(r)]=r;for(r=0;r<n.length;++r)e[n.charAt(r)]=-1}var o=[],h=0,a=0;for(r=0;r<i.length;++r){var u=i.charAt(r);if("="==u)break;if(u=e[u],-1!=u){if(u===t)throw"Illegal character at offset "+r;h|=u,++a>=2?(o[o.length]=h,h=0,a=0):h<<=4}}if(a)throw"Hex encoding incomplete: 4 bits missing";return o},window.Hex=i}(),function(t){"use strict";var e,i={};i.decode=function(i){var r;if(e===t){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="= \f\n\r	\u2028\u2029";for(e=[],r=0;64>r;++r)e[s.charAt(r)]=r;for(r=0;r<n.length;++r)e[n.charAt(r)]=-1}var o=[],h=0,a=0;for(r=0;r<i.length;++r){var u=i.charAt(r);if("="==u)break;if(u=e[u],-1!=u){if(u===t)throw"Illegal character at offset "+r;h|=u,++a>=4?(o[o.length]=h>>16,o[o.length]=h>>8&255,o[o.length]=255&h,h=0,a=0):h<<=6}}switch(a){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";case 2:o[o.length]=h>>10;break;case 3:o[o.length]=h>>16,o[o.length]=h>>8&255}return o},i.re=/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,i.unarmor=function(t){var e=i.re.exec(t);if(e)if(e[1])t=e[1];else{if(!e[2])throw"RegExp out of sync";t=e[2]}return i.decode(t)},window.Base64=i}(),function(t){"use strict";function e(t,i){t instanceof e?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=i)}function i(t,e,i,r,s){this.stream=t,this.header=e,this.length=i,this.tag=r,this.sub=s}var r=100,s="\u2026",n={tag:function(t,e){var i=document.createElement(t);return i.className=e,i},text:function(t){return document.createTextNode(t)}};e.prototype.get=function(e){if(e===t&&(e=this.pos++),e>=this.enc.length)throw"Requesting byte offset "+e+" on a stream of length "+this.enc.length;return this.enc[e]},e.prototype.hexDigits="0123456789ABCDEF",e.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},e.prototype.hexDump=function(t,e,i){for(var r="",s=t;e>s;++s)if(r+=this.hexByte(this.get(s)),i!==!0)switch(15&s){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r},e.prototype.parseStringISO=function(t,e){for(var i="",r=t;e>r;++r)i+=String.fromCharCode(this.get(r));return i},e.prototype.parseStringUTF=function(t,e){for(var i="",r=t;e>r;){var s=this.get(r++);i+=128>s?String.fromCharCode(s):s>191&&224>s?String.fromCharCode((31&s)<<6|63&this.get(r++)):String.fromCharCode((15&s)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return i},e.prototype.parseStringBMP=function(t,e){for(var i="",r=t;e>r;r+=2){var s=this.get(r),n=this.get(r+1);i+=String.fromCharCode((s<<8)+n)}return i},e.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,e.prototype.parseTime=function(t,e){var i=this.parseStringISO(t,e),r=this.reTime.exec(i);return r?(i=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4],r[5]&&(i+=":"+r[5],r[6]&&(i+=":"+r[6],r[7]&&(i+="."+r[7]))),r[8]&&(i+=" UTC","Z"!=r[8]&&(i+=r[8],r[9]&&(i+=":"+r[9]))),i):"Unrecognized time: "+i},e.prototype.parseInteger=function(t,e){var i=e-t;if(i>4){i<<=3;var r=this.get(t);if(0===r)i-=8;else for(;128>r;)r<<=1,--i;return"("+i+" bit)"}for(var s=0,n=t;e>n;++n)s=s<<8|this.get(n);return s},e.prototype.parseBitString=function(t,e){var i=this.get(t),r=(e-t-1<<3)-i,s="("+r+" bit)";if(20>=r){var n=i;s+=" ";for(var o=e-1;o>t;--o){for(var h=this.get(o),a=n;8>a;++a)s+=h>>a&1?"1":"0";n=0}}return s},e.prototype.parseOctetString=function(t,e){var i=e-t,n="("+i+" byte) ";i>r&&(e=t+r);for(var o=t;e>o;++o)n+=this.hexByte(this.get(o));return i>r&&(n+=s),n},e.prototype.parseOID=function(t,e){for(var i="",r=0,s=0,n=t;e>n;++n){var o=this.get(n);if(r=r<<7|127&o,s+=7,!(128&o)){if(""===i){var h=80>r?40>r?0:1:2;i=h+"."+(r-40*h)}else i+="."+(s>=31?"bigint":r);r=s=0}}return i},i.prototype.typeName=function(){if(this.tag===t)return"unknown";var e=this.tag>>6,i=(this.tag>>5&1,31&this.tag);switch(e){case 0:switch(i){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+i.toString(16)}case 1:return"Application_"+i.toString(16);case 2:return"["+i+"]";case 3:return"Private_"+i.toString(16)}},i.prototype.reSeemsASCII=/^[ -~]+$/,i.prototype.content=function(){if(this.tag===t)return null;var e=this.tag>>6,i=31&this.tag,n=this.posContent(),o=Math.abs(this.length);if(0!==e){if(null!==this.sub)return"("+this.sub.length+" elem)";var h=this.stream.parseStringISO(n,n+Math.min(o,r));return this.reSeemsASCII.test(h)?h.substring(0,2*r)+(h.length>2*r?s:""):this.stream.parseOctetString(n,n+o)}switch(i){case 1:return 0===this.stream.get(n)?"false":"true";case 2:return this.stream.parseInteger(n,n+o);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(n,n+o);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(n,n+o);case 6:return this.stream.parseOID(n,n+o);case 16:case 17:return"("+this.sub.length+" elem)";case 12:return this.stream.parseStringUTF(n,n+o);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(n,n+o);case 30:return this.stream.parseStringBMP(n,n+o);case 23:case 24:return this.stream.parseTime(n,n+o)}return null},i.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},i.prototype.print=function(e){if(e===t&&(e=""),document.writeln(e+this),null!==this.sub){e+="  ";for(var i=0,r=this.sub.length;r>i;++i)this.sub[i].print(e)}},i.prototype.toPrettyString=function(e){e===t&&(e="");var i=e+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(i+="+"),i+=this.length,32&this.tag?i+=" (constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(i+=" (encapsulates)"),i+="\n",null!==this.sub){e+="  ";for(var r=0,s=this.sub.length;s>r;++r)i+=this.sub[r].toPrettyString(e)}return i},i.prototype.toDOM=function(){var t=n.tag("div","node");t.asn1=this;var e=n.tag("div","head"),i=this.typeName().replace(/_/g," ");e.innerHTML=i;var r=this.content();if(null!==r){r=String(r).replace(/</g,"&lt;");var s=n.tag("span","preview");s.appendChild(n.text(r)),e.appendChild(s)}t.appendChild(e),this.node=t,this.head=e;var o=n.tag("div","value");if(i="Offset: "+this.stream.pos+"<br/>",i+="Length: "+this.header+"+",i+=this.length>=0?this.length:-this.length+" (undefined)",32&this.tag?i+="<br/>(constructed)":3!=this.tag&&4!=this.tag||null===this.sub||(i+="<br/>(encapsulates)"),null!==r&&(i+="<br/>Value:<br/><b>"+r+"</b>","object"==typeof oids&&6==this.tag)){var h=oids[r];h&&(h.d&&(i+="<br/>"+h.d),h.c&&(i+="<br/>"+h.c),h.w&&(i+="<br/>(warning!)"))}o.innerHTML=i,t.appendChild(o);var a=n.tag("div","sub");if(null!==this.sub)for(var u=0,c=this.sub.length;c>u;++u)a.appendChild(this.sub[u].toDOM());return t.appendChild(a),e.onclick=function(){t.className="node collapsed"==t.className?"node":"node collapsed"},t},i.prototype.posStart=function(){return this.stream.pos},i.prototype.posContent=function(){return this.stream.pos+this.header},i.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},i.prototype.fakeHover=function(t){this.node.className+=" hover",t&&(this.head.className+=" hover")},i.prototype.fakeOut=function(t){var e=/ ?hover/;this.node.className=this.node.className.replace(e,""),t&&(this.head.className=this.head.className.replace(e,""))},i.prototype.toHexDOM_sub=function(t,e,i,r,s){if(!(r>=s)){var o=n.tag("span",e);o.appendChild(n.text(i.hexDump(r,s))),t.appendChild(o)}},i.prototype.toHexDOM=function(e){var i=n.tag("span","hex");if(e===t&&(e=i),this.head.hexNode=i,this.head.onmouseover=function(){this.hexNode.className="hexCurrent"},this.head.onmouseout=function(){this.hexNode.className="hex"},i.asn1=this,i.onmouseover=function(){var t=!e.selected;t&&(e.selected=this.asn1,this.className="hexCurrent"),this.asn1.fakeHover(t)},i.onmouseout=function(){var t=e.selected==this.asn1;this.asn1.fakeOut(t),t&&(e.selected=null,this.className="hex")},this.toHexDOM_sub(i,"tag",this.stream,this.posStart(),this.posStart()+1),this.toHexDOM_sub(i,this.length>=0?"dlen":"ulen",this.stream,this.posStart()+1,this.posContent()),null===this.sub)i.appendChild(n.text(this.stream.hexDump(this.posContent(),this.posEnd())));else if(this.sub.length>0){var r=this.sub[0],s=this.sub[this.sub.length-1];this.toHexDOM_sub(i,"intro",this.stream,this.posContent(),r.posStart());for(var o=0,h=this.sub.length;h>o;++o)i.appendChild(this.sub[o].toHexDOM(e));this.toHexDOM_sub(i,"outro",this.stream,s.posEnd(),this.posEnd())}return i},i.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},i.decodeLength=function(t){var e=t.get(),i=127&e;if(i==e)return i;if(i>3)throw"Length over 24 bits not supported at position "+(t.pos-1);if(0===i)return-1;e=0;for(var r=0;i>r;++r)e=e<<8|t.get();return e},i.hasContent=function(t,r,s){if(32&t)return!0;if(3>t||t>4)return!1;var n=new e(s);3==t&&n.get();var o=n.get();if(o>>6&1)return!1;try{var h=i.decodeLength(n);return n.pos-s.pos+h==r}catch(a){return!1}},i.decode=function(t){t instanceof e||(t=new e(t,0));var r=new e(t),s=t.get(),n=i.decodeLength(t),o=t.pos-r.pos,h=null;if(i.hasContent(s,n,t)){var a=t.pos;if(3==s&&t.get(),h=[],n>=0){for(var u=a+n;t.pos<u;)h[h.length]=i.decode(t);if(t.pos!=u)throw"Content size is not correct for container starting at offset "+a}else try{for(;;){var c=i.decode(t);if(0===c.tag)break;h[h.length]=c}n=a-t.pos}catch(f){throw"Exception while decoding undefined length content: "+f}}else t.pos+=n;return new i(r,o,n,s,h)},i.test=function(){for(var t=[{value:[39],expected:39},{value:[129,201],expected:201},{value:[131,254,220,186],expected:16702650}],r=0,s=t.length;s>r;++r){var n=new e(t[r].value,0),o=i.decodeLength(n);o!=t[r].expected&&document.write("In test["+r+"] expected "+t[r].expected+" got "+o+"\n")}},window.ASN1=i}(),ASN1.prototype.getHexStringValue=function(){var t=this.toHexString(),e=2*this.header,i=2*this.length;return t.substr(e,i)},pi.prototype.parseKey=function(t){try{var e=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/,i=e.test(t)?Hex.decode(t):Base64.unarmor(t),r=ASN1.decode(i);if(9===r.sub.length){var s=r.sub[1].getHexStringValue();this.n=ci(s,16);var n=r.sub[2].getHexStringValue();this.e=parseInt(n,16);var o=r.sub[3].getHexStringValue();this.d=ci(o,16);var h=r.sub[4].getHexStringValue();this.p=ci(h,16);var a=r.sub[5].getHexStringValue();this.q=ci(a,16);var u=r.sub[6].getHexStringValue();this.dmp1=ci(u,16);var c=r.sub[7].getHexStringValue();this.dmq1=ci(c,16);var f=r.sub[8].getHexStringValue();this.coeff=ci(f,16)}else{if(2!==r.sub.length)return!1;var p=r.sub[1],l=p.sub[0],s=l.sub[0].getHexStringValue();this.n=ci(s,16);var n=l.sub[1].getHexStringValue();this.e=parseInt(n,16)}return!0}catch(d){return!1}},pi.prototype.getPrivateBaseKey=function(){var t={array:[new KJUR.asn1.DERInteger({"int":0}),new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e}),new KJUR.asn1.DERInteger({bigint:this.d}),new KJUR.asn1.DERInteger({bigint:this.p}),new KJUR.asn1.DERInteger({bigint:this.q}),new KJUR.asn1.DERInteger({bigint:this.dmp1}),new KJUR.asn1.DERInteger({bigint:this.dmq1}),new KJUR.asn1.DERInteger({bigint:this.coeff})]},e=new KJUR.asn1.DERSequence(t);return e.getEncodedHex()},pi.prototype.getPrivateBaseKeyB64=function(){return Ri(this.getPrivateBaseKey())},pi.prototype.getPublicBaseKey=function(){var t={array:[new KJUR.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new KJUR.asn1.DERNull]},e=new KJUR.asn1.DERSequence(t);t={array:[new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({"int":this.e})]};var i=new KJUR.asn1.DERSequence(t);t={hex:"00"+i.getEncodedHex()};var r=new KJUR.asn1.DERBitString(t);t={array:[e,r]};var s=new KJUR.asn1.DERSequence(t);return s.getEncodedHex()},pi.prototype.getPublicBaseKeyB64=function(){return Ri(this.getPublicBaseKey())},pi.prototype.wordwrap=function(t,e){if(e=e||64,!t)return t;var i="(.{1,"+e+"})( +|$\n?)|(.{1,"+e+"})";return t.match(RegExp(i,"g")).join("\n")},pi.prototype.getPrivateKey=function(){var t="-----BEGIN RSA PRIVATE KEY-----\n";return t+=this.wordwrap(this.getPrivateBaseKeyB64())+"\n",t+="-----END RSA PRIVATE KEY-----"},pi.prototype.getPublicKey=function(){var t="-----BEGIN PUBLIC KEY-----\n";return t+=this.wordwrap(this.getPublicBaseKeyB64())+"\n",t+="-----END PUBLIC KEY-----"},pi.prototype.hasPublicKeyProperty=function(t){return t=t||{},t.hasOwnProperty("n")&&t.hasOwnProperty("e")},pi.prototype.hasPrivateKeyProperty=function(t){return t=t||{},t.hasOwnProperty("n")&&t.hasOwnProperty("e")&&t.hasOwnProperty("d")&&t.hasOwnProperty("p")&&t.hasOwnProperty("q")&&t.hasOwnProperty("dmp1")&&t.hasOwnProperty("dmq1")&&t.hasOwnProperty("coeff")},pi.prototype.parsePropertiesFrom=function(t){this.n=t.n,this.e=t.e,t.hasOwnProperty("d")&&(this.d=t.d,this.p=t.p,this.q=t.q,this.dmp1=t.dmp1,this.dmq1=t.dmq1,this.coeff=t.coeff)};var Zi=function(t){pi.call(this),t&&("string"==typeof t?this.parseKey(t):(this.hasPrivateKeyProperty(t)||this.hasPublicKeyProperty(t))&&this.parsePropertiesFrom(t))};Zi.prototype=new pi,Zi.prototype.constructor=Zi;var Gi=function(t){t=t||{},this.default_key_size=parseInt(t.default_key_size)||1024,this.default_public_exponent=t.default_public_exponent||"010001",this.log=t.log||!1,this.key=null};Gi.prototype.setKey=function(t){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new Zi(t)},Gi.prototype.setPrivateKey=function(t){this.setKey(t)},Gi.prototype.setPublicKey=function(t){this.setKey(t)},Gi.prototype.decrypt=function(t){try{return this.getKey().decrypt(Di(t))}catch(e){return!1}},Gi.prototype.encrypt=function(t){try{return Ri(this.getKey().encrypt(t))}catch(e){return console.log(arguments),!1}},Gi.prototype.getKey=function(t){if(!this.key){if(this.key=new Zi,t&&"[object Function]"==={}.toString.call(t))return this.key.generateAsync(this.default_key_size,this.default_public_exponent,t),void 0;this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},Gi.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},Gi.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},Gi.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},Gi.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},t.JSEncrypt=Gi}(e.RSA),e.RSA=e.RSA.JSEncrypt}}});_.Module.define({path:"tbmall/widget/paykey_dialog",requires:["tbmall/widget/paykey_rsa"],sub:{ERROR:{2270018:"",1990005:"\u652F\u4ED8\u5BC6\u7801\u9A8C\u8BC1\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF0C\u60A8\u8FD8\u6709{#NUM#}\u6B21\u8F93\u5165\u673A\u4F1A",2190005:'\u4F60\u5DF2\u8F93\u5165\u5BC6\u7801\u9519\u8BEF5\u6B21\uFF0C\u652F\u4ED8\u5BC6\u7801\u88AB\u9501\u5B9A\uFF0C\u8BF7<a target="_blank" href="/tbmall/pass/set">\u627E\u56DE\u5BC6\u7801</a>'},MAX_ERR_TIME:5,_setTpl:['<div id="paykey_set_dialog" class="paykey_set_dialog clearfix">',"<p>\u8BF7\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801\u540E\u5B8C\u6210\u6D88\u8D39</br>\uFF08\u53EF\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669\uFF0C\u4FDD\u969C\u8D22\u4EA7\u5B89\u5168\uFF09</p>",'<div class="paykey_btn_area clearfix">','<a href="/tbmall/pass/set" target="_blank" class="paykey_set_accept_btn paykey_set_btn" id="paykey_set_accept_btn">\u7ACB\u5373\u8BBE\u7F6E</a>','<a href="#" class="paykey_set_cancel_btn paykey_set_btn" id="paykey_set_cancel_btn">\u4E0B\u6B21\u518D\u8BF4</a>',"</div>","</div>"].join(""),_inputTpl:['<div id="paykey_set_dialog" class="paykey_set_dialog clearfix">','<form id="paykey_set_form">','<div class="paykey_input_area">',"<span>\u8BF7\u8F93\u5165\u652F\u4ED8\u5BC6\u7801</span>",'<input type="password" class="j_paykey_input paykey_input" id="paykey_input"/>','<p id="paykey_input_msg" class="paykey_input_msg">{#ERROR#}</p>',"</div>",'<div class="paykey_btn_area clearfix">','<a class="j_paykey_submit_btn paykey_submit_btn paykey_set_btn" id="paykey_submit_btn">\u63D0\u4EA4</a>','<a href="/tbmall/pass/set" target="_blank" class="j_paykey_cancel_btn  paykey_set_btn" id="paykey_cancel_btn">\u5FD8\u8BB0\u5BC6\u7801</a>',"</div>","</form>","</div>"].join(""),_dialog:null,conf:{},initial:function(a){this.conf=$.extend(this.conf,a),this.RSA=this.use("tbmall/widget/paykey_rsa")},showDialog:function(a,e,t){var i=e;2==arguments.length&&(t=e,i=null),2===this.conf.showType?this.inputPasskeyDialog(a,i,t):1===this.conf.showType?this.setPasskeyDialog(a,i,t):"function"==typeof a&&(t?a.call(t):a())},inputPasskeyDialog:function(a,e,t){var i=this;2==arguments.length&&(t=e);var s=this._inputTpl;if(this.conf.errType&&(s=s.replace("{#ERROR#}",this.ERROR[this.conf.errType])),this.conf.errTime){var n=this.MAX_ERR_TIME-this.conf.errTime;s=s.replace("{#NUM#}",n)}this._dialog=new $.dialog({html:s,title:"\u652F\u4ED8\u5BC6\u7801",draggable:!1,width:420});var l=function(){var e=$("#paykey_input").val();if(!e)return $("#paykey_input_msg").text("\u8BF7\u8F93\u5165\u652F\u4ED8\u5BC6\u7801"),void 0;var s=i.RSA.vcode(e);"function"==typeof a&&(t?a.call(t,{password:s}):a({password:s})),i._dialog.close()};$("#paykey_submit_btn").click(function(a){a.preventDefault(),l()}),$("#paykey_set_form").submit(function(a){a.preventDefault(),l()}),this._dialog.onclose(function(){"function"==typeof e&&(t?e.call(t):e())})},setPasskeyDialog:function(a,e,t){var i=this;2==arguments.length&&(t=e),this._dialog=new $.dialog({html:this._setTpl,title:"\u63D0\u793A",draggable:!1,width:420}),$("#paykey_set_accept_btn").click(function(){i._dialog.close()}),$("#paykey_set_cancel_btn").click(function(){i._dialog.close()}),this._dialog.element.find(".dialogJclose").on("click",function(){"function"==typeof e&&(t?e.call(t,{ignore_set_paypass:1}):e({ignore_set_paypass:1}))})}}});_.Module.define({path:"tbmall/widget/paykey_mobile",requires:[],sub:{_conf:{token:"",type:"bind"},initial:function(e){this._conf=$.extend(this._conf,e)},show:function(e,i,s,t){"check"===this._conf.type?this.showMobileCheck(e,i,s,t):this.showMobileBind(e,i,s,t)},showMobileCheck:function(e,i,s,t){var o=this,n="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();PageData.user.setpass;var c=t||"\u4E3A\u4E86\u4FDD\u969C\u60A8\u7684\u8D22\u4EA7\u5B89\u5168\uFF0C\u8BF7\u9A8C\u8BC1\u5BC6\u4FDD\u624B\u673A\u540E\u8FDB\u884C\u652F\u4ED8\u3002";$.JsLoadManager.use(["http://passport.baidu.com/passApi/js/uni_forceverify_wrapper.js?cdnversion="+Math.floor(n/6e4),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(n/6e4)],function(){var t=passport.pop.initForceverify({token:o._conf.token,curType:"mobile",title:"\u6D88\u8D39\u9A8C\u8BC1\u5BC6\u4FDD\u624B\u673A",msg:c,onRender:function(){var e=$(this.getById("mask")),i=$(this.getById("wrapper"));e.css("zIndex",5e4+parseInt(e.css("zIndex"))),i.css("zIndex",5e4+parseInt(i.css("zIndex")))},onHide:function(){s=s||o,"function"==typeof i&&i.call(s,{})},onSendvcodeSuccess:function(){},onSubmitSuccess:function(){s=s||o,"function"==typeof e&&e.call(s,{mobile_check:1})}});t.show()},!0,"utf-8")},showMobileBind:function(e,i,s,t){var o=this;if(o.bindMobileDialog)return o.bindMobileDialog.show(),void 0;var n="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();$.JsLoadManager.use(["http://passport.baidu.com/passApi/js/uni_armorwidget_wrapper.js?cdnversion="+Math.floor(n/6e4),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(n/6e4)],function(){var n=t||"\u7ED1\u5B9A\u624B\u673A\u662F\u76EE\u524D\u6700\u7B80\u5355\u6709\u6548\u964D\u4F4E\u8D26\u53F7\u88AB\u76D7\u98CE\u9669\u7684\u65B9\u6CD5~\u8BF7\u7ED1\u5B9A\u540E\u8FDB\u884C\u652F\u4ED8";o._conf.firstFlag&&(n="\u4E3A\u4FDD\u969C\u8D22\u4EA7\u5B89\u5168\uFF0C\u5EFA\u8BAE\u60A8\u7ED1\u5B9A\u624B\u673A\u540E\u8FDB\u884C\u6D88\u8D39\uFF0C\u82E5\u60F3\u6B8B\u5FCD\u7684\u62D2\u7EDD\u8BF7\u5173\u95ED\u6D6E\u5C42\u540E\u7EE7\u7EED\u6D88\u8D39\u3002"),o.bindMobileDialog=passport.pop.ArmorWidget("bindmobile",{token:o._conf.token,title:"\u5B89\u5168\u53CB\u60C5\u63D0\u793A",msg:n,auth_title:"\u6D88\u8D39\u9A8C\u8BC1\u5BC6\u4FDD\u624B\u673A",auth_msg:"\u60A8\u6B63\u5728\u8FDB\u884C\u652F\u4ED8\u5BC6\u7801\u8BBE\u7F6E\uFF0C\u4E3A\u4E86\u60A8\u7684\u8D26\u53F7\u5B89\u5168\uFF0C\u8BF7\u5148\u9A8C\u8BC1\u5BC6\u4FDD\u4FE1\u606F\u3002",onRender:function(){var e=$(this.getById("mask")),i=$(this.getById("wrapper"));e.css("zIndex",5e4+parseInt(e.css("zIndex"))),i.css("zIndex",5e4+parseInt(i.css("zIndex")))},onHide:function(){o.bindid||(s=s||o,"function"==typeof i&&i.call(s))},onSendvcodeSuccess:function(){},onSubmitSuccess:function(i){o.bindid=i.bindid,s=s||o;var t={bindid:o.bindid};o.showSetMobileCheck(t,e,s)}}),o.bindMobileDialog.show()},!0,"utf-8"),$.ajax({url:"/tbmall/pass/setAuthPhone",type:"post",data:{type:1,tbs:PageData.tbs}})},_setTpl:['<a class="dialogJclose j_set_mobile_check_dialogJclose" title="\u5173\u95ED\u672C\u7A97\u53E3">&nbsp;</a>','<div class="set_mobile_check_wrap" id="set_mobile_check_wrap">','<div class="set_mobile_check_msg">','<span class="set_mobile_check_icon"></span>','<span class="set_mobile_check_title">\u64CD\u4F5C\u6210\u529F</span>',"</div>","<p>\u4E3A\u4FDD\u969C\u8D26\u53F7T\u8C46\u5B89\u5168\uFF0C\u5EFA\u8BAE\u60A8\u9009\u62E9\u5F00\u542F\u624B\u673A\u9A8C\u8BC1\u529F\u80FD</p>",'<div class="set_mobile_check_operator">','<a href="#" class="set_mobile_check_select">','<input type="radio" class="j_set_mobile_check_ok set_mobile_check_radio" name="set_mobile_check_radio" checked/>\u5355\u7B14T\u8C46\u6D88\u8D39\u8D85\u8FC7100000\u5F00\u542F\u624B\u673A\u9A8C\u8BC1\u529F\u80FD',"</a>",'<a href="#" class="set_mobile_check_select">','<input type="radio" class="j_set_mobile_check_cancel set_mobile_check_radio" name="set_mobile_check_radio"/>\u4E0D\u5F00\u542F\u624B\u673A\u9A8C\u8BC1\u529F\u80FD',"</a>",'<a href="#" class="j_set_mobile_check_submit set_mobile_check_submit ui_btn ui_btn_m"><span><em>\u786E\u5B9A</em></span></a>',"</div>","</div>"].join(""),showSetMobileCheck:function(e,i,s){var t=this,o=new $.dialog({html:this._setTpl,showTitle:!1,height:260,width:420}),n=$(o.element);t.openCheck=1;var c=function(){$.ajax({url:"/tbmall/pass/setAuthPhone",type:"post",dataType:"json",data:{type:t.openCheck,tbs:PageData.tbs},success:function(e){0===e.no?setTimeout(function(){o.close()},1e3):$.dialog.alert("\u6D88\u8D39\u624B\u673A\u9A8C\u8BC1\u529F\u80FD\u8BBE\u7F6E\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")},error:function(){$.dialog.alert("\u6D88\u8D39\u624B\u673A\u9A8C\u8BC1\u529F\u80FD\u8BBE\u7F6E\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}})};n.find(".j_set_mobile_check_submit").click(function(){c()}),n.find(".j_set_mobile_check_ok").click(function(){t.openCheck=1}),n.find(".j_set_mobile_check_cancel").click(function(){t.openCheck=0}),n.find(".j_set_mobile_check_dialogJclose").click(function(){t.openCheck=1,c()}),o.onclose(function(){"function"==typeof i&&i.call(s,e)})}}});_.Module.define({path:"tbmall/widget/TbeanSafe",requires:["tbmall/component/captcha_payment","tbmall/widget/paykey_dialog","tbmall/widget/paykey_mobile"],sub:{ERROR:{},initial:function(t){this._initParam(t),this._handleErr()},needCheck:function(){return!!this.type},getType:function(){return this.type},_initParam:function(t){t=$.extend({json:{},sucCallback:function(){},errCallback:function(){}},t),this.type=0,this._json=t.json||{},this._no=this._json.no||this._json.errno,this._msg=this._json.msg,this._data=this._json.data||{},this._content=t.content,this._sucCall=$.isFunction(t.sucCallback)?t.sucCallback:function(){},this._errCall=$.isFunction(t.errCallback)?t.errCallback:function(){},this._mobileMsg="undefined"!=typeof t.tbeanOptions?t.tbeanOptions.mobileMsg:""},_handleErr:function(){switch(this._no){case 360007:case 2150040:this._initCaptcha(),this.type=1;break;case 2270018:case 1990005:case 2190005:this._initPaykey(2),this.type=2;break;case 2270066:this._initPaykey(1),this.type=2;break;case 2270040:this._initFirstMobile("bind"),this.type=3;break;case 2270041:this._initMobile("bind"),this.type=3;break;case 2270042:this._initMobile("check"),this.type=3;break;case 2270072:this._initFrozen(),this.type=4}},_initCaptcha:function(){var t=this.use("tbmall/component/captcha_payment",{data:this._json});t.showCaptcha(this._sucCall,this._content,this._errCall)},_initPaykey:function(t){var i=this.use("tbmall/widget/paykey_dialog",{showType:t,errType:this._no,errTime:this._data.wrongtime});i.showDialog(this._sucCall,this._errCall,this._content)},_initMobile:function(t){var i=this,e=this.use("tbmall/widget/paykey_mobile",{token:i._data.token,type:t});e.show(this._sucCall,this._errCall,this._content,this._mobileMsg)},_initFirstMobile:function(t){var i=this,e=this.use("tbmall/widget/paykey_mobile",{token:i._data.token,type:t,firstFlag:!0});e.show(this._sucCall,this._sucCall,this._content)},_FROZEN_TPL:['<div id="tdou_frozen_dialog" class="tdou_frozen_dialog clearfix">',"<p>\u60A8\u7684\u8D26\u53F7\u5904\u4E8E\u5F02\u5E38\u72B6\u6001\uFF0C\u6682\u65F6\u4E0D\u80FD\u6D88\u8D39T\u8C46\uFF0C\u7ED9\u60A8\u9020\u6210\u7684\u4E0D\u4FBF\u656C\u8BF7\u8C05\u89E3\u3002</p>",'<div class="tdou_frozen_btn_area clearfix">','<a href="#" target="_blank" class="tdou_frozen_accept_btn tdou_frozen_btn" id="tdou_frozen_accept_btn">\u786E\u5B9A</a>','<a href="#" class="tdou_frozen_cancel_btn tdou_frozen_btn" id="tdou_frozen_cancel_btn">\u53D6\u6D88</a>',"</div>","</div>"].join(""),_initFrozen:function(){var t=this,i=new $.dialog({html:t._FROZEN_TPL,title:"T\u8C46\u51BB\u7ED3\u63D0\u793A"});$(i.element).find(".tdou_frozen_btn").click(function(t){t.preventDefault(),i.close()}),i.onclose(function(){"function"==typeof t._errCall&&t._errCall()})}}});_.Module.define({path:"tbmall/widget/TbeanSafeAjax",requires:["tbmall/widget/TbeanSafe"],sub:{initial:function(a){this.options=a||{}},ajax:function(a){var t=this,e=a.success||function(){},n=a.data||{},s=function(s){var i=t.use("tbmall/widget/TbeanSafe",{json:s,sucCallback:function(e){var s=$.extend({},n,e),i=$.extend({},a);i.data=s,t.ajax(i)},tbeanOptions:t.options});i.needCheck()||e(s)};return a.success=s,a.type=a.type||"post",a.dataType=a.dataType||"json",$.ajax(a)},post:function(a,t,e){var n={url:a,data:t,success:e};return this.ajax(n)}}});_.Module.define({path:"encourage/widget/post_marry",requires:[],sub:{URL:{postMarryThread:"/marriage/postMarriageThread",getGift:"/marriage/gift/getSceneGiftList",sendGift:"/marriage/gift/sendGift",saveOrder:"/marriage/gift/saveOrder"},giftData:{},sceneId:2000135,initial:function(t){return this.opt=t,this.checkLogin()?("poster"===t.type?this.buildInPoster():"float"===t.type&&this.buildInFloat(),void 0):!1},bindEvent:function(){var t=this;$("body").on("click","[j-post-marry]",function(){t.buildInPoster()})},bindTemplateEvent:function(){var t=this,a=5;this.$root.find("[j-post-marry-title]").focus(),this.$root.on("click","[j-post-marry-gift-list-left]",function(){var r=t.$root.find(".post-marry-gift-list-wrapper ul");if(r.find("li").length<=6)return!1;var e=r.find("li").first();e.animate({marginLeft:-e.width()},function(){e.appendTo(r),e.css({marginLeft:a})})}).on("click","[j-post-marry-gift-list-right]",function(){var r=t.$root.find(".post-marry-gift-list-wrapper ul");if(r.find("li").length<=6)return!1;var e=r.find("li").last();e.css({marginLeft:-e.width()}),e.prependTo(r);var i=r.find("li").first();i.animate({marginLeft:a})}).on("click",".post-marry-gift-item",function(){var a=$(this);a.hasClass("post-marry-gift-item-active")?(t.$root.find(".post-marry-gift-list-wrapper ul li").removeClass("post-marry-gift-item-active"),t.giftData.gift_id=null,t.giftData.price=0):(t.$root.find(".post-marry-gift-list-wrapper ul li").removeClass("post-marry-gift-item-active"),a.addClass("post-marry-gift-item-active"),t.giftData.gift_id=a.tbattr("data-id"),t.giftData.price=a.tbattr("data-price"))}).on("mouseover",".post-marry-gift-item",function(){var a=$(this);t.buildGiftTipCard(a)}).on("mouseout",".post-marry-gift-item",function(){$(this);t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:100}),t._visit_card=null}).on("change","[j-post-marry-oath]",function(){var a=$(this),r=a.val(),e=null==r.match(/[^ -~]/g)?r.length:r.length+r.match(/[^ -~]/g).length;e>280?(a.parent().find("[j-post-marry-value-warning]").text("\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\u6C49\u5B57\uFF0C\u73B0\u5728\u662F"+Math.ceil(e/2)+"\u5B57"),t.oathReady=!1):r?(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.oathReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u6C42\u5A5A\u8A93\u8A00\u4E0D\u80FD\u4E3A\u7A7A"),t.oathReady=!1)}).on("change","[j-post-marry-title]",function(){var a=$(this),r=a.val(),e=null==r.match(/[^ -~]/g)?r.length:r.length+r.match(/[^ -~]/g).length;e>280?(a.parent().find("[j-post-marry-value-warning]").text("\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\u6C49\u5B57\uFF0C\u73B0\u5728\u662F"+Math.ceil(e/2)+"\u5B57"),t.titleReady=!1):r?"\u3010\u6C42\u5A5A\u3011"===r?(a.parent().find("[j-post-marry-value-warning]").text("\u8BF7\u8865\u5168\u6807\u9898"),t.titleReady=!1):(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.titleReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),t.titleReady=!1)}).on("change","[j-post-marry-user]",function(){var a=$(this),r=a.val();r?(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.userReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u88AB\u6C42\u5A5A\u4EBA\u4E0D\u80FD\u4E3A\u7A7A"),t.userReady=!1)}).on("click","[j-post-marry-btn]",function(){t.$root.find("[j-post-marry-form]").trigger("submit")}).on("keypress","[j-post-marry-btn]",function(){return!1}).on("submit","[j-post-marry-form]",function(){var a=$(this);if(!t.userReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u5BF9\u8C61"),!1;if(!t.titleReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u6807\u9898"),!1;if(!t.oathReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u8A93\u8A00"),!1;t.giftData.user_name=a.find('[name="post-marry-user"]').val();var r={title:a.find('[name="post-marry-title"]').val(),content:a.find('[name="post-marry-oath"]').val(),forum_name:PageData.forum.forum_name||"\u82F1\u4E09\u5609\u54E5",user_name:t.giftData.user_name,gift_id:t.giftData.gift_id,tbs:PageData.tbs};return t.giftData.scene_id=t.sceneId,t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u4E2D...  "),$.post(t.URL.postMarryThread,r,function(a){if(a)switch(a.no){case 0:t.giftData.gift_id?(t.giftData.post=a.data,t.genOrder(t.giftData)):(t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u6210\u529F!  "),setTimeout(function(){$.tb.location.reload()},1e3));break;case 2670002:t.showAlert("\u6765\u665A\u4E00\u6B65\uFF0C\u8BE5\u7528\u6237\u5DF2\u7ECF\u7ED3\u5A5A");break;case 2672671:t.showAlert("\u8BE5\u7528\u6237\u6B63\u5728\u7533\u8BF7\u6C42\u5A5A\u4E2D");break;case 2670006:t.showAlert('\u60A8\u8FD8\u6CA1\u6709\u8BBE\u7F6E\u6027\u522B\uFF0C\u4E0D\u80FD\u6C42\u5A5A <p style="text-align:center; padding:20px; "><a class="btn-small btn-default" href="http://www.baidu.com/p/setting/profile/basic" target="_blank">\u70B9\u51FB\u8BBE\u7F6E</a><p>');break;case 2670007:t.showAlert("\u6C42\u5A5A\u5BF9\u8C61\u6CA1\u6709\u8BBE\u7F6E\u6027\u522B\u4E0D\u80FD\u6C42\u5A5A");break;case 2670008:t.showAlert("\u5185\u6D4B\u671F\u95F4\uFF0C\u53EA\u5141\u8BB8\u5F02\u6027\u7ED3\u5A5A\u54E6~");break;case 2380009:t.showAlert("\u5185\u6D4B\u671F\u95F4\uFF0C\u9700\u8981\u7ED3\u5A5A\u53CC\u65B9\uFF0C\u81F3\u5C11\u4E00\u65B9\u6709\u59B9\u5B50\u56E2\u5370\u8BB0\u65B9\u53EF\u7ED3\u5A5A");break;default:t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u5931\u8D25! ")}else t.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86! ")}),!1}).on("click","[j-post-marry-header-close]",function(a){a.preventDefault(),t.dialog.hide()})},buildGiftTipCard:function(t){var a=this,r=parseInt(t.tbattr("data-proportion")),e=parseInt(t.tbattr("data-price")),i=Math.floor(e*(1-r/100));if(0!=i&&!isNaN(i)){a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var s="";s=0===+a.currency?'<div class="marry-gift-tip-card-content">\u6536\u793C\u4EBA\u53EF\u83B7\u5F97 <i class="icon-tbean"></i><span class="orange-text" >'+i+"</span></div>":'<div class="marry-gift-tip-card-content">\u6536\u793C\u4EBA\u53EF\u83B7\u5F97 <i class="icon-blue"></i><span class="orange-text" >'+i+"</span></div>";var o={content:s,card_css:{width:200,zIndex:60002},auto_positon:!0,event_target:t,attr:"id='marry-gift-tip-card'",wrap:$("body")};a._visit_card=a.requireInstance("common/widget/Card",o),a._visit_card.showCard({type:"delayShow",time:200})}},loadTemplate:function(t,a){var r=this;this.template='<div id="post-marry" class="post-marry" >      <% if (canClose == 0) { %>      <div class="post-marry-header" >\u6B63\u5F0F\u6C42\u5A5A</div>      <% } %>                   <form class="post-marry-form" j-post-marry-form>      <div class="post-marry-wrapper" >                   <div class="post-marry-row post-marry-title" >              <label class="post-marry-label" >\u8D34\u5B50\u6807\u9898:</label>              <input class="post-marry-value" name="post-marry-title" j-post-marry-title required value="\u3010\u6C42\u5A5A\u3011"/>              <div  class="post-marry-value-warning" j-post-marry-value-warning ></div>          </div>          <div class="post-marry-row post-marry-user" >              <label class="post-marry-label" >\u6C42\u5A5A\u4EBA:</label>              <input class="post-marry-value" required readonly=true value="<%= user_name %>" />          </div>          <div class="post-marry-row post-marry-propose" >              <label class="post-marry-label" >\u88AB\u6C42\u5A5A\u4EBA:</label>              <input class="post-marry-value" name="post-marry-user" j-post-marry-user  value="<%= propose_name %>"  required placeholder="\u53EA\u80FD\u5BF9\u62E5\u6709\u59B9\u7EB8\u5370\u8BB0\u7684\u7528\u6237\u6C42\u5A5A" />              <div  class="post-marry-value-warning" j-post-marry-value-warning ><% if( propose_name) { %><div class="post-marry-checked" ></div> <% } %></div>          </div>          <div class="post-marry-row post-marry-oath" >              <label class="post-marry-label"  >\u6C42\u5A5A\u8A93\u8A00:</label>              <textarea class="post-marry-value" name="post-marry-oath" j-post-marry-oath required  placeholder="\u751C\u871C\u800C\u53C8\u771F\u8BDA\u7684\u8A93\u8A00\uFF0C\u80FD\u63D0\u9AD8\u6C42\u5A5A\u6210\u529F\u51E0\u7387\uFF0C\u4E0D\u8D85\u8FC7140\u4E2A\u5B57\u3002"  ></textarea>              <div  class="post-marry-value-warning" j-post-marry-value-warning ></div>          </div>                    <div class="post-marry-row post-marry-gift" >              <label class="post-marry-label" >\u6C42\u5A5A\u793C\u7269\u9009\u62E9(\u53EF\u9009)</label>              <div class="post-marry-gift-list clearfix">                  <% if (giftList.length > 7 ){ %>                      <div class="post-marry-gift-list-left" j-post-marry-gift-list-left ></div>                  <% } %>                                    <div class="post-marry-gift-list-wrapper clearfix" >                      <ul>                          <% for (var i in giftList) {                               var item = giftList[i];                          %>                               <li class="post-marry-gift-item" data-price="<%=item.price %>" data-proportion="<%=item.proportion %>" data-id="<%=item.gift_id %>" >                                  <div class="post-marry-gift-item-wrapper" >                                      <div  class="post-marry-gift-item-img" >                                          <img src="<%=item.large_thumbnail_url %>" />                                          <% if (item.proportion != 100) { %> <i class="icon-marry-gift-dou"></i><% } %>                                      </div>                                      <span class="post-marry-gift-worth orange-text"><i class="icon-tbean"></i><%=item.price %></span>                                      <div  class="post-marry-gift-item-check" ></div>                                  </div>                                  <p class="post-marry-gift-item-name" ><%=item.gift_name %></p>                                                                </li>                          <% } %>                                                                         </ul>                  </div>                  <% if (giftList.length > 7 ){ %>                      <div class="post-marry-gift-list-right"  j-post-marry-gift-list-right ></div>                  <% } %>              </div>          </div>          </div>        <button type="button" class="btn-default btn-small post-marry-btn" j-post-marry-btn >\u5F00\u59CB\u6C42\u5A5A</button>      <% if (canClose) { %>     <!--  <a class="btn-small btn-sub post-marry-header-close" j-post-marry-header-close >\u5173\u95ED</a> -->      <span class="post-marry-tip">( \u60A8\u7684\u7ED3\u5A5A\u8D34\u5C06\u4F1A\u53D1\u5230<a href="/f?ie=utf-8&kw=\u82F1\u4E09\u5609\u54E5&fr=marriage_post" target="_blank" >\u82F1\u4E09\u5609\u54E5\u5427</a> )</span>      <% } %>          </form>  </div>';var e=[],i={scene_id:this.sceneId};$.get(this.URL.getGift,i,function(i){if(i)switch(i.no){case 0:e=i.data.gift_list,r.currency=i.data.currency;break;default:console.log("\u793C\u7269\u83B7\u53D6\u5931\u8D25")}else e=[];e||(e=[]),r.$root=$(_.template(r.template)({user_name:PageData.user.user_name,propose_name:r.opt.propose_name||"",giftList:e,canClose:"poster"===t?0:1})),r.opt.propose_name&&(r.userReady=!0),r.bindTemplateEvent(),a()})},showAlert:function(t,a){this.dialog_tip&&this.dialog_tip.close(),this.dialog_tip=null,t&&(this.dialog_tip=new $.dialog({title:a?a:"\u53D1\u8D34\u63D0\u793A",html:'<div style="text-align:center" >'+t+"</div>"}))},showCaptchaDialog:function(t){var a=this;a.captchaDialog?(this._isPosting=!1,a.captchaDialog.setTip(t.data.vcode.str_reason),a.captchaDialog.updateCaptchaImg(t.data.vcode.captcha_vcode_str,t.data.vcode.captcha_code_type),a.captchaDialog.show(),a.captchaDialog.focus()):this.requireInstanceAsync("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,forumName:a._dataPostor.kw,forumId:a._dataPostor.fid,postType:"reply",paramsCallback:function(){var t=a._getData(),r={content:t.content};return r.tid=a._dataPostor.tid,r}},function(t){a.captchaDialog=t,t.bind("onclose",function(){return a._isPosting=!1,a._enableEditor(),t.hide(),!1}),t.bind("onaccept",function(){a.setDataPostor({vcode:t.getInputValue(),vcode_md5:t.getVCode()}),a._submitData(),a.removeDataPostor("vcode"),a.removeDataPostor("vcode_md5")}),t.show()})},checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)},genOrder:function(t){var a=this.requireInstance("tbmall/widget/TbeanSafeAjax"),r=this,e=t;e.user_name=this.giftData.user_name,e.tbs=PageData.tbs,a.post(this.URL.sendGift,e,function(a){if(0==a.no&&a.data){var e=a.data,i={};i.order_id=a.data.order_id,i.thread_id=t.post.thread_id,i.post_id=t.post.post_id,i.gift_from=1,i.price=r.giftData.price,i.tbs=PageData.tbs,$.post(r.URL.saveOrder,i,function(){var t=r.requireInstance("common/widget/Tdou/TdouViewPay",function(t){t.data&&!t.data.no&&(r.showAlert("\u793C\u7269\u8D60\u9001\u6210\u529F\uFF01","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3))});t.createMain(e)})}else r.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3)})},hide:function(){this.dialog.hide()},show:function(){this.dialog.show()},buildInFloat:function(){this.dialog&&this.dialog.close();var t=this;this.loadTemplate("float",function(){t.dialog=new $.dialog({title:"\u53D1\u8868\u7ED3\u5A5A\u8D34",html:t.$root,width:709,holderClassName:"post-marry-dialog"})})},buildInPoster:function(){if(this.dialog)this.show();else{var t=$("#tb_rich_poster .poster_body"),a=this;this.loadTemplate("poster",function(){a.dialog=new $.dialog({html:a.$root,showTitle:!1,showModal:!1,modal:!1,width:720,showShadow:!1,fixed:!1,top:t.offset().top,left:t.offset().left,holderClassName:"post-marry-dialog-poster"})})}}}});_.Module.define({path:"ihome/widget/marry",requires:["encourage/widget/post_marry"],sub:{URL:{divorce:"/marriage/applyDivorce",agreeDivorce:"/marriage/acceptDivorce",refuseDivorce:"/marriage/refuseDivorce",getDivorce:"/marry/getDivorce ",checkDivorceStatus:"/marriage/queryDivorce"},marry:{},initial:function(e){this.opt=e,this.opt&&this.opt.homeUserMarriage&&this.opt.homeUserMarriage.user_name==PageData.user.user_name&&3===this.opt.homeUserMarriage.status&&this.checkMarriageStatus(),this.bindEvent()},bindEvent:function(){var e=this,a=$(".userinfo-marry");e.marry.user_name=a.tbattr("data-username"),e.marry.relation_id=a.tbattr("data-id"),a.on("click","[j-userinfo-marry-divorce]",function(){e.showProposeDivorce()}).on("click","[j-userinfo-marry-propose]",function(){console.log("ok"),e.marryDialog={};var a=e.marry.user_name;e.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:a},function(a){e.marryDialog=a})}).on("click","[j-userinfo-marry-dealdivorce]",function(){e.showNoticeProposeDivorce()})},showDialog:function(e){var a=this;this.dialog&&this.dialog.close(),this.dialog=null,this.dialog=new $.dialog({title:e.title,html:(e.uptip?'<p class="marry-dialog-uptip" >'+e.uptip+"</p>":"")+'<p class="marry-dialog-content" >'+e.content+'<p><p class="marry-dialog-tip" >'+e.tip+'</p><div class="marry-dialog-btn-wrapper" >'+e.btns+"</div>",width:500,holderClassName:"marry-dialog"}),this.dialog.element.on("click","[j-marry-dialog-close]",function(){a.dialog.close()})},showSureProposeDivorce:function(){var e={title:"\u63D0\u51FA\u79BB\u5A5A",content:"\u60A8\u53D1\u8D77\u7684\u79BB\u5A5A\u7533\u8BF7\uFF0C\u8D34\u5427\u6C11\u653F\u5C40\u53D7\u7406\u6210\u529F<br />\u7B49\u5F85\u5BF9\u65B9\u786E\u8BA4",tip:'\u79BB\u5A5A\u624B\u7EED\u8D39:<i class="icon-tbean"></i>20000',btns:'<a class="btn-middle btn-default" j-marry-dialog-close-refresh >\u77E5\u9053\u4E86</a>'};this.showDialog(e);this.dialog.element.on("click","[j-marry-dialog-close-refresh]",function(){$.tb.location.reload()})},showProposeDivorce:function(){var e={title:"\u63D0\u51FA\u79BB\u5A5A",content:"\u5A5A\u59FB\u975E\u513F\u620F\uFF0C\u671B\u541B\u518D\u4E09\u601D",tip:'\u79BB\u5A5A\u624B\u7EED\u8D39:<i class="icon-tbean"></i>20000',btns:'<a class="btn-middle btn-sub" j-marry-dialog-close >\u518D\u60F3\u60F3</a><a class="btn-middle btn-default" j-marry-dialog-suredivorce >\u53BB\u529E\u79BB\u5A5A</a>'};this.showDialog(e);var a=this;this.dialog.element.on("click","[j-marry-dialog-suredivorce]",function(){a.divorcePay()})},showRefuseProposeDivorce:function(){var e={title:"\u63D0\u51FA\u79BB\u5A5A",content:"\u60A8\u53D1\u8D77\u7684\u79BB\u5A5A\u7533\u8BF7\uFF0C\u8D34\u5427\u6C11\u653F\u5C40\u4E0D\u4E88\u53D7\u7406",tip:"\u539F\u56E0:\u6210\u5A5A\u672A\u52303\u5929\uFF0C\u8FD8\u4E0D\u80FD\u53D1\u8D77\u79BB\u5A5A\u7533\u8BF7",btns:'<a class="btn-middle btn-default" j-marry-dialog-close >\u6211\u77E5\u9053\u4E86</a>'};this.showDialog(e)},showNoticeProposeDivorce:function(){var e=this,a={title:"\u5904\u7406\u79BB\u5A5A\u7533\u8BF7",content:"\u5F88\u9057\u61BE\uFF0C\u60A8\u7684\u7231\u4EBA"+e.opt.homeUserMarriage.user_name+"\u63D0\u51FA\u79BB\u5A5A",uptip:"\u8D34\u5427\u6C11\u653F\u5C40\u901A\u77E5",tip:"",btns:'<a class="btn-middle btn-sub" j-marry-dialog-refusedivorce >\u6211\u4E0D\u540C\u610F</a><a class="btn-middle btn-default" j-marry-dialog-agreedivorce >\u540C\u610F\u79BB\u5A5A</a>'};this.showDialog(a),this.dialog.element.on("click","[j-marry-dialog-agreedivorce]",function(){var a={relation_id:e.marry.relation_id,user_name:e.opt.homeUserMarriage.user_name,tbs:PageData.tbs};$.post(e.URL.agreeDivorce,a,function(a){if(a)switch(a.no){case 0:e.showAgreeDivorce();break;default:e.showAlert("\u5904\u7406\u79BB\u5A5A\u7533\u8BF7\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")}else e.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")})}).on("click","[j-marry-dialog-refusedivorce]",function(){var a={relation_id:e.marry.relation_id,user_name:e.opt.homeUserMarriage.user_name,tbs:PageData.tbs};$.post(e.URL.refuseDivorce,a,function(r){if(r)switch(r.no){case 0:e.showRefuseDivorce(a.user_name);break;default:e.showAlert("\u5904\u7406\u79BB\u5A5A\u7533\u8BF7\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")}else e.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")})})},showRefuseDivorce:function(e){var a={title:"\u5904\u7406\u79BB\u5A5A\u7533\u8BF7",content:"\u60A8\u62D2\u7EDD\u4E86\u79BB\u5A5A\u8BF7\u6C42\uFF0C\u8D34\u5427\u6C11\u653F\u5C40\u53D7\u7406\u6210\u529F",tip:"\u63D0\u793A:\u82E5\u60A8\u7684\u7231\u4EBA "+e+"\u518D\u6B21\u63D0\u51FA\u79BB\u5A5A\u7533\u8BF7\uFF0C\u5219\u81EA\u52A8\u89E3\u9664\u5A5A\u59FB\u5173\u7CFB",btns:'<a class="btn-middle btn-default" j-marry-dialog-close >\u6211\u77E5\u9053\u4E86</a>'};this.showDialog(a)},showAgreeDivorce:function(){var e={title:"\u5904\u7406\u79BB\u5A5A\u7533\u8BF7",content:"\u60A8\u540C\u610F\u4E86\u79BB\u5A5A\u8BF7\u6C42\uFF0C\u8D34\u5427\u6C11\u653F\u5C40\u53D7\u7406\u6210\u529F",tip:"\u63D0\u793A:\u4ECE\u6B64\u4EE5\u540E\u6062\u590D\u5355\u8EAB\uFF0C\u4E00\u5B9A\u80FD\u627E\u5230\u5C5E\u4E8E\u4F60\u7684\u5E78\u798F\uFF01",btns:'<a class="btn-middle btn-default" j-marry-dialog-close-reload >\u6211\u77E5\u9053\u4E86</a>'};this.showDialog(e),this.dialog.element.on("click","[j-marry-dialog-close-reload]",function(){$.tb.location.reload()})},divorcePay:function(){var e=this,a={relation_id:e.marry.relation_id,user_name:e.marry.user_name,tbs:PageData.tbs};this.genOrder(a,function(){e.showSureProposeDivorce()})},checkMarriageStatus:function(){var e=this,a={relation_id:e.opt.userMarriage.relation_id,user_name:e.opt.userMarriage.user_name,tbs:PageData.tbs};$.get(this.URL.checkDivorceStatus,a,function(a){if(a)switch(a.no){case 0:break;case 2670009:e.showAlert("\u79BB\u5A5A\u7533\u8BF7\u8D85\u8FC72\u5929\uFF0C\u79BB\u5A5A\u6210\u529F! ")}})},genOrder:function(e){var a=this.requireInstance("tbmall/widget/TbeanSafeAjax"),r=this;this.showAlert("\u751F\u6210\u652F\u4ED8\u8BA2\u5355\u4E2D..."),a.post(this.URL.divorce,e,function(e){switch(e.no){case 0:var a=e.data,i=r.requireInstance("common/widget/Tdou/TdouViewPay",function(){r.showSureProposeDivorce()});i.createMain(a);break;case 2670003:r.showAlert("\u975E\u5DF2\u5A5A\u72B6\u6001\u4E0D\u80FD\u79BB\u5A5A");break;case 2670004:r.showRefuseProposeDivorce();break;case 2670005:r.showAlert("\u8FD9\u662F\u60A8\u7B2C\u4E8C\u6B21\u7533\u8BF7\u79BB\u5A5A\uFF0C\u79BB\u5A5A\u6210\u529F"),$.tb.location.reload();break;case 2672671:r.showAlert("\u8BE5\u7528\u6237\u6B63\u5728\u7533\u8BF7\u6C42\u5A5A\u4E2D");break;default:r.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5"),$.tb.location.reload()}})},showAlert:function(e,a){this.dialog&&(this.dialog.close(),this.dialog=null),e&&(this.dialog=new $.dialog({title:a?a:"\u79BB\u5A5A\u5904\u7406",html:'<p style="text-align:center" >'+e+"</p>"}))}}});_.Module.define({path:"ihome/widget/Userinfo",requires:["props/component/PropsApi","props/widget/Residual","common/widget/wallet_dialog","bawu/widget/complaintBarOwner","encourage/widget/forbidSpeech","common/widget/tcharge_dialog"],sub:{portraitRoot:{MIDDLE:"http://himg.baidu.com/sys/portraitm/item/",LARGE:"http://himg.baidu.com/sys/portraitl/item/"},initial:function(e){var i=this;this.iconGuide=$("#icon_guide"),this.addBtn=$(".j_icon_slot_buy"),this.isSuperMember=!!e.isSuperMember,this.isAnnualMember=!!e.isAnnualMember,this.memberLevel=e.memberLevel||0,this.user=e.user,this.scoreInfo=$(".userinfo_scores_num"),this.scoreTip=null,this.showAppraise(),this.bindEvent(),this.initForbidSpeech(),this.iconGuide&&this.iconGuide.length&&this.addBtn&&this.addBtn.length&&(this.iconGuide.css("left",parseInt($(this.addBtn.get(0)).css("left"))-28).show(),setTimeout(function(){i.iconGuide.hide()},5e3)),$("#ihome_tieba_report").on("click",function(e){PageData.user.is_login?i.reportDialog?i.reportDialog.showDialog():_.Module.use("bawu/widget/complaintBarOwner",{uname:PageData.current_page_uname},function(e){i.reportDialog=e,i.reportDialog.showDialog()}):(e.preventDefault(),_.Module.use("common/widget/LoginDialog"))}),this.autoCallIconBook()},showAppraise:function(){this.propsApi=this.use("props/component/PropsApi",{props_type:"0"}),this.residual=this.use("props/widget/Residual"),this.propsApi.showUI({wrap:$("ul.userinfo_appraise"),props:this.user.appraise||{},user_id:this.user.user_id,user_sex:this.user.personal_pronouns}),this.residual.showUI({wrap:$("#userinfo_wrap .userinfo_left_head"),props:this.user.appraise||{}})},bindEvent:function(){var e=this;this.iconGuide.on("click",function(){e.iconGuide.hide()}),$("#j_userhead").on("click",function(){var i=$(this).data("sign"),t=e.portraitRoot.LARGE+i,o=new $.modal({show:!0}),r=$('<div id="hd_avatar" />').appendTo("body"),a=function(){o.remove(),r.remove()};e.preLoadImg(t,function(t,o){var n,s=t,h=o;240>=s&&240>=h?(n="hd_avatar_240",t=240,o=240):(n="hd_avatar_480",t=480,o=480),r.css({marginLeft:-(t/2),marginTop:-(o/2)}).tbattr("class",n);var c=['<div class="hd_avatar_in">',"</div>",'<img id="hd_avatar_img" class="hd_avatar_img" style="margin-left: -'+s/2+"px; margin-top: -"+h/2+'px;" width="'+s+'px" height="'+h+'px" src="'+e.portraitRoot.MIDDLE+i+'" />','<a href="javascript:;" class="hd_avatar_close j_hd_avatar_close" />'].join("");$(c).appendTo(r),r.find(".j_hd_avatar_close").on("click",a)},function(){var t=r.find("#hd_avatar_img");t[0]&&r.find("#hd_avatar_img").tbattr("src",e.portraitRoot.LARGE+i)}),o.bind("click",a)}),$("#userinfo_wrap").on("click",".j_userinfo_scores_num",function(i){i.preventDefault(),e.requireInstance("common/widget/wallet_dialog").show()})},preLoadImg:function(e,i,t){var o=new Image;o.src=e;var r=function(){(o.width>0||o.height>0)&&(i(o.width,o.height),clearInterval(a),o.complete&&t(o.width,o.height))},a=setInterval(r,20);o.complete?t(o.width,o.height):o.onload=function(){t(o.width,o.height),o.onload=null}},hasLevel:function(){var e=Math.floor((new Date).getTime()/1e3);return this.user.medal_endtime>e},autoCallIconBook:function(){if("#manage_icon"==$.tb.location.getHash()){var e=$(".userinfo_honor"),i=e.find(".j_icon_slot");i.first().trigger("click")}},initForbidSpeech:function(){var e=this.requireInstance("encourage/widget/forbidSpeech",[{isSuperMember:this.isSuperMember,isAnnualMember:this.isAnnualMember,memberLevel:this.memberLevel}]),i=this;$("#userinfo_wrap").on("click","a.p-post-forbid-speech",function(){var t={authorName:i.user.homeUserName,authorId:i.user.user_id};return e.forbidSpeechConfirm(t,function(){$.tb.location.reload(!0)}),!1}).on("click","a.p-post-cancel-forbid-speech",function(){var t={authorName:i.user.homeUserName,authorId:i.user.user_id};return e.cancelForbidSpeech(t,function(){$.tb.location.reload(!0)}),!1}).on("click",".j-ihome-get-tdou",function(){i.requireInstance("common/widget/tcharge_dialog",{consumption_path:130,fr:"ihome"})})}}});window.__discarding&&__discarding("props/component/residual"),_.Module.define({path:"props/component/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},n=null,s="",t=["1070002","1070001"],a=0;a<t.length;a++)if(n=e[t[a]],n&&n.num>0&&n.end_time>Env.server_time/1e3){s=this.options[t[a]];break}return s},showUI:function(i){var e=i.wrap,n="",s=null,t=i.key||this.getResidualKey(i);t&&(n="residual_wrap residual_wrap_"+t,s=e.find(".residual_wrap"),s[0]?s.removeClass().addClass(n):(s=$('<div class="'+n+'"></div>'),e.append(s)))}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});window.__discarding&&__discarding("props/component/magic_props"),_.Module.define({path:"props/component/MagicProps",requires:["props/component/Residual","props/component/Guide"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"\u9B54\u62DC",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"\u9B54\u86CB",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("props/component/Residual"),this.guide=this.use("props/component/Guide")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},i=null,a=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)a=o[r],i={id:a,count:t[a]&&t[a].left_num||0},$.extend(i,this.propsOptions[a]),s.push(i),e[a]=i;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,i=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),a=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],a.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?a.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/></a>'):a.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),a.push('<p class="props_item_title">'),a.push("<span>"+s.name+"</span>"),s.count>0&&(a.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),a.push('<span class="props_item_num">'+s.count+"</span>")),a.push("</p>"),a.push("</li>");i.html(a.join("")),i.hide().appendTo(t.$wrap),t.$propsList=i},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn(),t.guide.initMagicGuide()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var i=$(this).data("id"),a=t.propsMap[i];return t.propsObj=a,a.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},i=$("#headinfo_wrap"),a=i.offset().left,s=i.offset().top,e=a+i.width(),o={marginLeft:a,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),i=t.find(".l_post"),a=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<i.length;n++)a=$(i[n]),s=a.getData(),this.doPostItem(a,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,i,a,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:i.author.id,postId:i.content.id,propsData:i.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=a+130,r.marginLeft=a,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=a+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),i=$('<div class="mask_layer mask_right"></div>'),a=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(i).append(a).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:i,bottomMask:a,leftMask:s,lightArea:e}},setMaskPosition:function(t,i,a,s){var e=this.maskMap;e.topMask.css({height:i}),e.rightMask.css({left:t+a,top:i,width:$("body").width()-(t+a),height:s}),e.bottomMask.css({top:i+s,height:$("body").height()-(i+s)}),e.leftMask.css({top:i,width:t,height:s}),e.lightArea.css({left:t,top:i,width:a,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(i){if(27==i.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(i){if(3==i.which){if(t.disabledMove)return!1;t.clear()}return!1});var i=50,a=$("body").width()-i,s=0;t.$maskWrap.mousemove(function(i){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=i.pageX,s>a&&(s=a),t.$bulletLayer.css({left:s,top:i.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=i.pageX>=o.marginLeft&&i.pageX<=o.marginRight&&i.pageY>=o.marginTop&&i.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],i.pageX>=e.marginLeft&&i.pageX<=e.marginRight&&i.pageY>=e.marginTop&&i.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,i=$('<div class="bullet_layer"><span class="bullet_layer_tip">\u53F3\u952E\u53D6\u6D88</span></div>');return i.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),i},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,i="/tbmall/post/useAppraiseProps",a={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(i,a,function(i){i&&0==i.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,i=".props_item_"+t;this.updatePropsBtnNum(t,i),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,i)},updatePropsBtnNum:function(t,i){var a=$("#tbui_aside_props_list "+i),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?a.find(".props_item_num").text(s):(a.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),a.find(".props_item_sign").remove(),a.find(".props_item_num").remove())},updatePostAreaNum:function(t,i){var a=this.areaObj.propsData||{};a[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(i);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,i=this.propsOptions[this.propsObj.id].flashOptions,a=($(window).height()-i.height)/2;a=150>a?150:a;var s=this.areaObj.jdom.offset().top-a;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var i=this,a=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==i.areaObj.propsType&&"1070002"==i.propsObj.id&&("ihome"==PageData.product?(a=100,s=-15):(a=60,s=-20),r=r-(r+o.marginLeft-i.areaObj.jdom.offset().left)+a,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-props/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}i.flashPool.push(e),i.$maskWrap.append(e),i.topzIndex=$.getzIndex(),i.$bulletLayer.css({"z-index":i.topzIndex})},buildPlusOne:function(){var t=this,i="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(i+="_png8"),i="/tb/static-props/img/"+i+".png";var a=$('<div class="props_plusone"><img src="'+i+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),a.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(a),a.animate({top:"-=100px",opacity:.8},800,"swing",function(){a.remove()})},clearPool:function(){for(var t=this,i=t.flashPool,a=null,s=0;s<i.length;s++)a=i.shift(),a.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,i={},a=null;i.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var i=t.flashPool.shift();i.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?a=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(a=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:a,key:t.propsObj.key})))}},window.MagicProps=i},showTomallDialog:function(){var t=this,i=new $.dialog({title:"\u63D0\u793A",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">\u4F60\u76EE\u524D\u6CA1\u6709\u53EF\u7528\u7684\u9053\u5177\u4E86\uFF0C\u5FEB\u53BB\u5546\u57CE\u8D2D\u4E70\u5427</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">\u53BB\u8D2D\u4E70>></a><div>',width:400,height:80});i.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var i='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',a=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(i,{href:$.tb.unescapeHTML(t)}),width:400,height:80});a.bind("onclose",function(){$.tb.location.reload()}),a.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});_.Module.define({path:"props/widget/Feedback",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions(),this.initCallbacks(),this.initData(),this.play()},initOptions:function(){this.options={1070001:{id:"1070001",key:"worship",name:"\u819C\u62DC",flashOptions:{width:250,height:220,marginLeft:120,marginTop:95}},1070002:{id:"1070002",key:"egg",name:"\u81ED\u9E21\u86CB",flashOptions:{width:410,height:260,marginLeft:195,marginTop:30}}}},initData:function(){for(var i=this.dataObj.appraise||{},t=null,e=null,a=[],n=["1070001","1070002"],s=0;s<n.length;s++)t=i[n[s]],t&&t.notice>0&&(e=this.options[n[s]],$.extend(e,t),a.push(e));this.playList=a},play:function(){var i=this.playList;i.length>0&&(i.sort(function(i,t){return t.notice!=i.notice?t.notice-i.notice:parseInt(t.id)-parseInt(i.id)}),this.index=0,this.buildFlash(),this.clearNotice())},buildFlash:function(){if(this.index<this.playList.length){var i=$('<div class="props_flash_wrap"></div>');$("body").append(i);var t=this.playList[this.index],e=this.getFlashData(t);i.css({width:e.width,height:e.height,left:e.marginLeft,top:e.marginTop,"z-index":e.zindex});{var a="/tb/static-props/swf/"+e.feedbackName+"?t=0101";new $.swf(a,{id:"props_flash_content",name:"props_flash_content",container:i,width:e.width,height:e.height,params:{wmode:"transparent"}})}t.wrap=i}},getFlashData:function(i){var t=i.flashOptions,e=0,a=0,n=0,s=0,o=PageData.product;switch(o){case"pb":case"frs":case"index":n=40,e=$("#user_info").offset().left,a=$("#user_info").offset().top;break;case"ihome":n=92,e=$("#userinfo_wrap").offset().left,a=$("#userinfo_wrap").offset().top}e=e-t.marginLeft+n,a=a-t.marginTop+s;var h=i.notice>1?"more":"single";return feedbackName="feedback_"+i.key+"_"+h+".swf",{key:i.key,feedbackName:feedbackName,width:t.width,height:t.height,marginLeft:e,marginTop:a,zindex:$.getzIndex()}},clearNotice:function(){var i="/tbmall/post/clearAppraiseNotice",t={type:0,tbs:PageData.tbs};$.tb.post(i,t,function(i){i&&0==i.no})},initCallbacks:function(){var i=this,t={};t.finishPlay=function(){i.playList[i.index].wrap.remove(),i.index++,i.buildFlash()},window.MagicProps=t}}});_.Module.define({path:"spage/component/Popframe",requires:[],sub:{defaultConfig:{top:0,left:0,width:"auto",height:"auto",clsName:"",html:"",wrap:"body"},initial:function(){try{}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"spage:component/popframe/popframe.js",method:"",ln:14}),e}},createFrame:function(e){var o=this,t=$('<div style="position:absolute;z-index:1000;"></div>');return o._config=$.extend(o.defaultConfig,e),t.css({top:o._config.top,left:o._config.left,width:o._config.width,height:o._config.height}).addClass(o._config.clsName).html(o._config.html).appendTo(o._config.wrap),e.isForumDir&&o.correctFramePosition(),t},correctFramePosition:function(){var e=$(".d-up-frame"),o=$(window).height(),t=e.height(),i=$(".f-d-item-hover").offset().top,c=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;if(i>=c){var n=i+t-(c+o);n>0&&(o>t?e.css("top",e.css("top").replace(/[^-\d\.]/g,"")-n):e.css("top",e.css("top").replace(/[^-\d\.]/g,"")-0+c-i))}else e.css("top",e.css("top").replace(/[^-\d\.]/g,"")-0+c-i)}}});