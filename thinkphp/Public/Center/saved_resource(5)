_.Module.define({path:"creativeplatform/widget/aopApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});
;_.Module.define({path:"creativeplatform/widget/normalApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});_.Module.define({path:"common/widget/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",clazz:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=this._option.clazz,_=['<div class="ui_card_wrap '+e+'" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return _},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/component/JsPager",sub:{_cfg:{},_amount:0,_center_pos:0,_jwrapper:null,_isNew:!0,_page_template:{normal:'<a href="#url#" index="#page#" #special#>#page#</a>',current:"<span #special#>#page#</span>",prev:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',prev_disable:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next_disable:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head_disable:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail_disable:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',status:'<span #special#><span class="js_pager_idx">#page#</span>/<span class="js_pager_total">#total#</span></span>'},_default_cfg:{container:$("body"),amount:10,isHtml:!1,current:1,total:10,mode:0,url:"##",openInNew:!1,showStatus:!1,statusPos:"head",showDisableItem:!1,template:{},classname:{wrapper:"tbui_js_pager",normal:"",current:"current",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}},initial:function(e){var a=this;if(a._isNew){a._cfg=$.extend({},a._default_cfg,e);var t=a._cfg;t.template=$.extend({},a._page_template,t.template),t.amount=parseInt(t.amount),t.current=parseInt(t.current),t.total=parseInt(t.total),a._amount=t.total>t.amount?t.amount:t.total,a._center_pos=parseInt((a._amount+1)/2)}else a._cfg=$.extend(a._cfg,e);a._amount<=1||(a._cfg.isHtml||a._render(),a._isNew=!1)},_render:function(){var e=this,a=e._cfg,t=[],r="";if(a.showStatus&&"head"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),a.current>1?(t.push(e._generateHtml("head",1)),t.push(e._generateHtml("prev",a.current-1))):a.showDisableItem&&(t.push(e._generateHtml("head_disable",1)),t.push(e._generateHtml("prev_disable",a.current-1))),e._amount){var n,s,l,p;n=a.current-parseInt((e._amount-1)/2),s=a.current+e._center_pos,1>n?(l=1-n,n=1,s+=l,s=s>a.total?a.total:s):s>a.total&&(l=s-a.total,s=a.total,n-=l,n=1>n?1:n);for(var i=n;s>=i;i++)p=i==a.current?"current":"normal",t.push(e._generateHtml(p,i))}if(a.current<a.total?(t.push(e._generateHtml("next",a.current+1)),t.push(e._generateHtml("tail",a.total))):a.showDisableItem&&(t.push(e._generateHtml("next_disable",a.current+1)),t.push(e._generateHtml("tail_disable",a.total))),a.showStatus&&"tail"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),r=t.join(""),e._isNew&&(e._jwrapper=$("<div>",{"class":a.classname.wrapper}),e._jwrapper.bind("click",function(t){return"A"==t.target.nodeName&&("0"!==$(t.target).tbattr("ok")&&e.trigger("pageChange",parseInt($(t.target).tbattr("index"))),0==a.mode)?!1:void 0}),!a.isHtml)){var u="string"==typeof a.container?$("#"+a.container):$(a.container);u.empty(),u.append(this._jwrapper)}return a.isHtml?r:(e._jwrapper.html(r),void 0)},_generateHtml:function(e,a,t){var r="",n=this._cfg;r=n.template[e],r=r.replace(/#page#/g,a),r=r.replace(/#url#/g,n.url.replace(/\{page\}/g,a)),"undefined"!=typeof t&&(r=r.replace(/#total#/g,t));var s="";return n.classname[e]&&(s+='class="'+n.classname[e]+'"'),n.openInNew&&(s+=" target=_blank"),-1!==e.indexOf("disable")&&(s+=' ok="0"'),r=r.replace(/#special#/,s)}}});_.Module.define({path:"common/widget/LoginDialog",sub:{_config:{apiOpt:{staticPage:"http://"+$.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",product:"tb",charset:PageData.charset?PageData.charset:"GBK",u:"",memberPass:!0,safeFlag:0},cache:!1,img:"",onLoginSuccess:function(t){t.returnValue=!1,$.stats.sendRequest("st_type=login_succeed&fr=tb0&st_pos="),$.tb.location.reload()},onSubmitStart:function(){$.stats.sendRequest("st_type=login_click&fr=tb0&st_pos=")},registerLink:"https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com",tangram:!0},initial:function(t,s,i){var a=this,o=1;if(a._config.apiOpt.u="string"==typeof t&&""!=t?t:$.tb.location.getHref(),"string"==typeof s){switch(s){case"userBar":o=1;break;case"editor1":case"lzl":o=2;break;case"editor":o=3;break;case"lzonly":o=4;break;case"ilike":o=5;break;default:o=1}a._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+o+".png"}else a._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+o+".png";PageData&&(a._config.apiOpt.isQuickUser=PageData.is_quick_user||0),i&&(a._config.onLoginSuccess=i),function(t){var s="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();t.JsLoadManager.use(["http://passport.bdimg.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(s/6e4),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(s/6e4)],function(){t.passPopInstance||(t.passPopInstance=passport.pop.init(a._config)),t("#passport-login-pop").find(".pass-login-pop-img img").tbattr("src",a._config.img),t.passPopInstance.show(),setTimeout(function(){t("#passport-login-pop").find("input.pass-button-submit").tbattr("alog-alias","login")},1e3)},!0,"utf-8")}(window.jQuery)}}});_.Module.define({path:"common/widget/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>Env.server_time/1e3?r.url:"http://tb.himg.baidu.com/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",n=null,o={hasFrame:!1,stylestr:""};return i.end_time>Env.server_time/1e3&&(e=i.props_id,n=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],o={hasFrame:!0,stylestr:n.join(";")}),o}}});_.Module.define({path:"user/widget/userApi",requires:[],sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkOverdueSuperMembershipOf:function(e){return 2==$.getPageData("mParr_props.level.props_id")&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<1*new Date},checkSuperMemberShipOf:function(e){return 2===this.getUniversalMemberLevelOf(e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"user/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl","IconsBookCommon"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.use("IconsBookCommon"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/userApi",[])},getCrownIconClass:function(e,i){var n=$.getPageData("vipInfo.v_level",0,e),t=this.userApi.getUniversalMemberLevelOf(e),r=$.getPageData("vipInfo.v_status",0,e);r=parseInt(r,10),t=3===r?3:t;var a="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(e))return this.overdueSuperIconList[n];if(0===t)return a="icon-crown-super-non"}switch(t){case 0:a=this.iconClassList[t];break;case 1:a=this.iconClassList[t];break;case 2:case 3:a=this.iconClassList[t][n]}return a},getPreIconHtml:function(e,i,n){var t={};t.mParr_props=e,i=i||t;var r,a=["\u8D34\u5427\u4F1A\u5458","\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"],o="",s=Math.round((new Date).getTime()/1e3),c=$.getPageData("forum.forum_id",0);this.userApi.checkSingleForumMembershipOf(i,c)&&(o='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672C\u5427\u4F1A\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>');var l="";return e&&e.level&&e.level.end_time>s?(l=this.getCrownIconClass(i),o='<div class="pre_icon_wrap pre_icon_wrap_theme1">',r=e.level.props_id,o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</div>"):n&&(l=this.getCrownIconClass(i,!0),o='<span class="pre_icon_wrap pre_icon_wrap_theme1">',r=$.getPageData("level.props_id",0,e),o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</span>"),o},getTbvipIconHtml:function(e,i,n){i=i?i:1,n=n?n:"";var t="";return e&&e.type&&(t='<span class="tbvip_icon_wrap tbvip_icon_wrap_theme'+i+" "+n+'"><a class="icon_tbvip icon_tbvip_type'+e.type+'" href="/tbvip/index"target="_blank" title="'+e.intro+'"></a></span>'),t},getIconsHtml:function(e,i,n){var n=n?n:5,t=e.new_iconinfo,r=0;for(var a in t)r++;var o='<span class="icon_wrap  icon_wrap_theme1">',s=0;if(!t){var c=e.iconinfo;if(c){var l=c[0];o+=this._getOldHtml(l,1)}}for(var _ in t){var p=t[_];if(s==n)break;if($.isEmptyObject(p)){if("1"==_){var c=e.iconinfo;if(!$.isEmptyObject(c)){var l=this._getReplaceIcon(c,t);if(!l)continue;o+=this._getOldHtml(l,1),s++}}}else this.common.isShowDurationIcon(p)&&(o+=this._getIconHtml(p,1),s++)}return o+="</span>"},_getReplaceIcon:function(e,i){if($.isEmptyObject(i))return e[0];for(var n=0;n<e.length;n++){var t=e[n];if(!this._judgeIconInNewiconinfo(i,t))return t}return null},_judgeIconInNewiconinfo:function(e,i){if($.isEmptyObject(e))return!1;if($.isEmptyObject(i))return!1;for(var n in e){var t=e[n];if(t&&t.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94C1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_2:"\u94DC\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_3:"\u94F6\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_4:"\u91D1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_coreuser_1:"\u8D34\u5427\u6838\u5FC3\u7528\u6237",is_verify_1:"\u767E\u5EA6\u8D34\u5427\u4F01\u4E1A\u5E73\u53F0\u8BA4\u8BC1",user_type_1:"\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1",is_battle_1:"\u8D34\u5427\u62F3\u738B",is_welfare_1:"\u798F\u5229\u5370\u8BB0"},_getOldHtml:function(e,i){var n="",t=e.sprite[e.value];if(!t)for(var r in e.sprite){if(e.sprite[r]&&(0!=e.value||"meizhi_level"==e.name)){t=e.sprite[r];break}return n}var a=e.icon+"?stamp="+t.split(",")[0];switch(background='style="background: url('+a+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+a+',sizingMethod=scale); background-size: 14px 14px"',e.name){case"meizhi_level":var o=e.value;o=o?o:0,o>=2&&(o-=2,n+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+o+'"></span></a>');break;case"is_member":n+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7C89\u4E1D\u4F1A\u5458"></a>';break;default:n+=e.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[e.name+"_"+e.value]+'"  locate="'+e.name+"_"+e.value+'"></span>'}return n},_getIconHtml:function(e,i){var n,t,r,a,o,i=i||1,s=50,c="",l="http://tb1.bdstatic.com/tb/cms/com/icon/";if(n=e.sprite[e.value],!n)for(var _ in e.sprite){if(e.sprite[_]&&(0!=e.value||"meizhi_level"==e.name)){n=e.sprite[_];break}return c}t=n.split(","),r=t[0],a=t[1];var p=l+e.category_id+"_"+this._imgSize[i]+".png?stamp="+r;switch(o='style="background: url('+p+") no-repeat -"+a*s+"px  -"+(i-1)*s+'px;"',e.name){case"meizhi_level":var u=e.value;u=u?u:0,u>=2&&(u-=2,c+="<a "+o+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+u+'"></span></a>');break;case"is_member":c+="<a "+o+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(e.title_url)c+="<a "+o+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>';else{{e.title}c+="<span "+o+' title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"></span>'}}return c}}});
;_.Module.define({path:"user/widget/Icons/IconsBookControl",requires:["IconsBookView","IconsBookTip","IconCard","IconsBookMessagebox","IconsBookGetIcon"],sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.use("user/widget/Icons/IconsBookView");var e=PageData.category_info,t=e.category_list||[{category_id:"101",category_name:"\u8DB3\u7403"},{category_id:"102",category_name:"\u661F\u5EA7"},{category_id:"104",category_name:"\u5176\u4ED6"}];o.defaultCategoryId=o._getDefaultCategoryId(e.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var e=this;e._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){e.__timeoutId&&clearTimeout(e.__timeoutId),e.closeAllCard(),e._icon_user_action="buy_slot",e._target_ele=$(this),e._selected_icon_name="";var o=$(".j_icon_slot").length;return e._slot_no=1,e.buySlot({add_slot_no:o+1,price:e._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),e._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return e.__timeoutId&&clearTimeout(e.__timeoutId),e.__timeoutId=setTimeout(function(){e._messagebox&&e._messagebox.hideBox()},200),!1}),e._wrap.delegate(".j_icon_slot","click",function(t){e.closeAllCard(),e._setIconRefresh($(this)),e._icon_user_action="replace_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot"),a=$(this).tbattr("data-name");e._selected_icon_name=a,e._slot_no=_;var i="",n={};for(var c in n)n[c].name==a&&(i=n[c].category_id);e.initIconBook({slot_no:_,category_info:o,icon_id:a,action:"replace_icon",category_id:i},$(this)),t.preventDefault()}),e._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),e.closeAllCard(),e._selected_icon_name="",e._setIconRefresh($(this)),e._icon_user_action="buy_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot");e._slot_no=_;e.initIconBook({slot_no:_,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),e._wrap.delegate(".j_icon_slot","hover",function(o){var e=$(this);if(!e.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),_=($(this).tbattr("data-slot"),{});if(_){var a=null;for(var i in _)if(_[i].name==t){a=_[i];break}if(a&&a["level_"+a.value]){var n=a["level_"+a.value],c="url("+n.icon_1+") no-repeat",r=o||event;if("mouseenter"==r.type){var s={background:c},l=e.css("background");l||(l=e[0].style.background),e.data({bg:l}),e.css(s),e.addClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=e.data("bg"),s={background:l};e.css(s),e.removeClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,e){var t=this;t._messagebox||(t._messagebox=t.use("user/widget/Icons/IconsBookMessagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,e)},initIconBook:function(o,e){var t=this,_=o.category_info;t.closeIconBook();var a=t._view.getTabItem(_),i={content:a,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:e,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.use("user/widget/Icons/IconCard",i),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var n=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(n,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId));$.stats.track("\u5370\u8BB0\u4E2D\u5FC3\u6D6E\u5C42","icon_system")},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var e=$(this).index();o._showTab(e),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,e){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),e=e||t._selected_icon_name,t._loadTabContent(o,e),t._current_tab_index=e},_loadTabContent:function(o,e){var t=this,_='<div class="icon_book_error">\u6B63\u5728\u52AA\u529B\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>';$("#tab_content_"+o).html(_);var a={ie:"utf-8"},i=$("#tab_head_"+o).tbattr("data-categoryId");a.tbs=PageData.tbs,a.category_id=i,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:a,dataType:"json"}).success(function(_){if(_&&0===_.no){var a=_.data,n=a.icon_info,c=t._view.getTabContent(n,e,i);$("#tab_content_"+o).html(c),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=a.icon_info}else{var c='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$("#tab_content_"+o).html(c),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.use("user/widget/Icons/IconsBookTip",[o]));var e=$("#icon_book_wrap");e.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),e.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.normal||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}),e.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),e.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.advanced||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}}),e.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var e=this,t=$(".icon_book_tab_head li"),_=0;_<t.length;_++)if($(t[_]).tbattr("data-categoryId")==o)return _;return e._getDefaultIndex(e.defaultCategoryId)},_getDefaultCategoryId:function(o){var e="";for(var t in o)e=t;return e},_getDefaultIndex:function(o){for(var e=$(".icon_book_tab_head li"),t=0;t<e.length;t++)if($(e[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var e=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&e.bindArrowScrollEvent("icon_wrap");var _=$("#tab_content_"+o+" .collect_icon_wrap");_&&_.length>0&&e.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var e=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){e._move("left",o),e._tip&&e._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){e._move("right",o),e._tip&&e._tip.hideTip()})},_move:function(o,e){var t=this,_=0,a=$($(".tab_body_item_active ."+e+" .icon_view")[0]).tbattr("total-col");switch(a=parseInt(a),o){case"left":_=t._moveLeft(a,e);break;case"right":_=t._moveRight(a,e)}_&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:_},300);var i=55*a;_&&(_=Math.abs(parseInt(_)),_+550>=i?($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==_&&($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,e){var t=0,_=o;if(!(10>=_)){var a=55*_,i=$(".tab_body_item_active ."+e+" .icon_list").css("left"),n=Math.abs(parseInt(i));n%55!=0&&(n=n%55*55);var c=a-n;if(c>550)return t=n+165,"-"+t+"px"}},_moveRight:function(o,e){var t=0,_=o;if(!(10>=_)){var a=$(".tab_body_item_active ."+e+" .icon_list").css("left"),i=parseInt(a);if(!(i>=0))return t=Math.abs(i)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}});
;_.Module.define({path:"user/widget/Icons/IconsBookGetIcon",requires:["IconsBookCommon"],sub:{_dialog:null,initial:function(){this.common=this.use("IconsBookCommon")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},n=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),n._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return i._handleError(),void 0;var n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;if(!n.icon_info)return i._handleError(),void 0;i.showOneIcon(n.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,n=i._getOneIconTpl(o);i._init(n),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),n={styleBg:i,iconTitle:o.title},s=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(s,n)}},showDurationIcon:function(o,i){var n=[];n.push(o),this.showIconList(n,i,"duration")},showIconList:function(o,i,n){var s=this,t={hide_btn:!1,close_callback:function(){},close_time:0};t=$.extend(t,i);var c=s._getIconListTpl(o,t.hide_btn,n);s._init(c),s.show(),t.close_time&&parseInt(t.close_time)>0&&setTimeout(function(){s._dialog.close()},parseInt(t.close_time)),t.close_callback&&"function"==typeof t.close_callback&&s._dialog.onclose(function(){t.close_callback()})},_getIconListTpl:function(o,i,n){var s=this,t=PageData.user.portrait;if(o||$.isArray(o)){for(var c=[],a=[],e="",_=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>"].join(""),l=0;l<o.length;l++){var d=s._getIconFormatInfo(o[l],o.length);c.push(d.iconTitle),a.push(d.iconTpl)}if(c=c.join(","),a=a.join(""),n&&"duration"==n){var r=this.common.getIconExpired(o[0]);r>-1&&(e="<span>\u6709\u6548\u5929\u6570\uFF1A"+r+"</span><br>")}var g=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86'+c+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",_,'<p class="icon_book_go_home">',e,'<a href="/home/main?id='+t+'&fr=icon" target="_blank">\u53BB\u6211\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u67E5\u770B>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return g}},_getIconFormatInfo:function(o,i){var n=this._getIconStyle(o),s={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+n+'"></div>',styleBg:n,iconTitle:o.title};return s},_getIconStyle:function(o){var i=0,n=0,s="http://tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",t=o.sprite[o.value].split(","),c=50,a=t[0],e=t[1];i=2*c,n=e*c;var _="background: url("+s+"?stamp="+a+") no-repeat -"+n+"px -"+i+"px;";return _},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672A\u77E5\u9519\u8BEF</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65B0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}});
;_.Module.define({path:"user/widget/Icons/IconsBookTip",requires:["IconCard","IconsBookMessagebox","IconsBookCommon"],sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.use("IconsBookCommon"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var n=this,t=$("#icon_book_tip");0==t.length&&$(".icon_card_wrap").append(this._getWrapTpl()),t=$("#icon_book_tip"),n._setContent(o);var e=$(".j_icon_book_tip .j_tip_up_arrow"),s=i.position(),a=s.top,c=s.left-5,r=i.parents(".icon_view"),p=r.position(),l=parseInt(p.left)+15,d=a+106;i.parents(".collect_wrap").length>0&&(d+=146),t.css({display:"block",visibility:"visible",top:d+"px",left:l+"px","z-index":2e4});var u=parseInt(c)+25;e.css({left:u+"px"}),n._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6D88\u8017"+o.icon_info.price+"T\u8C46"),n._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,t=0,e=PageData.user.Parr_scores;e&&(t=e.scores_other+e.scores_money);var s=-1;if(s=n._icon_data.price?n._icon_data.price:n._icon_data.icon_info.price,s>0&&0>t-s&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(n._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?n._replaceIcon4FirstSlot(o):n._replaceIcon4OtherSlot(o);else if(i){var a=$("#j_icon_book_action_btn em");a.length>0&&a.html("\u8D2D\u4E70\u4E2D"),n._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,n,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;i._refreshAfterReplace(n.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):$.dialog.alert("\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.use("user/widget/Icons/IconsBookMessagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,n,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,n={ie:"utf-8"};n.tbs=$.getPageData("tbs"),n.icon_name=o.icon_id,n.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:n,dataType:"json"}).success(function(o){o&&0===o.no?i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3TIP",function(o){var t=$.getPageData("user.Parr_scores",{});t.scores_total=$.getPageData("data.data.user_info.scores",0,o),console.log(o),$(".j_userinfo_scores_num").html(t.scores_total);var e=$(".icon_box_place[data-id="+n.icon_name+"]");e.removeClass("icon_not_use"),e.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip()}):o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):$.dialog.alert("\u7CFB\u7EDF\u9519\u8BEF, \u8BF7\u7A0D\u5019\u518D\u8BD5")})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8C46\u4E0D\u8DB3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,n=o.icon_info,t=n.sprite[n.value].split(","),e=50,s=t[0],_=t[1],a=0,c=_*e,r="http://tb1.bdstatic.com/tb/cms/com/icon/"+n.category_id+"_"+i.spriteImgSize+".png",p=" background:url("+r+"?stamp="+s+") no-repeat -"+c+"px -"+a+"px;",l="",d=i.common.getIconExpired(n);d>-1&&(l='<span style="margin-left: 20px;">\u5269\u4F59\u65F6\u95F4\uFF1A'+d+"\u5929</span>");var u=n.title,b=n.intro,g=n.intro_url,m={background_img:p,desc_title:u+l||"\u5370\u8BB0",desc_detail:b||"",desc_link:g||"http://tieba.baidu.com/",btn_value:o.in_use?"\u66FF\u6362":"\u8D2D\u4E70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==n.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(m.button_display="none"),"none"==m.button_display&&(m.in_use_display="display",m.in_use_text="\u4F7F\u7528\u4E2D",m.price_info_display="none"),0==o.in_use&&0==n.price&&(m.in_use_text="\u6D3B\u52A8\u83B7\u53D6");var v=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8BE6\u60C5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(v,m)},_judgeCommIconInSlot:function(o){var i={};for(var n in i){var t=this.common.isShowDurationIcon(i[n]);if(i[n].name==o&&t)return!0}return!1}}});
;_.Module.define({path:"user/widget/Icons/IconsBookView",requires:["IconsBookTip","IconsBookCommon"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96C6\u9F5032\u4E2A\u56FD\u65D7\u5370\u8BB0\u5956\u52B1\u3010\u8D34\u5427\u4E16\u754C\u676F\u3011\u5370\u8BB0",102:"\u96C6\u9F5012\u4E2A\u661F\u5EA7\u5370\u8BB0\u53EF\u4EE5\u83B7\u5F9712\u4E2A\u9EC4\u91D1\u7248\u661F\u5EA7\u5370\u8BB0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),n=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),a="",c="",l=0;for(var e in o)l++;var r=0;for(var e in o){var s={index:r,category_id:e,title:o[e].name,separator_cls:r==l-1?"":"space"};r++,a+=$.tb.format(t,s),c+=$.tb.format(n,s)}var _={tabHead:a,tabContent:c},d=i._getTabPanelTpl();return $.tb.format(d,_)},getTabContent:function(o,i,t){var n="",a="",c=this,l=0,e=0;if(o=o||{},o.normal&&!o.advanced){var r=o.normal||[],s=r.length;return l=5,e=1>=s/50?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a}if(o.advanced&&o.advanced){var r=o.normal||[],_=o.advanced||[],s=r.length,d=_.length,v="";return l=2,e=1>=s/20?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a+=c._getDownArrowHtml(),e=1>=d/20?10:s%2==0?Math.floor(d/2):Math.floor(d/2)+1,v+=c._getPositionIconListHtml(_,e,null,t),a+=c._getAdvancedIconWrap(null,l,e,v,t),c.tabIconsContentCongfig.adv={row:l,col:10,total_col:e},a}return a},_getCommIconWrap:function(o,i,t,n){var a={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:n,total_col:t},c=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(c,a)},_getAdvancedIconWrap:function(o,i,t,n,a){var c=this,l={title:c._collect_icon_title[a],arrow_visiblity:t>10?"visible":"hidden",icon_list:n,total_col:t},e=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(e,l)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,n){for(var a="",c=this,l=!1,e=o.length,r=0,s=0,_=0;e>_;_++){r=Math.floor(_/i),s=_%i;var d=55*r,v=55*s;l=t&&t==o[_].name?!0:!1;var b="";b=0==o[_].is_advanced?c._getCommonIconTpl(o[_],d,v,n,l):c._getAdvIconTpl(o[_],d,v,n),a+=b}return a},_getCommonIconTpl:function(o,i,t,n,a){var c=this,l=o.sprite[o.value].split(","),e="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+c.spriteImgSize+".png",r=50,s=l[0],_=l[1],d=0,v=_*r,b="background: url("+e+"?stamp="+s+") no-repeat -"+v+"px -"+d+"px;",p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:a?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};c._judgeCommIconInSlot(o)&&(p.selected_cls="icon_selected");var u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,n={};for(var a in n){if("1"==a&&$.isEmptyObject(n[a])){var c=this._getOldIconinfoInSlot();if(t==c)return!0}if(n[a].name==t){i.common=this.use("IconsBookCommon");var l=i.common.isShowDurationIcon(o);return l?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,n){var a=this,c=o.sprite[o.value].split(","),l=50,e=c[0],r=c[1],s=2*l,s=0,_=r*l,d="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+a.spriteImgSize+".png",v="background: url("+d+"?stamp="+e+") no-repeat -"+_+"px -"+s+"px;",b=o.is_collected,p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:v},u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var n=0;n<o.length;n++)if(!o[n].in_use){t=!0;break}t=12==n&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}});
;_.Module.define({path:"user/widget/Icons/IconsBookMessagebox",requires:["IconCard","IconsBookCommon"],sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.use("IconsBookCommon")},showBox:function(o,i){var s=this;s._showBox(i),s.generatorBuySlot(o),s._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,s=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(s),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,s,n){var _=this;setTimeout(function(){n.closeTip()},0),_._showBox(i);var c=_._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(c),$(".icon_book_msgbox .ui_btn").click(function(){s.call(n,o)})},showBuyIconBox:function(o,i,s,n){var c=this;setTimeout(function(){n.closeTip()},0),c._showBox(i);var e=c._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,e=PageData.user.Parr_scores;if(e&&(i=e.scores_other+e.scores_money),i-o.icon_info.price<0){var t=c._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(t),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}s.call(n,o.icon_info,function(){var o=c._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,s=0,n=$.getPageData("user.Parr_scores",{});n&&(s=n.scores_other+n.scores_money+n.scores_fetch);var c=o.price||o.icon_info.price;if(c>0&&0>s-c){var e=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(e),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}var t={ie:"utf-8",slot_no:o.add_slot_no||1};t.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no)i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3\u5361\u7247",function(o){var s=i._addSuccess();$(".icon_book_msgbox_body").html(s),i._refreshSlotList();var n=$.getPageData("data.data.user_info.scores",0,o);i._updateTdouAccount(0,n,0)});else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var s='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$(".icon_book_msgbox_body").html(s),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,s){var n=PageData.user.Parr_scores;n&&(n.scores_other=o,n.scores_money=i,n.scores_fetch=s,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var s=i._getTpl(),n={content:s,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.use("user/widget/Icons/IconCard",n),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,s='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70B9\u51FB\u6DFB\u52A0\u5370\u8BB0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(s),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u5370\u8BB0\u63D2\u69FD</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u65B0\u5370\u8BB0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5FEB\u53BB\u56FE\u9274\u770B\u770B\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8BB0\u66FF\u6362\u6210\u529F</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786E\u5B9A</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8C46\u4E0D\u8DB3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7ACB\u5373\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},s=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u8017#{price}T\u8C46\u5F00\u542F\u5370\u8BB0\u63D2\u69FD</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5F00\u542F\u540E\u514D\u8D39\u66F4\u6362\u5370\u8BB0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5F00\u542F</em></span></a>',"</div>"].join("");return $.tb.format(s,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,s=o.old_icon_info,n=o.icon_info,_=this.common.isShowDurationIcon(s),c=_?i._getIconBackground(s):"",e=i._getIconBackground(n),t={old_background:c,background:e},a=['<div class="icon_msgbox_title">\u70B9\u51FB\u66FF\u6362\u5F53\u524D\u5370\u8BB0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66FF\u6362</em></span></a>',"</div>"].join("");return $.tb.format(a,t)},_getIconBackground:function(o){var i=0,s=0,n="http://tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var _=o.sprite[o.value].split(","),c=50,e=_[0],t=_[1];i=0,s=t*c;var a="background: url("+n+"?stamp="+e+") no-repeat -"+s+"px -"+i+"px;";return a}return""},_getBuyIconTpl:function(o){var i=this,s=i._getIconBackground(o.icon_info),n={price:o.icon_info.price,background:s},_=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u801710000T\u8C46\u8D2D\u4E70\u8BE5\u5370\u8BB0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8D2D\u4E70</em></span>","</a>","</div>"].join("");return $.tb.format(_,n)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var s=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,s=$(".icon_wrap .icon_slot_refresh");s&&(s=s.parent()),i._showBox(s);var n=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(n),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var _=o.getControl();_&&_.closeIconBook()}}}});
;_.Module.define({path:"user/widget/Icons/IconsBookCommon",requires:["common/widget/Tdou/TdouViewPay"],sub:{initial:function(){},isDurationIcon:function(e){return e?4==e.type?!0:!1:!1},getIconExpired:function(e){var n=-1;if(!e)return n;var r=e.type,t=e.end_time,o=Env.server_time/1e3;return 4==r&&t>=o&&(n=((t-o)/86400).toFixed(1)),n},redirect:function(e,n,r){e=e||{},e.from=n,e.chargeType="platform";var t=this;t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&r(e)}),t.payment.createMain(e)},isShowDurationIcon:function(e){if(!e)return!1;var n=e.type,r=e.end_time,t=Env.server_time/1e3;return 4!=n?!0:r>=t?!0:!1}}});
;_.Module.define({path:"user/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="icon_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/wallet_dialog",requires:["common/component/JsPager","common/widget/LoginDialog","common/widget/UserHead","user/widget/Icons"],sub:{isMember:!1,dialog:null,$content:null,$historyListWrapper:null,$historyEmpty:null,timestamp:+new Date,api:{expend:"/tbmall/mall/getConsumeOrder",income:"/tbmall/mall/getIncomeOrder",charge:"/tbmall/mall/getPayOrder"},listPage:{expend:0,income:0,charge:0},objGet:function(i,e,s){s=void 0===s?null:s,e=e.split(".");var t,a=i;for(t in e){if(!("object"==typeof a&&e[t]in a))return s;a=a[e[t]]}return a},objSet:function(i,e,s){return i[e]=s,i},initial:function(){var i=this;i.icon=i.requireInstance("user/widget/Icons"),i.initUi(),i.initHistory(),i.initEvent(),i.initTrack()},show:function(i){var e=this;e.options=i||{},e.dialog.show(),e.$content.trigger("show")},hide:function(){this.dialog.hide()},initUi:function(){var i,e=this;$.ajax({url:e.api.expend,type:"GET",data:{pn:1,c:5,t:e.timestamp},dataType:"json",async:!1,success:function(s){if(0===s.no){var t=e.objGet(s,"data.user",{}),a=e.requireInstance("common/widget/UserHead"),n=e.objGet(t,"Parr_props.level",{}),o=e.objGet(n,"end_time",0),r=e.objGet(n,"props_id",0);t.scoresTotal=e.objGet(t,"Parr_scores.scores_total",0),e.isMember=r&&o>+new Date/1e3,t.isMember=e.isMember?"ismember":"isnotmember",t.memberLevel="ismember"===t.isMember?r:2,t.userIcon=e.icon.getPreIconHtml(t.mParr_props,t,!0),t.memberExpire="",t.isMember&&(o=new Date(1e3*o),t.memberExpire=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("/")),t.homeUrl="/home/main?ie=utf-8&un="+encodeURIComponent(e.objGet(t,"user_name_utf8")),t.avatarStyle=a.getHeadFrameStyle(t,80).stylestr,t.avatarFrame=t.avatarStyle?"with":"not-with",t.avatar=a.getHeadUrl(t),t.iconinfo="";var d=["/tbmall/tshow?tab=detail&c=0","\u5C0A\u8D35\u8EAB\u4EFD, \u5C0A\u8D35\u6807\u8BC6","/tbmall/tshow?tab=detail&c=112","\u4E2A\u6027\u94ED\u724C, \u72EC\u4E00\u65E0\u4E8C","/tbmall/tshow?tab=detail&c=110","\u70AB\u9177\u88C5\u626E, \u95EA\u4EAE\u5934\u50CF","/tbmall/tshow?tab=detail&c=103","\u8DA3\u5473\u53D1\u5E16, \u4E2A\u6027\u6C34\u5370","/tbmall/tshow?tab=detail&c=108","\u9B54\u6CD5\u9053\u5177, \u7B7E\u5230\u795E\u5668"];for(i=0;i<d.length/2;i++)t.iconinfo+=_.template('<a href="<%= url %>" title="<%= title %>" target="_blank">     <span class="wd-icon-new hidden image-radius">NEW</span>     <span class="wd-icon image-round" style="background-position: <%= bgPosition %>">&nbsp;</span> </a>')({url:d[2*i],title:d[2*i+1],bgPosition:"-"+36*i+"px 0"});t.setpass=t.setpass?"\u4FEE\u6539\u5BC6\u7801":"\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801",t.umoneyLimit="\u6B63\u5728\u67E5\u8BE2...";var l=_.template('<div class="wallet-dialog-main clearfix">     <div class="wd-userinfo-wrapper">         <div class="wd-userinfo <%= user.isMember %>">             <div class="wd-member">                 <div class="wd-avatar-wrapper wd-avatar-<%= user.avatarFrame %>-frame">                     <a class="wd-avatar" href="<%= user.homeUrl %>" style="<%= user.avatarStyle %>">                         <img src="<%= user.avatar %>" alt="avatar"/>                     </a>                 </div>                 <div class="wd-iconinfo-wrapper">                     <div class="wd-username-wrapper">                         <%= user.userIcon %>                         <span class="wd-username text-overflow"><%= user.user_name_utf8 %></span>                         <span class="wd-welcome wd-<%= user.isMember %>">\u5C0A\u8D35\u4F1A\u5458, \u60A8\u597D!</span>                         <span class="wd-welcome wd-not-<%= user.isMember %>">\u8D34\u5427\u7528\u6237, \u60A8\u597D!</span>                     </div>                     <div class="wd-icon-wrapper"><%= user.iconinfo %></div>                     <div class="wd-memberinfo-wrapper">                         <div class="wd-member-icon image-radius">                             <i class="icon-vip<%= user.memberLevel %>-16"></i>                             <span class="wd-<%= user.isMember %>">\u7EED\u8D39\u4F1A\u5458</span>                             <span class="wd-not-<%= user.isMember %>">\u5F00\u901A\u4F1A\u5458</span>                         </div>                         <div class="wd-member-intro">                             <span class="wd-<%= user.isMember %>">\u5230\u671F: <%= user.memberExpire %></span>                             <span class="wd-not-<%= user.isMember %>">\u5F00\u901A\u4F1A\u5458\u5373\u4EAB\u53D7\u4EE5\u4E0A\u7279\u6743</span>                         </div>                     </div>                 </div>             </div>             <div class="wd-tbean">                 <h2>\u6211\u7684T\u8C46:</h2>                  <div class="wd-tbeaninfo-wrapper">                     <div class="wd-tbean-num"><i class="icon-tbean"></i><%= user.scoresTotal %></div>                     <button class="wd-btn-tbeanget image-radius">\u83B7\u53D6T\u8C46</button>                     <a href="/tbmall/pass/set" target="_blank"><%= user.setpass %></a>                 </div>             </div>         </div>     </div>     <div class="wd-history-wrapper">         <div class="wd-fast-forward hidden"></div>         <div class="wd-history">             <div class="wd-history-type-wrapper">                 <div class="expend active" data-type="expend">\u652F\u51FA\u8BB0\u5F55</div>                 <div class="income" data-type="income">\u6536\u5165\u8BB0\u5F55</div>                 <div class="charge" data-type="charge">\u5145\u503C\u8BB0\u5F55</div>             </div>             <div class="wd-list-wrapper">                 <div class="wd-list-empty">                     <div class="wd-empty-content">                         <div>                             <h2 class="wd-empty-title">\u60A8\u8FD8\u6CA1\u6709<span class="wd-empty-type">\u652F\u51FA\u8BB0\u5F55</span>\u54E6</h2>                         </div>                     </div>                 </div>                 <div class="wd-list-category expend active hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-list-category income hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-list-category charge hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-history-more">                     <a href="javascript:">\u67E5\u770B\u66F4\u591A\u8BB0\u5F55>></a>                 </div>             </div>         </div>     </div> </div>')({user:t});e.dialog=new $.dialog({title:"\u6211\u7684T\u8C46\u94B1\u5305",html:l,show:!1,width:699}),e.dialog.element.addClass("wallet-dialog"),e.$content=e.dialog.element.find(".dialogJcontent"),e.$historyEmpty=e.$content.find(".wd-list-empty"),e.initPager("expend",e.objGet(s,"data.total_count",0),!0),e.parseExpendList(e.objGet(s,"data.order_list",0))}else 11e4===s.no&&(e.dialog.hide(),e.requireInstance("common/widget/LoginDialog",[]))}})},initUmoney:function(){var i=this,e='<a target="_blank" href="/f?ie=utf-8&kw=%B0%D9%B6%C8%D3%D0%C7%AE%CF%FB%B7%D1%BD%F0%C8%DA">',s="";$.get("/tbapp/umoney/queryQualification",{},function(t){0===t.no?0!==t.data.status?$.get("/tbapp/umoney/queryUserInfo",{},function(t){0===t.no&&(t=t.data.data,s=1===t.status?e+"\u7533\u8BF7</a>\u6210\u4E3A\u767E\u5EA6\u6709\u94B1\u7528\u6237, \u5C0A\u4EAB\u65E0\u9650\u7279\u6743":2===t.status?"\u60A8\u7684\u7533\u8BF7\u6B63\u5728\u529E\u7406\u4E2D":3===t.status?e+"\u767E\u5EA6\u6709\u94B1\u53EF\u7528\u989D\u5EA6: "+t.credit+"\u5143</a>":"\u5E10\u6237\u5DF2\u5931\u6548, \u8BF7\u91CD\u65B0"+e+"\u7533\u8BF7</a>",i.$content.find(".wd-umoney-limit").html(s))},"json"):i.$content.find(".wd-umoney-limit").html(e+"\u7533\u8BF7</a>\u6210\u4E3A\u767E\u5EA6\u6709\u94B1\u7528\u6237, \u5C0A\u4EAB\u65E0\u9650\u7279\u6743"):11e4===t.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))})},initHistory:function(){var i=this;$.get(i.api.income,{pn:1,c:5,t:i.timestamp},function(e){0===e.no?(i.initPager("income",i.objGet(e,"data.total_count",0)),i.parseIncomeList(i.objGet(e,"data.order_list",[]))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json"),$.get(i.api.charge,{pn:1,c:5,t:i.timestamp,showMemberRecord:1},function(e){0===e.no?(i.initPager("charge",i.objGet(e,"data.total_count",0)),i.parseChargeList(i.objGet(e,"data.order_list",[]))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json")},parseDateTime:function(i){i=1e3*parseInt(i,10)||0;for(var e=new Date(i),s=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes()],t=0;t<s.length;t++)s[t]<10&&(s[t]="0"+s[t]);return[s[0],s[1],s[2]+" "+s[3]+": "+s[4]].join("-")},parseExpendList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.isProp="hidden",s.createTime=t.parseDateTime(t.objGet(s,"create_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u5151\u6362\u5546\u54C1&nbsp;</span>                 <span class="<%= history.isProp %> col-33">\u9053\u5177 - </span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <div class="col-33">\u5151\u6362\u6210\u529F</div>         </div>     </div> </div>')({history:s});t.$content.find(".wd-list-category.expend>.wd-history-list").html(a)},parseIncomeList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.createTime=t.parseDateTime(t.objGet(s,"create_time")),s.status="\u83B7\u53D6\u6210\u529F",a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u901A\u8FC7&nbsp;</span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83B7\u53D6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <div class="col-33"><%= history.status %></div>         </div>     </div> </div>')({history:s});t.$content.find(".wd-list-category.income>.wd-history-list").html(a)},parseChargeList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.createTime=t.parseDateTime(t.objGet(s,"finish_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <% if (history.scene_id == 100002) { %>         <div>             <div class="text-overflow">                 <span class="col-33 bold">T\u8C46</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83B7\u53D6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <div class="col-33">\u83B7\u53D6\u6210\u529F</div>         </div>         <%         } else if (history.scene_id == 1050001 || history.scene_id == 1050002) {         %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.scene_id == 1050001 ? \'\u8D34\u5427\u4F1A\u5458\' : \'\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\' %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span class="col-fb"><%= history.time %></span>                 <span> \u4E2A\u6708</span>             </div>         </div>         <div>             <div class="col-33">\u83B7\u53D6\u6210\u529F</div>         </div>         <% } %>     </div> </div>')({history:s});t.$content.find(".wd-list-category.charge>.wd-history-list").html(a)},initPager:function(i,e,s){var t=this,a=Math.ceil(e/5),n=t.$content.find(".wd-list-category."+i),o=n.find(".wd-history-page-wrapper");if(t.listPage[i]=a,0===a)o.remove(),s&&t.$historyEmpty.show().siblings().hide();else{var r=t.use("common/component/JsPager",{container:o,current:1,amount:4,total:a,classname:{wrapper:"wd-page-wrapper"}});r.bind("pageChange",function(e,s){r.initial({current:s}),t.routeParseData(i,s)}),s&&t.$historyEmpty.hide().siblings("."+i+", .wd-history-more").show()}},routeParseData:function(i,e){var s=this,t={pn:e,c:5,t:s.timestamp};"charge"===i&&(t.showMemberRecord=1),$.get(s.api[i],t,function(e){0===e.no?s["parse"+i.substr(0,1).toUpperCase()+i.substr(1)+"List"](s.objGet(e,"data.order_list")):11e4===e.no&&(s.dialog.hide(),s.requireInstance("common/widget/LoginDialog",[]))})},initEvent:function(){var i=this,e=i.$content.find(".wd-list-wrapper"),s=i.$content.find(".wd-fast-forward"),t=i.$content.find(".wd-history-more"),a=100;i.longHistory=!1,this.$content.on("click",".wd-history-more",function(){s.slideDown(a),t.slideUp(a),e.animate({height:410},a),i.longHistory=!0}).on("click",".wd-fast-forward",function(){var n=i.$content.find(".wd-list-type-wrapper").data("type");s.slideUp(a),0!==i.listPage[n]&&t.slideDown(a),e.animate({height:278},a),i.longHistory=!1}).on("click",".wd-history-type-wrapper>div:not(.active)",function(){var e=$(this),s=e.data("type");e.addClass("active").siblings(".active").removeClass("active"),0===i.listPage[s]?(i.$historyEmpty.show().siblings().hide(),i.$historyEmpty.find(".wd-empty-type").html(e.html())):($(".wd-list-category."+s).show().siblings().hide(),i.longHistory===!1&&t.show())}).on("click",".wd-umoney-show",function(){$(this).hide().prev().hide().next().next().show()}).on("click",".wd-member-icon",function(){i.requireInstance("common/widget/JoinVipDialog").getMemberDialog(129,1004001e3)}).on("click",".wd-btn-tbeanget",function(){i.requireInstance("common/widget/tcharge_dialog",[i.objSet({},"consumption_path",130)]),i.hide()}).on("click",".wd-list-empty a",function(){i.requireInstance("common/widget/tcharge_dialog",[i.objSet({},"consumption_path",131)]),i.hide()})},initTrack:function(){var i="t\u8C46\u94B1\u5305",e=this.isMember?"":"\u975E";this.$content.on("show",function(){$.stats.track("t\u8C46\u94B1\u5305\u5F39\u51FA",i)}).on("click",".wd-member-icon",function(){$.stats.track(e+"\u4F1A\u5458\u7528\u6237\u8D2D\u4E70",i)}).on("click",".wd-btn-tbeanget",function(){$.stats.track(e+"\u4F1A\u5458\u83B7\u53D6t_button",i)}).on("click",".wd-list-empty a",function(){$.stats.track(e+"\u4F1A\u5458\u4FC3\u9500\u70B9\u51FB",i)})}}});_.Module.define({path:"common/widget/tb_lcs/Int64",sub:{initial:function(i){this.high=i.high,this.low=i.low},myToString:function(){return new dcodeIO.Long(this.low,this.high).toString()}}});
;_.Module.define({path:"common/widget/tb_lcs/LogUtil",sub:{error:function(){$.cookie("lcs_debug")&&"console"in window&&console.error(["[tbLcs]"].concat([].slice.apply(arguments)))},log:function(){$.cookie("lcs_debug")&&"console"in window&&console.log(["[tbLcs]"].concat([].slice.apply(arguments)))}}});
;var LAST_MSG_ID_SURVIVAL_TIME=6e5,LAST_MSG_ID_AUTO_DELAY_INTERVAL=3e4,LAST_MSG_ID_STORAGE_KEY="LCS_NOTIFY_LAST_MSG_ID_MAP_"+PageData.user.id;_.Module.define({requires:["LogUtil","Int64"],path:"common/widget/tb_lcs/LastMsgIdManager",sub:{initial:function(){this._logUtil=this.requireInstance("LogUtil",[])},_log:function(){this._logUtil.log.apply(this._logUtil,arguments)},getLastMsgId:function(t){return this._getLastMsgIdMap()?this._getLastMsgIdMap()[t]:(this._logUtil.error("lastMsgIdMap\u672A\u521D\u59CB\u5316\u6216\u5DF2\u5931\u6548\u3002\u53EF\u80FD\u5728debugger\u4E2D\u505C\u7559\u8FC7\u5BFC\u81F4$.Storage\u4E2D\u7684lastMsgIdMap\u672A\u53CA\u65F6\u88AB\u7EED\u7B7E\uFF0C\u53EF\u4EE5\u518D\u5F00\u542F\u4E00\u4E2Atab\u7531\u5176\u8D1F\u8D23\u5B9E\u65F6\u7EED\u7B7ElastMsgId~"),void 0)},initialLastMsgIdMap:function(t){var s=this._getLastMsgIdMap()||{};for(var a in t)s[a]||(s[a]=t[a]);this._log("lastMsgIdMap \u521D\u59CB\u5316",s),this._setLastMsgIdMap(s)},updateLastMsgId:function(t,s){var a=this._getLastMsgIdMap();return a?(a[t]=s,this._log("lastMsgIdMap \u66F4\u65B0",a),this._setLastMsgIdMap(a),void 0):(this._logUtil.error("lastMsgIdMap\u672A\u521D\u59CB\u5316\uFF081007\u4E0A\u7EBF\u6210\u529F\u8FD4\u56DE\uFF09\u5373\u8BD5\u56FE\u8FDB\u884C\u66F4\u65B0\uFF08202003\u6536\u5230\u6D88\u606F\uFF1F\uFF09\uFF0C\u8FD9\u4E0D\u6B63\u5E38~"),void 0)},hasInitialised:function(){return!!this._getLastMsgIdMap()},autoDelayExpire:function(){setInterval($.proxy(this._delayExpire,this),LAST_MSG_ID_AUTO_DELAY_INTERVAL)},_delayExpire:function(){this._log("lastMsgIdMap \u5C1D\u8BD5\u66F4\u65B0"),this._getLastMsgIdMap()&&(this._log("lastMsgIdMap \u66F4\u65B0"),this._setLastMsgIdMap(this._getLastMsgIdMap()))},_setLastMsgIdMap:function(t){var s=(new Date).getTime()+LAST_MSG_ID_SURVIVAL_TIME;$.tb.Storage.set(LAST_MSG_ID_STORAGE_KEY,$.json.encode(t),s),this._log("lastMsgIdMap set",this._getLastMsgIdMap())},_getLastMsgIdMap:function(){var t=$.json.decode($.tb.Storage.get(LAST_MSG_ID_STORAGE_KEY));for(var s in t)t[s]=this.requireInstance("Int64",[t[s]]);return t}}});
;_.Module.define({requires:["LogUtil","Int64"],path:"common/widget/tb_lcs/ProtoDataParser",sub:{initial:function(){this._logUtil=this.requireInstance("LogUtil",[])},getPid:function(r,t){var i;try{switch(r){case 209003:var e,a,o,s=t.data;if(!s)break;if(e=s.groupMsg,!$.isArray(e))break;if(a=e[0],!a)break;if(o=a.groupInfo,!o)break;i=o.groupType;break;case 202006:var u,g,n;if(u=t.multiMsg,!$.isArray(u))break;if(g=u[0],!g)break;if(n=g.data,!n)break;i=n.groupType;break;default:this._logUtil.error("\u672A\u77E5\u547D\u4EE4\u53F7: "+r+"\uFF0C\u65E0\u6CD5\u89E3\u6790\u51FApid(groupType)\u5B57\u6BB5\u7684\u4F4D\u7F6E\u3002\u8BF7\u5728imLcs._getPid\u4E2D\u589E\u52A0\u5BF9\u5E94\u547D\u4EE4\u53F7\u7684\u5904\u7406")}}catch(f){this._logUtil.error(f)}return i||this._logUtil.error("\u672A\u627E\u5230groupType, data:"+$.json.encode(t.data)),i},getMsgId:function(r,t){var i;try{switch(r){case 202006:var e,a,o;if(!t)return;if(e=t.multiMsg,!$.isArray(e))return;if(a=e[0],!a)return;if(o=a.data,!o)return;i=o.msgId;break;case 209003:var s,u,g,n,f;if(!t)return;if(s=t.data,!s)return;if(u=s.groupMsg,!$.isArray(u))return;if(g=u[0],!g)return;if(n=g.msgList,!$.isArray(n))return;if(f=n[n.length-1],!f)return;i=f.msgId}}catch(d){this._logUtil.error(d)}return this.requireInstance("Int64",[i])},getGroupId:function(r,t){var i;try{switch(r){case 209003:var e,a,o,s;if(!t)break;if(e=t.data,!e)break;if(a=e.groupMsg,!$.isArray(a))break;if(o=a[0],!o)break;if(s=o.groupInfo,!s)break;i=s.groupId;break;case 202006:var u,g,n;if(!t)break;if(u=t.multiMsg,!$.isArray(u))break;if(g=u[0],!g)break;if(n=g.data,!n)break;i=n.groupId;break;default:this._logUtil.error("\u672A\u77E5\u547D\u4EE4\u53F7: "+r+"\uFF0C\u65E0\u6CD5\u89E3\u6790\u51FAgroupId\u5B57\u6BB5\u7684\u4F4D\u7F6E\u3002\u8BF7\u5728imLcs._getGroupId\u4E2D\u589E\u52A0\u5BF9\u5E94\u547D\u4EE4\u53F7\u7684\u5904\u7406")}}catch(f){this._logUtil.error(f)}return i||this._logUtil.error("\u672A\u627E\u5230groupId, data:"+$.json.encode(t.data)),i}}});
;!function(){var e,t,n,s=1007,o=202006,a=209003,r=!1,i={},d=[];_.Module.define({requires:["LogUtil","ProtoDataParser","LastMsgIdManager","Int64"],path:"common/widget/TbLcs",sub:{initial:function(){r||(e=this.requireInstance("LogUtil",[]),n=this.requireInstance("ProtoDataParser",[]),t=this.requireInstance("LastMsgIdManager",[]),t.autoDelayExpire(),this._listenNotify(),this._listenMessage(),this._listenInitialLastMsgId(),$.lcsFlash.connect(PageData.user.user_id),$.lcsFlash.onOpen($.proxy(this._online,this)),r=!0)},on:function(e,t){$.lcsFlash.on(e,t)},send:function(t){var n={command:t.command,data:t.data||void 0,success:t.success||$.noop,error:t.fail||$.noop,contentType:t.contentType||"pb",dataType:t.dataType||"pb"};e.log("send",n),$.lcsFlash.send(n)},onMessage:function(e,t){i[e]||(i[e]=[]),i[e].push(t)},onReady:function(n){var s=t.hasInitialised();e.log("onReady","callback:",n,"isReady:",s),s?n():d.push(n)},_listenInitialLastMsgId:function(){var n=this;n.on(s,function(s){e.log("on COMMAND_ONLINE",s);var o=s.data;if(o){var a=o.groupInfo;if($.isArray(a)){for(var r={},i=0;i<a.length;++i){var d=a[i];d&&(r[d.groupId]=n._createInt64(d.lastMsgId))}t.initialLastMsgIdMap(r)}}})},_listenNotify:function(){var t=this;t.on(o,function(s){if(e.log("on COMMAND_NOTIFY",s),$.lcsFlash.isWebSocketInCurrentTab()){var a=n.getPid(o,s);a&&t._pullMessage(s)}})},_pullMessage:function(s){e.log("begin to pull message for notify: ",s);var r=this,i={},d={},g={};if(i.width=400,i.height=600,i.smallWidth=400,i.smallHeight=600,i.pushTimes=(new Date).getTime().toString(),d.groupId=n.getGroupId(o,s),!d.groupId)return e.error("\u65E0groupId, \u505C\u6B62\u62C9\u6D88\u606F"),void 0;var l=t.getLastMsgId(d.groupId);return l?(d.lastMsgId=l.myToString(),g.groupId=n.getGroupId(o,s),g.groupType=n.getPid(o,s),e.log("pull message, getGroupMsgReqData:",i),i.groupMids=[d],i.groupTypes=[g],r.send({command:a,data:i}),void 0):(e.error("groupId "+d.groupId+"\u7684lastMsgId\u672A\u521D\u59CB\u5316\uFF0Cnotify\u88AB\u5FFD\u7565\uFF01\u8BF7\u8054\u7CFB\u540E\u7AEF@\u5982\u5175||@\u5251\u4E1C\u57281007\u547D\u4EE4\u4E2D\u8FD4\u56DE\u6B64groupId\u7684\u521D\u59CBlastMsgId\u503C"),void 0)},_listenMessage:function(){var s=this;s.on(a,function(s){if(e.log("on COMMAND_MESSAGE",s),!s.error||0===s.error.errorno){var o=n.getMsgId(a,s);o&&t.updateLastMsgId(n.getGroupId(a,s),o);var r=i[n.getPid(a,s)];if($.isArray(r))for(var d=0;d<r.length;++d){var g,l=r[d];try{g=s.data.groupMsg[0]}catch(u){e.error(u)}g?(e.log("COMMAND_MESSAGE find and exec callback, curGroupMsg:",g),l(g)):e.error("curGroupMsg no content:",g,s)}}})},_online:function(){e.log("online","$.lcsFlash(lcsas.js) ready, begin to send COMMAND_ONLINE"),$.lcsFlash.send({command:s,data:{bduss:void 0,secretKey:void 0,project:"MRD",groupId:void 0,device:$.json.encode({_client_type:20,pversion:"1.3.0"})},success:function(){for(var e;e=d.pop();)e()},contentType:"pb",dataType:"pb"})},_createInt64:function(e){return this.requireInstance("Int64",[e])}}})}();_.Module.define({path:"common/widget/flashLcs",requires:[],sub:{initial:function(e){e=$.extend({onMessage:function(){}},e),this.requireInstance("common/widget/tbLcs").onMessage(8,function(n){var o;try{o=$.json.parseJSON(n.msgList[0].content),e.onMessage(o)}catch(s){window.console&&console.error(s)}})}}});F.module("common/widget/eventCenter",function(){var e=$({}),t=function(){var e;return e=("0000"+parseInt(Math.random()*Math.pow(36,4),10).toString(36)).slice(-4),function(t,n){var a,o,l,r,u,i,s,c,f;return a=navigator.userAgent.indexOf("MSIE ")>-1||navigator.userAgent.indexOf("Trident/")>-1,o="onstorage"in document&&a,l=function(e){var n;n=new Date,n.setTime(n.getTime()+1e3),document.cookie="tabHub_emit_"+t+"="+e+"; expires="+n.toUTCString()+"; path=/"},u=0,r=o?function(n){var a,o,r,i;for(c.lastValue=n,i="data:"+e+":"+c.lastValue,l(i),localStorage.setItem(t,i),a=0,o=s.length;o>a;a++)r=s[a],r.call(null,n);return u+=1}:function(n){var a,o,l;for(c.lastValue=n,localStorage.setItem(t,"data:"+e+":"+c.lastValue),a=0,o=s.length;o>a;a++)l=s[a],l.call(null,n);return u+=1},s=[],i=$.noop,o?$(document).on("storage.noop",i):$(window).on("storage.noop",i),n?(o&&l("readable:"+e),localStorage.setItem(t,"readable:"+e),$(document).ready(function(){return setTimeout(function(){var e,a,l,i,d;if(f(),!(u>0)){if((e=null!=(d=localStorage.getItem(t))?d.split(":"):void 0)&&"data"===e[0])for(c.lastValue=e[2],a=0,l=s.length;l>a;a++)return i=s[a],i.call(null,e[2]),void 0;return n(r),o?$(document).off("storage.noop"):$(window).off("storage.noop")}},100)})):$(document).ready(function(){setTimeout(function(){f(),$(document).off("storage.noop"),$(window).off("storage.noop")})}),f=function(){var n,r,u,i;return n=function(n){var a,o,l,r,u,i,f,d,g;if(u=n.originalEvent.key,f=localStorage.getItem(t),u===t&&f===n.originalEvent.newValue)switch(a=f.split(":"),l=a[0],o=a[2],l){case"readable":if(null!=c.lastValue)return localStorage.setItem(t,"data:"+e+":"+c.lastValue);break;case"data":if(null!=o){for(g=[],r=0,i=s.length;i>r;r++)d=s[r],g.push(d.call(null,o));return c.lastValue=o,g}}},i=function(n){var a,o,l,r,u,i,f,d,g,m;if(i=n.originalEvent.key,d=n.originalEvent.newValue,i===t){if(a=d.split(":"),r=a[0],l=a[1],o=a[2],l===e)return;switch(r){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?localStorage.setItem(t,"data:"+e+":"+c.lastValue):void 0},0);break;case"data":if(null!=o){for(m=[],u=0,f=s.length;f>u;u++)g=s[u],m.push(g.call(null,o));return c.lastValue=o,m}}}},u=function(){var n,a,o,r,u,i,f,d,g;if(f=document.cookie.replace(RegExp("(?:(?:^|.*;\\s*)tabHub_emit_"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")){if(n=f.split(":"),r=n[0],o=n[1],a=n[2],o===e)return;if(null==f)return;switch(r){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n,a;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?(a="data:"+e+":"+c.lastValue,l(a),localStorage.setItem(t,a)):void 0},0);break;case"data":if(null!=a){for(g=[],u=0,i=s.length;i>u;u++)d=s[u],g.push(d.call(null,a));return c.lastValue=a,g}}}},o?($(document).on("storage."+t,u),$(window).on("unload",function(){return $(document).off("storage")})):(r=a?i:n,$(window).on("storage."+t,r),$(window).on("unload",function(){return $(window).off("storage")}))},c={destory:function(){return $(window).off("storage."+t)},onValue:function(e){return s.push(e),function(){var t;return t=$.inArray(e,s),-1!==t?s.splice(t,1):void 0}},lastValue:null,emit:r,guid:e}}}();return e.TabHub=t,e});_.Module.define({require:["common/widget/eventCenter"],path:"common/widget/newMessageSystem",requires:["common/widget/flashLcs","common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85CF",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67E5\u770B\u79C1\u4FE1",unread_count:0,category_href:"/im/pcmsg"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(){this.$el=$(".userbar .u_news");var e=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_menu_wrap u_news_wrap j_news" onclick="return false;"><span></span></a></div>'),t=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,e]);this.$newsTips=e.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(e);var a=baidu.template("u_notify",{portrait:PageData.user.portrait});t.innerContent("top",a),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread_num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){var e=this;e.use("common/widget/flashLcs",{onMessage:function(t){var a=t.ueg;e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a),e.eventCenter.trigger("sysmsg.upmsg",t)}})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,e.renderNotify(t,1),void 0):($.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.renderNotify(a,1),e.notifyData=a,e.setNotifyStorage(a))}),void 0)},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67E5\u770B\u56DE\u590D",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67E5\u770B@\u63D0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67E5\u770B\u597D\u53CB\u7533\u8BF7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67E5\u770B\u65B0\u7C89\u4E1D",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){a[e].category_href="/i/sys/jump?u="+PageData.user.portrait+t.category_href}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template("u_notify_item",{list:e})).find(".j_cleardata").eq(0).tbattr("target","sixin"),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t);var a=e>99?"99+":e;this.$newsTips.html(a),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var n=0,s=e.notifyData.length;s>n;n++){var i=e.notifyData[n];if(a.category_id==i.category_id){i.unread_count=parseInt(i.unread_count,10)-1,i.unread_count<0&&(i.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,n=t.content;a&&"undefined"!=typeof n&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(n,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(n.split(",")))}),TbCom.on("msgsystem_listencomplete",function(){}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),n=a.tbattr("data-type");return"favts"===n?(e.clearFavNum(),void 0):(n&&TbCom.process("UserMessage","clearData",n),void 0)});var t=this.eventCenter.TabHub,a=t("messageCount",function(){a.getUnreadDebounce()});a.getUnreadDebounce=_.debounce(function(){$.ajax({url:"/im/pcmsg/query/getAllUnread",dataType:"json",cache:!1,type:"GET"}).done(function(e){0===parseInt(e.errno)&&a.emit(e.unread)})},100),a.onValue(function(t){e.messageData[0].unread_count=parseInt(t,10),e.renderNotify(e.messageData,0),$(document).off("visibilitychange.message"),$(window).off("focus.message")}),this.eventCenter.data("tabHub.message",a),$.lcsFlash&&$.lcsFlash.on(202006,function(e){return 6===e.multiMsg[0].data.groupType?document.hasFocus()||document.hidden===!1?(a.getUnreadDebounce(),void 0):("undefined"!=typeof document.hidden?$(document).off("visibilitychange.message").one("visibilitychange.message",a.getUnreadDebounce):$(window).off("focus.message").one("focus.message",a.getUnreadDebounce),void 0):void 0})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var n=t.messageData[5];n&&(n.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?(e.apply(t),void 0):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"common/widget/messenger",requires:["common/widget/messenger/messengerProcesser","common/widget/messenger/messengerTarget"],sub:{initial:function(e,n){if(!e)throw new Error("Messenger name must be asigned");var s=n||"[PROJECT_NAME]";this.name=e,this.prefix=s.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("common/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,n){this.targets[n]=this.requireInstance("common/widget/messenger/messengerTarget",[this.prefix,e,n])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var n=0;for("string"==typeof e&&(e=[e]),n;n<e.length;n++)this.origins.push(e[n])},send:function(e){var n,s=this.targets;for(n in s)s.hasOwnProperty(n)&&s[n].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,n=function(n){var s="";if("object"==typeof n){if(!n.data||"string"!=typeof n.data)return window.console&&console.warn("The received message is not type of string"),void 0;if(s=n.data,/^ignoredProject/.test(s))return;if(s.substring(0,e.prefix.length)!==e.prefix)return window.console&&console.warn("The msg type is not avaliable in project "+e.prefix),void 0;if(n.origin&&!e._checkOrigin(n.origin))return window.console&&console.warn("The post origin is not avaliable in project "+e.prefix),void 0}else if(s=n,/^ignoredProject/.test(s))return;s=s.slice(e.prefix.length),s=e._escapeHTML(s);try{s=$.parseJSON(s)}catch(i){throw new Error("The JSON string is not valid")}var r=e.processer.process(s)||{};s.command&&s.shake&&s.shake_id&&e.send($.json.encode({command:s.command+"@"+s.shake_id+"@success",shake:!0,shake_id:s.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var n=0,s=this.origins.length;for(n;s>n;n++)if(this.origins[n]===e)return!0;return!1}}});
;_.Module.define({path:"common/widget/messenger/messengerProcesser",requires:[],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(o){this.checkExistCommand(o)&&(this.commandMap=$.extend(this.commandMap,o)),this.processFailCommand(o)},checkExistCommand:function(o){var n;for(n in o)if(o.hasOwnProperty(n)&&n in this.commandMap)return window.console&&console.warn('The command "'+n+'" is already exist'),void 0;return!0},processFailCommand:function(o){var n;for(n in o){var i=this._failCommandCacheList[n];o.hasOwnProperty(n)&&i&&this.process(i)}},process:function(o){if(!(o.command&&o.command in this.commandMap))return this._failCommandCacheList[o.command]=o,window.console&&console.warn("Please check or register the data processing command"),void 0;var n=this.commandMap[o.command];return n(o.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstanceAsync("common/widget/LoginDialog",[],function(){})},common_register:function(o){var n=o.return_url||"http://tieba.baidu.com",i="https://passport.baidu.com/v2/?reg&tpl=tb&u="+n;window.open(i)},exception_all:function(){throw new Error("Processing data exception")}}});
;_.Module.define({path:"common/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,t,r){var i="";if(arguments.length<3?i="Target error: target and name are both requied":"object"!=typeof t?i="Target error: target itself must be window object":"string"!=typeof r&&(i="Target error: target name must be string type"),i)throw new Error(i);this.prefix=e,this.target=t,this.name=r},send:function(e){var t="postMessage"in window;if(t)this.target.postMessage(this.prefix+e,"*");else{var r=window.navigator[this.prefix+this.name];if("function"!=typeof r)throw new Error("Target error: target callback function is not defined");var i=$.tb.location,o={origin:i.getProtocol()+"//"+i.getHost(),data:this.prefix+e};r(o,window)}}}});_.Module.define({path:"common/widget/baseUserData",requires:[],sub:{initial:function(){},route:{getTdou:"http://tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=PageData.user,r=this._parrScores||e.Parr_scores;return r&&!$.isEmptyObject(r)?r.scores_money+r.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return!!r},getMemberLevel:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return r},getMemberIcon:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevelExpire(e),a=this.getMemberIconByLevel(r);return a},getMemberIconByLevel:function(e){e&&(e=parseInt(e));var r="",a="",t="";switch(e){case-1:r=" icon-vip1-gray-18 base_member_icon",a="\u8D34\u5427\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458";break;case 1:r=" icon-vip1-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u4F1A\u5458";break;case-2:r=" icon-vip2-gray-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;case 2:r=" icon-vip2-18 base_member_icon",a="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;default:r="",a=""}var s={level:e,icon:r,title:a,action_title:t};return s},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var e=PageData.user.mParr_props||PageData.user.Parr_props,r=PageData.user.Parr_scores;return!(e&&r)},_getMaxLevel:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return 1e3*s.end_time>a&&parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10)),r},_getMaxLevelExpire:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10),1e3*s.end_time<=a&&(r=0-r)),r},getTdou:function(e,r){var a=this;a._get_tdou_ajax&&a._get_tdou_ajax.abort(),a._get_tdou_ajax=$.ajax({type:"get",url:a.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(a){e.call(r,a)})},getUserTreasure:function(){return PageData.user.Parr_scores?PageData.user.Parr_scores.treasure_coin_total||0:0}}});_.Module.define({path:"common/widget/cashierDialog",requires:["common/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8D26\u53F7\uFF1A<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8C46\u4F59\u989D\uFF1A<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},PageData.pay_fr=e.fr,PageData.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),a._setBody(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,PageData.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=PageData.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ED\u7A97\u53E3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("common/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652F\u4ED8\u6210\u529F");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518D\u6B21\u8D2D\u4E70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(PageData.pay_track||"memberpay","cashierDialog-"+PageData.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"common/widget/qianbaoCashierDialog",requires:["common/widget/baseUserData"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"http://zhifu.baidu.com/static/js/pc/iframe/lbscashier-iframe.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData")},createMain:function(a,e){var t=this;PageData.qianbao_cashier=t,t.setLoading(),$.isFunction(e)&&e(t.$root),t.changeoPayAmount(a),t.qianbao_params_json=t.getParams(a)},buildCashier:function(a){var e=this;e.cashier?e.cashier.updateOrder(a):(e.cashier=new window.lbscashier({onmessage:e.onMessage,containerId:e.iframeContainerId,data:a,height:360}),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=PageData.qianbao_cashier;if(!a)return console.log("onmessage null"),void 0;var t=a.type,i=a.data,o=a.option,n=o&&o.channel,s=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var c="wechat"===n||"alipayqr"===n||"gameyeepay"===n||"mobileyeepay"===n?!0:!1;c?(s=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(c)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}s||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t){var i=this,o=a.qianbao_params;i.product=a.product,$.JsLoadManager.loadUrl(i.qianbaoLbscashierUrl,function(){i.buildDialog(e),i.createMain(o,t)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if(!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t=e.getDialogTpl(a),i={modal:!0,showTitle:!1,fixed:!0,width:717,height:564,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:t};e._iframe_dialog=new $.dialog(i),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><!-- htmlcs-disable -->  <div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...</p>              </td>          </tr>          </tbody>      </table>  </div><!-- htmlcs-disable -->  <div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                    <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div></div>',i={goodsShowTpl:a};return t=$.tb.format(t,i)},qianbaoSecure:function(){var a={};a.templist=[];var e="passport.baidu.com";return a.set_pass_domain=function(a){switch(a){case"passport.baidu.com":case"wappass.baidu.com":case"passport.rdtest.baidu.com":case"passport.qatest.baidu.com":e=a}},a.pin=function(e,t){var i=window.Image?new Image:document.craeteElement("img"),o=function(a){o=function(){},t&&t(a)};i.onload=function(){o()},i.onerror=function(){o("failed")},a.templist.push(i),i.src=e},a.checkAuthorication=function(e){function t(){i&&o&&e&&e()}var i=!1,o=!1;a.sync_login("www.baifubao.com",function(){i=!0,t()}),a.sync_login("wallet.baidu.com",function(){o=!0,t()})},a.sync_login=function(t,i){a.pin("https://"+e+"/v3/login/api/auth/?return_type=3&tpl=bp&u=https://"+t+"/api/0/sync_login/0",i)},a}(),changeoPayAmount:function(a){var e=this,t=a;e.qianbao_params_json=e.getParams(a),e.qianbaoSecure.checkAuthorication(function(){e.buildCashier(t)})},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.qianbao_cashier,clearTimeout(a.timerId),clearTimeout(a.checkPaymentId),a.track("\u5173\u95ED\u7A97\u53E3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var o=i[0].split("=");e.orderId=o[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var o={order_id:i.qianbao_params_json.orderId},n={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var s=5,c=function(){s--,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:o,dataType:"json"}).success(function(o){var r=o.data.db_money||0;r/=100;var l=o.data.scores_total;if(!l){var d=o.data.given_scores||0;l=1e3*r+d+i.dataProxy.getUserTdou()}n=$.extend(n,{payAmount:r.toFixed(2),totalScores:l,payTdou:(o.data.given_scores||0)+(o.data.db_money||0)});var p=o.data.member_info;if(p){var u="yyyy-MM-dd",_=1e3*parseInt(p.create_time),m=1e3*parseInt(p.end_time);n=$.extend(n,{create_time:$.dateFormat(new Date(_),u),end_time:$.dateFormat(new Date(m),u)})}0==o.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(n),s=5):s>0&&"ok"===a?i.checkPaymentId=setTimeout(c,1e3):(i.clearLoading(),t&&t(n))})};i.checkPaymentId=setTimeout(c,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...",paying:"\u5F88\u52AA\u529B\u7684\u5145\u503C\u4E2D...",check:"\u67E5\u8BE2\u5145\u503C\u7ED3\u679C\u4E2D..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<!-- htmlcs-disable -->  <section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60A8\u5DF2\u6210\u529F\u652F\u4ED8</p>              <%} else {%>              <p class="description">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C</p>              <%}%>              <p class="description-tips">\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>              <div class="center">                  <a class="btn_default btn_sub btn-middle j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>                  <a class="btn_default btn-middle btn-encourage j_pay_ok qianbao_pay_tip_btn">\u652F\u4ED8\u6210\u529F</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u6210\u529F\uFF01</span>          <p style="text-align:center">\u60A8\u53EF\u4EE5\u5728<span class="pay_amount">\u6211\u7684T\u8C46\u94B1\u5305</span>\u4E2D\u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F</p>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u6210\u529F\uFF01</span>          <%}%>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4F1A\u5458\u8D77\u59CB\u65E5\u671F\uFF1A</label><span class="member_date"><%=create_time%></span></p>        <p><label>\u4F1A\u5458\u7ED3\u675F\u65E5\u671F\uFF1A</label><span class="member_date"><%=end_time%></span></p>      <%}%>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_close ">              <%if(product == \'tdou\'){%>              \u7EE7\u7EED\u83B7\u53D6              <%}else if(product == \'member\'){%>              \u7EE7\u7EED\u5145\u503C              <%}%>          </a>      </div>      <p style="text-align:center"><span class=" second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</p>  </div>',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u5931\u8D25\uFF01</span>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>          <%}%>      </div>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_repay ">              <%if(product == \'tdou\'){%>              \u91CD\u65B0\u83B7\u53D6              <%}else if(product == \'member\'){%>              \u91CD\u65B0\u5145\u503C              <%}%>          </a>      </div>        <p style="text-align:center">          <span class="second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3          <a href="http://tieba.baidu.com/hermes/feedback?category=pay">\u8FDB\u884C\u53CD\u9988</a>      </p>  </div>',a);e.showPaymentResult(t)},updateUserInfo:function(a){PageData.user.Parr_scores.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,o=function(){return i--,0==i?(e.closeDialog(),void 0):(t.html(i),e.timerId=setTimeout(o,1e3),void 0)};e.timerId=setTimeout(o,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"common/widget/baseDialogUserBar",requires:["common/widget/baseUserData","common/widget/Icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <div class="header_title">          <span class="header_icon"></span>          <span><%=title%></span>      </div>      <div class="user_info">              <span class="title_acc">\u8D26\u53F7\uFF1A                  <%= userIcon %>                  <a class="title_acc_name <%=member_red%> "><%=user_name%></a>              </span>              <%if(is_tdou_info_display){%>              <span class="tdou_remain">T\u8C46\u4F59\u989D\uFF1A                  <span class="tdou_remain_num">                      <span class="user_tdou_icon"></span>                      <span class="j_tdou"><%=tdou_num%></span>                  </span>                  </span>          <%}%>      </div>      <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/Icons")},getUserBarTemplate:function(e){var a=this,s="",r=!0;e&&"getmember"==e?(s=a.member.action_title,r=!1):s="\u83B7\u53D6T\u8C46";var t="";("ordinary_member_icon"==$.trim(a.member.icon)||"super_member_icon"==$.trim(a.member.icon))&&(t=" member_red ");var i=this.icon.getPreIconHtml($.getPageData("user.mParr_props"),$.getPageData("user"),!0),n={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:t,title:s,is_tdou_info_display:r,userIcon:i},o=window._.template(a.tpl,n);return o}}});_.Module.define({path:"common/widget/qianbaoPurchaseMember",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,memberOptions:null,id:"qianbao_purchase_member",initial:function(){var e=this;window.pageUnit=window.pageUnit||{};var t=window.pageUnit;t[this.id]||(t[this.id]=$.ajax({url:"/theme/getPage",type:"GET",data:{id:["qianbao_purchase_member_hot_message","qianbao_purchase_member_member_types"]},dataType:"json"}).done(function(a){a=a.data||{},t[e.id]={hotMessage:a.qianbao_purchase_member_hot_message||"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:a.qianbao_purchase_member_member_types||"super, normal"},t[e.id].memberTypes=t[e.id].memberTypes.split(/\s*,\s*/g)}).fail(function(){t[e.id]={hotMessage:"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:["super","normal"]}})),e.cashierDialog=e.requireInstance("common/widget/qianbaoCashierDialog"),e.baseData=e.requireInstance("common/widget/baseUserData"),e.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),e.vip3Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip3_8f36413.png",e.vip4Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip4_e08e4b7.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon(),t.initMemberId="1050002",t.initMemberCount="3",t.getPayMemberOrder(t.initMemberId,t.initMemberCount,function(e){var a={qianbao_params:e};t.showMember(a);var r=t.cashierDialog.getParams(e);t.orderId=r.orderId})},showMember:function(e){var t=this,a=window.pageUnit;if(a[this.id].done)return a[this.id]=a[this.id].done(function(){t.showMember(e)}),void 0;e.hotMessage=e.hotMessage||a[this.id].hotMessage,e.memberTypes=e.memberTypes||a[this.id].memberTypes;var r=e.qianbao_params||"",i=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),n=window.baidu.template('<!-- htmlcs-disable -->\r\n<div class="qianbao_cashier_purchase_member base_user_data">\r\n    <%- baseDialogUserBarTpl %>\r\n    <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">\r\n        <div class="member_wrap">\r\n            <label class="goods_title">\u9009\u62E9\u4F1A\u5458\uFF1A</label>\r\n            <ul class="member_list j_member_list">\r\n                <% if(~$.inArray(\'super\', memberTypes)) { %>\r\n                <li class="member_item recommend j_order_update  j_type_1050002">\r\n                    <label class="member-type" id="ptype-1050002" data-name="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458" data-value="1050002">\r\n                        <img src="<%- vip4Src %>">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\r\n                    </label>\r\n                </li>\r\n                <% } %>\r\n                <% if(~$.inArray(\'normal\', memberTypes)) { %>\r\n                <li class="member_item j_order_update j_type_1050001 <%- type_1050001 %>">\r\n                    <label class="member-type" id="ptype-1050001" data-name="\u8D34\u5427\u4F1A\u5458" data-value="1050001">\r\n                        <img src="<%- vip3Src %>">\r\n                        \u8D34\u5427\u4F1A\u5458\r\n                    </label>\r\n                </li>\r\n                <% } %>\r\n                <% if(memberTypes.length > 1) { %>\r\n                <li class="member-tips <%- type_1050001 %>">\r\n                    <p>\u8BF7\u9009\u62E9\u8D2D\u4E70\u5546\u54C1</p>\r\n                </li>\r\n                <% } %>\r\n            </ul>\r\n            <div class="form-explain default" style="display: none;"></div>\r\n            <div class="form-explain priority" style="display: none;">\u5F00\u901A\u4F1A\u5458\u540E\uFF0C\u60A8\u5C06\u4F18\u5148\u4EAB\u53D7\u8D85\u7EA7\u4F1A\u5458\u7279\u6743\uFF0C\u8D85\u7EA7\u4F1A\u5458\u8FC7\u671F\u540E\u7EE7\u7EED\u4EAB\u53D7\u539F\u666E\u901A\u4F1A\u5458\u7279\u6743</div>\r\n        </div>\r\n        <div class="member_time_wrap">\r\n            <label class="goods_title time-title">\u9009\u62E9\u65F6\u957F\uFF1A</label>\r\n            <ul class="time_list j_time_list">\r\n                <li class="time_item  j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_1" id="vip_month_1" data-value="1">\r\n                        1\u4E2A\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_3" id="vip_month_3" data-value="3">\r\n                        3\u4E2A\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_6" id="vip_month_6" data-value="6">\r\n                        6\u4E2A\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="time_item j_order_update j_time_item j_vip_month_12" style="display: list-item;">\r\n                    <label class="time-type" for="vip_month_12" id="vip_month_12" data-value="12">\r\n                        12\u4E2A\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="custum_time j_custum_time">\r\n                    <label for="month-custum" class="month_custum">\r\n                        <input type="text" class="ui-input "\r\n                               name="month-custum" id="month-custum"\r\n                               placeholder="\u5176\u4ED6">\u4E2A\u6708\r\n                    </label>\r\n                </li>\r\n                <li class="member-tips">\r\n                    <p>\u8BF7\u9009\u62E9\u65F6\u957F</p>\r\n                </li>\r\n            </ul>\r\n            <div class="form-error"></div>\r\n        </div>\r\n    </div>\r\n</div>',i),s={qianbao_params:r,product:"member"};t.cashierDialog.showDialog(s,n,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount),t.bindEvents()})},initUI:function(e,t){var a=this;a.selectedUI(e,t)},selectedUI:function(e,t){var a=this;a.$root.find(".j_member_list li").removeClass("selected"),a.$root.find(".j_type_"+e).addClass("selected"),a.$root.find(".j_time_list li").removeClass("selected");var r=a.$root.find("#vip_month_"+t);r.length?(r.parents("li.j_time_item").addClass("selected"),a.$root.find("#month-custum").val("")):a.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120;e.$root.find(".j_order_update").on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),r="",i="";a.hasClass("member-type")?(r=a.data("value"),i=e.$root.find(".j_time_list li.selected .time-type").data("value"),i||(i=e.$root.find("#month-custum").val())):a.hasClass("time-type")&&(e.$root.find("#month-custum").val(""),i=a.data("value"),r=e.$root.find(".j_member_list li.selected .member-type").data("value")),e.selectedUI(r,i),e.updatePayUI(r,i)}),e.$root.find("#month-custum").on("input propertychange",function(){var a=/^[1-9]\d*$/,r=$(this),i=r.val();(i&&!a.test(i)||a.test(i)&&i>t)&&(i=i.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),i=Math.min(t,i),0==i&&(i=1),r.val(i),e.showCustomMonthBubble());var n=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(n,i)}).on("focus",function(a){var r=$(a.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var i=r.val(),n=/^[1-9]\d*$/;(i&&!n.test(i)||n.test(i)&&i>t)&&(i=i.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),i=Math.min(t,i),0==i&&(i=1),r.val(i),e.showCustomMonthBubble());var s=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(s,i)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,a){var r=this,i={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:r.return_url,fr:r.memberOptions.fr||""};r._getPayMemberAjax&&r._getPayMemberAjax.abort(),r._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:i,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data.return_url)})},updatePayMemberOrder:function(e,t,a,r){var i=this,n={terminal:"pc",pay_type:1,channel:2,order_id:a,memberId:e,memberCount:t,pageUrl:i.return_url};i._upPayMemberAjax&&i._upPayMemberAjax.abort(),i._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:n,cache:!1,dataType:"json"}).success(function(e){0==e.no&&r&&r(e.data)})},createBubble:function(e){var t=$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0});return new UiBubbleTipBase(t)},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var a={content:"\u4E00\u6B21\u6027\u5F00\u901A12\u4E2A\u6708\u4EE5\u4E0A\u4F1A\u5458\uFF0C\u8D60\u9001\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(a)}e.bubble_month_12.showBubble()},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var a={content:"\u4E00\u6B21\u6027\u53EA\u80FD\u5F00\u901A120\u4E2A\u6708\u8D34\u5427\u4F1A\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(a)}e.bubble_custom_month.showBubble()},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"common/widget/payMember",requires:["common/widget/qianbaoPurchaseMember","common/widget/Tdou/TdouOpenType"],sub:{pay_member_url:"/tbmfall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/cashierDialog"),e.qianbaoPayMember=e.requireInstance("common/widget/qianbaoPurchaseMember"),e.openTypeList=e.requireInstance("common/widget/Tdou/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,i=e||{};$.extend(i,{fr:i.fr||"",track:"memberpay"}),this.opt=i,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,i=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:i){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;1==this.payType?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,i=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:i},success:function(i){0==i.no&&(e=Number(i.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.openDialog()}}});_.Module.define({path:"common/widget/http_transform",sub:{initial:function(){window.BaiduHttps||(window.BaiduHttps={callbacks:function(){}})},httpTransform:function(t){if(window.navigator.userAgent){var i=window.navigator.userAgent;i=i.toLowerCase();var n=new RegExp("/chrome|firefox|safari|msie 10|rsv:11|msie [89]/");n.test(i)&&(t=t.replace("http://www.baidu.com","https://www.baidu.com"))}return t},httpLinkHover:function(t){$(t).hover(function(){$.ajax({url:"https://www.baidu.com/con?from=tieba",type:"get",dataType:"JSONP"})})}}});_.Module.define({path:"common/widget/Userbar",requires:["DropDownList","common/widget/Card","common/widget/wallet_dialog","common/widget/newMessageSystem","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember","common/widget/http_transform","common/widget/login_dialog"],sub:{_btns:{},_userinfo:null,$root:null,_logoutTimer:null,_product:null,_self:this,_urls:{itb_home:"",my_itb:"",my_club:"",u_split:"",my_space:""},_ddls:{itb:null,club:null,space:null},_userDataRended:{my_forum:!1,club:!1,space:!1},initial:function(t,e,i,a){e=e||"",TbCom.process("User","init",t,e),this._userinfo=t,this._product=e,this._buildLayout(a),TbCom.process("MsgSystem","init"),TbCom.process("UserMessage","init",e,a),this._bluePush(i)},_isDateTime:function(t){var e=864e5,i=t+e,a=Number(localStorage.getItem("tiebaPush"));return+new Date<i&&(a&&a!==t||!a)?!0:!1},_bluePush:function(t){if(t.userDiamond&&t.userDiamond.notice_time&&t.bluePushUnit&&(t.bluePushFlag.indexOf(window.PageData.product)>-1||t.bluePushFlag.indexOf("all")>-1)){var e=1e3*Number(t.userDiamond.notice_time);if(this._isDateTime(e)){var i={acceptValue:t.bluePushUnit.button[0]||"",cancelValue:"\u5173\u95ED",onaccept:function(){window.open(t.bluePushUnit.url[0]||"http://tieba.baidu.com")}};this._blue_dialog=new $.dialog.confirm(t.bluePushUnit.text[0]||"\u606D\u559C\u4F60",i),localStorage.setItem("tiebaPush",e)}}},_bindEvent:function(t){t.delegate(".j_u_blue","click",function(){$.stats.track("\u70B9\u51FB\u7EDF\u8BA1","\u6211\u7684\u84DD\u94BB")}),t.delegate(".j_u_grab_treasure","click",function(){$.stats.track("\u9876\u90E8\u5BFC\u822A\u6761-\u6211\u7684\u593A\u5B9D\u6309\u94AE","\u8D34\u5427\u593A\u5B9D")})},_initURLs:function(){this._urls.itb_st_param="st_mod=userbar&fr=tb0_"+this._product,this._urls.itb_home="/i/sys/jump?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":""),this._urls.my_favor=this._urls.itb_home+"&type=storethread&"+this._urls.itb_st_param,this._urls.itb_profile="/home/profile?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":"")},_buildLayout:function(t){var e=this,i="";-1!=$.inArray(this._product,["tbmall","livetool"])&&(i="userbar_theme2"),this.$root=$('<div id="com_userbar" class="userbar '+i+'"></div>');var a=$.getcurzIndex();(null==a||0>=a)&&(a=11e3),this.$root.css({"z-index":a});var s=t?$(t):$("body");s.prepend(this.$root),this.$root.on("click","a",function(){var t=$(this),e="\u9876\u90E8-";t.parents(".u_setting").length>0?e="\u8BBE\u7F6E-":t.parents(".u_news").length>0?e="\u6D88\u606F-":t.parents(".u_username").length>0&&(e="\u7528\u6237\u540D-");var i=$.trim($(this).html());(0==$.trim(t.html()).length||t.hasClass("u_username_wrap"))&&(i=t.tbattr("title")),t.hasClass("j_cleardata")&&(e="\u6D88\u606F-"),i=e+i,$.stats.track(i,"\u8D34\u5427\u9876\u90E8\u5BFC\u822A\u70B9\u51FB\u7EDF\u8BA1")}).on("click",".j_btn_getmember",function(){if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),!1;if(e.isMemeber)e._flowRateTest();else{window.open("/tbmall/tshow")}return!1}),this._btns.bdsearch=$('<a href="http://www.baidu.com">\u767E\u5EA6\u9996\u9875</a>'),this._btns.tbmall=$('<div class="u_menu_item u_menu_tbmall"><a class="u_menu_wrap u_tbmall_wrap" title="\u70B9\u51FB\u5230\u5546\u57CE\u8D2D\u4E70\u9053\u5177" href="http://tieba.baidu.com/tbmall/home" target="_blank"></a></div>'),this._btns.school=$('<a class="j_school" href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com/&school=1" target="_blank" style="color:red;">\u6821\u56ED\u7528\u6237\u6CE8\u518C\u901A\u9053</a>'),this._btns.app=$('<div class="u_menu_item u_menu_app"><a class="u_menu_wrap u_app_wrap" title="\u8D34\u5427\u624B\u673A\u5BA2\u6237\u7AEF" href="http://c.tieba.baidu.com/c/s/download/pc?src=webtbGF" target="_blank"></a></div>'),this._btns.appcenterEntrance=$('<div class="u_menu_item u_menu_appcenterEntrance"><a class="u_menu_wrap u_appcenterEntrance_wrap" href="/f?kw=%D3%A6%D3%C3%D6%D0%D0%C4&fr=userbar" title="\u5E94\u7528\u4E2D\u5FC3" target="_blank">\u5E94\u7528\u4E2D\u5FC3</a></div>'),this._userinfo.is_login?(this._buildLoginLayout(),this._buildWallet(),this._buildNews(),e._buildOfflineCard(),TbCom.process("User","getUserInfoByRequest",function(t){e._initURLs(t),e._buildUsername(t),e._buildUSetting(t),e._buildJoinVip(t),e._buildToHome(t)})):(this._buildLogoutLayout(),this._buildJoinVip(),this._buildToHome()),this._bindEvent(s)},_buildLoginLayout:function(){var t=["<ul>",'<li class="u_username" id="j_u_username"></li>','<li class="u_setting"></li>','<li class="u_wallet"></li>','<li class="u_news"></li>','<li class="u_tbmall"></li> ','<li class="u_app"></li>','<li class="u_split"></li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this.$root.html(t),this._btns.logout=$('<a href="#" >\u9000\u51FA</a>'),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this.$root.find(".u_tshow").append(this._btns.tshow)},_buildLogoutLayout:function(){var t=["<ul>",'<li class="u_hermes"></li>','<li class="u_login"></li>','<li class="u_reg"></li>','<li class="u_tbmall"></li>','<li class="u_app"></li>','<li class="u_split"></li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this._btns.hermes=$('<div class="u_menu_item"><a href="/hermes/feedback">\u95EE\u9898\u53CD\u9988</a></div>'),this._btns.reg=$('<div class="u_menu_item"><a href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com?tb_mod=userBar&tb_fr=index" onclick="return false;" >\u6CE8\u518C</a></div>'),this._btns.login=$('<div class="u_menu_item"><a href="#" onclick="return false;">\u767B\u5F55</a></div>'),this.$root.html(t),this.$root.find(".u_hermes").append(this._btns.hermes),this.$root.find(".u_reg").append(this._btns.reg),this.$root.find(".u_login").append(this._btns.login),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this._btns.reg.click(function(){TbCom.process("User","buildRegisterFrame","userBar")}),this._btns.login.click(function(){_.Module.use("common/widget/LoginDialog",["","userBar"])})},_buildUsername:function(t){var e=this.$root.find(".u_username"),i=$('<div class="u_menu_item u_menu_username"></div>'),a=t.name_weak,s="",n="";n=t.no_un?"https:/passport.baidu.com/v2/?ucenteradduname&u="+encodeURIComponent(location.href):"http://tieba.baidu.com/home/main?id="+t.portrait+"&fr=userbar";var r="";t.Parr_props&&t.Parr_props.level&&t.Parr_props.level.end_time>Env.server_time/1e3&&(r='style="color:#FF0000;"'),s='<img class="u_username_avatar" src="http://tb.himg.baidu.com/sys/portrait/item/'+t.portrait+'"/>',s='<a href="'+n+'" title="\u70B9\u51FB\u5230\u4E2A\u4EBA\u4E2D\u5FC3" class="u_menu_wrap u_username_wrap">'+s+'<span class="u_username_title" '+r+">"+a+"</span></a>",i.html(s),e.append(i);var o="";if(t.rt_room_id){var l="";for(var _ in t.rt_room_id)_&&(l=_);o='<li class="u_liveroom"><a href="/show/'+l+'" target="_blank">\u6211\u8981\u76F4\u64AD</a></li>'}var u='<ul><li class="u_itieba"><a href="/home/main?id='+t.portrait+'&fr=userbar" >\u6211\u7684\u8D34\u5427</a></li><li class="u_mytbmall"><a href="/tbmall/mymall" target="_blank">\u6211\u7684\u5546\u57CE</a></li><li class="u_favor" location="user_favor_ch"><a href="'+this._urls.my_favor+'" target="_blank">\u6211\u7684\u6536\u85CF</a></li><li class="u_pan"><a href="http://pan.baidu.com/" target="_blank">\u6211\u7684\u7F51\u76D8</a></li><li class="u_game"><a href="/game/index" target="_blank">\u6211\u7684\u6E38\u620F</a></li>'+o+'<li class="u_blue"><a class="j_u_blue" href="/f?ie=utf-8&kw=%E8%93%9D%E9%92%BB&fr=search" target="_blank">\u6211\u7684\u84DD\u94BB</a></li><li class="u_grab_treasure"><a class="j_u_grab_treasure" href="/diamondmall/center/orderList" target="_blank">\u6211\u7684\u593A\u5B9D</a></li></ul>',c=this._ddls.uname=this.use("DropDownList",e,i,"uname");c.innerContent("top",u)},_buildUSetting:function(t){var e=this,i=this.$root.find(".u_setting"),a=$('<div class="u_menu_item u_menu_setting"><a class="u_menu_wrap u_setting_wrap" href="#" onclick="return false;"></a></div>');i.append(a);var s=["<ul>",'<li><a href="http://passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0">\u5E10\u53F7\u8BBE\u7F6E</a></li>','<li class="u_tb_profile"><a href="',this._urls.itb_profile,'">\u8D34\u5427\u8BBE\u7F6E</a></li>','<li class="pm_center"><a href="http://tieba.baidu.com/pmc" class="j_pmc-center" target="_blank">\u670D\u52A1\u4E2D\u5FC3</a></li>','<li class="fuwu_center"><a href="http://tieba.baidu.com/hermes/feedback" class="j_help-center" target="_blank">\u95EE\u9898\u53CD\u9988</a></li>','<li class="u_logout"></li>',"</ul>"].join(""),n=this._ddls.usetting=this.use("DropDownList",i,a);n.innerContent("top",s),$("body").on("click.helpcenter",".j_help-center",function(){$.stats.track("helpcenter","UEG-track-click","userbar","click")}),t.no_un&&i.find(".u_tb_profile a").click(function(){return TbCom.process("User","buildUnameFrame"),!1}),i.find(".u_logout").append(this._btns.logout),this._btns.logout.click(function(){e._logout()})},_buildWallet:function(){var t=this,e=this.$root.find(".u_wallet"),i=$('<div class="u_menu_item u_menu_wallet"><a class="u_menu_wrap u_wallet_wrap j_wallet" title="\u70B9\u51FB\u67E5\u770BT\u8C46\u8D26\u5355" href="#" onclick="return false;"></a></div>');e.append(i),e.find(".j_wallet").on("click",function(e){$.stats.track("T\u8C46\u5BFC\u822A\u680F","\u4F1A\u5458\u5B98\u7F51\u7EDF\u8BA1"),e.preventDefault(),t.requireInstance("common/widget/wallet_dialog").show()})},_flowRateTest:function(){var t=this.requireInstance("common/widget/payMember"),e={fr:"userbar"};t.showCashier(e)},_buildJoinVip:function(t){var e=this.$root.find(".u_joinvip"),i=!1,a="\u4F1A\u5458\u5B98\u7F51";t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time>Env.server_time?(i=!0,a=(t.Parr_props.level.props_id>1?"\u7EED\u8D39\u8D85\u7EA7":"\u5347\u7EA7\u8D85\u7EA7")+"\u4F1A\u5458"):t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time<Env.server_time&&(i=!0,a="\u5F00\u901A\u4F1A\u5458");var s=$('<div class="u_menu_item u_menu_joinvip"><a class="u_joinvip_wrap vip_red j_btn_getmember" href="javascript:;"  target="_blank">'+a+"</a></div>");e.append(s),this.isMemeber=i},_buildToHome:function(){var t=this,e=this.$root.find(".u_joinvip"),i="\u767E\u5EA6\u9996\u9875",a=t.requireInstance("common/widget/http_transform"),s=a.httpTransform("http://www.baidu.com?tn=SE_hldp03480_530ir7bs"),n=$('<li class="u_bdhome"><div class="u_menu_item u_menu_bdhome j_u_menu_bd_home_link"><a  href="'+s+'" target="_blank" onclick="$.stats.track(\'top_baiduhomepage_link\', \'ps_callback_statics\')">'+i+"</a></div></li>");e.after(n),e.on("click",".j_u_menu_bd_home_link",function(){$.stats.track("\u53EC\u5524\u5EA6\u5A18\u70B9\u51FB\u91CF","\u7528\u6237\u6761")})},_buildOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(t.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":1010,right:10,top:30},arrow_pos:{left:70,top:-8},wrap:$("#com_userbar"),card_leave_display:!0}),t.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}),t.offline_card.showCard())},_buildNews:function(){this.use("common/widget/newMessageSystem")},_logout:function(){var t,e=0,i=this;try{t=PageData.user?PageData.user.name:PageData.user_info.name}catch(a){t=""}try{e="baidubrowser.tieba"==window.external.GetVersion("version")?!0:null}catch(a){e=null}(!$.cookie("baidu_broswer_setup_"+t)&&!e||"NaN"===$.cookie("baidu_broswer_setup_"+t))&&$.cookie("baidu_broswer_setup_"+t,0);var s='<p>\u786E\u5B9A\u8981\u9000\u51FA\u5417\uFF1F\u9000\u51FA\u540E\u5C06\u65E0\u6CD5\u6536\u5230\u5427\u53CB\u4E92\u52A8\u6D88\u606F</p><p><span>\u60A8\u53EF\u4EE5\u9009\u62E9</span><span class = "switch_login">\uFF3B\u5207\u6362\u8D26\u6237\uFF3D</span></p><div class = "quit_logout btn_logout">\u9000\u51FA</div><div class = "cancel_logout btn_logout">\u53D6\u6D88</div>',n=new $.dialog({html:s,height:"120px",width:"430px",title:"\u786E\u5B9A\u8981\u9000\u51FA\u5417\uFF1F",holderClassName:"logout_dialog"});$(".logout_dialog").on("click",".switch_login",function(){return n.close(),i.requireInstance("common/widget/LoginDialog"),!1}).on("click",".cancel_logout",function(){n.close()}).on("click",".quit_logout",function(){TbCom.process("User","logout")})}}}),_.Module.define({path:"common/widget/Userbar/DropDownList",requires:[],sub:{_ite:null,_wrapper:null,key:null,_listWrapper:null,_conWrapper:null,_bottomConWrapper:null,_topConWrapper:null,initial:function(t,e,i){this._wrapper=t,this._ite=e,this.key=i,this._build()},_build:function(){var t=['<div class="u_ddl">','<div class="u_ddl_con">','<div class="u_ddl_con_top"></div>','<div class="d_ddl_con_bottom"></div>',"</div>","</div>"].join("");this._listWrapper=$(t),this._wrapper.append(this._listWrapper),this._conWrapper=this._listWrapper.find(".u_ddl_con:first"),this._topConWrapper=this._listWrapper.find(".u_ddl_con_top:first"),this._bottomConWrapper=this._listWrapper.find(".d_ddl_con_bottom:first"),this._bindEvents()},_bindEvents:function(){var t,e=this;e._wrapper.hover(function(){t&&clearTimeout(t),e.expand()},function(){t=setTimeout(function(){e.close()},0)})},_innerTopContent:function(t){"object"==typeof t?this._topConWrapper.append(t):"string"==typeof t&&this._topConWrapper.html(this._topConWrapper.html()+t)},_innerBottomContent:function(t){"object"==typeof t?this._bottomConWrapper.append(t):"string"==typeof t&&this._bottomConWrapper.html(this._bottomConWrapper.html()+t),this._bottomConWrapper.css("display","block")},expand:function(){this._ite.addClass("u_menu_hover"),this._listWrapper.css({display:"block"})},close:function(){this._ite.removeClass("u_menu_hover"),this._listWrapper.css("display","none")},innerContent:function(t,e){"top"==t?this._innerTopContent(e):"bottom"==t&&this._innerBottomContent(e)}}});_.Module.define({path:"common/widget/footer",requires:[],sub:{initial:function(){this._handleEvents()},_handleEvents:function(){var i=$("#btnFroceToPad");i.bind("click",function(){$.cookie("tb_device",null),url=window.location.href.toString(),-1!==url.indexOf("kw")&&-1===url.indexOf("ie=utf-8")&&(url+=-1!==url.indexOf("?")?"&ie=utf-8":"?ie=utf-8"),window.location.href=url})}}});_.Module.define({path:"common/widget/poptip",sub:{_cookieKey:"poptip_0",initial:function(o){o=o||{};var e=$("#common_poptip_html").html(),i=/pv_code=.?(\d+).?/.exec(e);null!=i&&(this._cookieKey="poptip_"+i[1]),this._isShowed(this._cookieKey)||this._show(e,o)},_show:function(o,e){var i=this,t={content:o,arrow_dir:"up",bubble_css:{top:20,right:20,width:null!=e.width?e.width:228},arrow_pos:{right:15},wrap:$("body"),closeBtn:!0,arrowReq:!1},n=new UiBubbleTipBase(t);n.bind("onclose",function(){i._setShowed(i._cookieKey),n.closeBubble()}),n.showBubble()},_setShowed:function(o){$.cookie(o,1,{expires:30})},_isShowed:function(o){return null!=$.cookie(o)}}});_.Module.define({path:"common/widget/AdStats",sub:{adPositionConfig:[{locate:"\u53F3\u4E0A\u65B9button",locateClass:"#search_button",adId:"1"},{locate:"\u53F3\u4FA7\u56FE\u7247",locateClass:"#aside_ad .aside_ad_pic",adId:"2"},{locate:"\u5F39\u7A97",locateClass:"#pop_frame .pop_button_w",adId:"3"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E00",locateClass:".suggestion_list .item_top1",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E8C",locateClass:".suggestion_list .item_top2",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E09",locateClass:".suggestion_list .item_top3",adId:"4"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E00\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(0)",adId:"5"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(1)",adId:"6"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E09\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(2)",adId:"7"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E8C\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(1) a:eq(2)",adId:"8"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E09\u5E27",locateClass:"#carousel_wrap .img_list_1pic a",adId:"9"},{locate:"PC\u9996\u9875\u6735\u6735\u5947\u5427",locateClass:".rcmd_forum_list a",adId:"10"},{locate:"PC\u9996\u9875\u4E3B\u9898\u5427\u63A8\u8350",locateClass:".gr_f_list .good_forum",adId:"11"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5927\u5385\u8F6E\u64AD\u56FE",locateClass:".act_slider_area .good_act_page a",adId:"12"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5E73\u53F0\u63A8\u5E7F\u4F4D",locateClass:"#plat_act_wrapper .platact_lucky",adId:"13"},{locate:"PC\u9996\u9875\u70ED\u95E8\u52A8\u6001\u7B2C\u4E8C\u4F4D\u7F6E",locateClass:"",adId:"14"},{locate:"PC\u9996\u9875\u65B0\u589E\u5165\u9A7B",locateClass:".adide_platform a.pii_img_w, .adide_platform a.h6",adId:"15"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u56FE\u7247",locateClass:"#notice_item a.notice",adId:"16"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u5217\u8868",locateClass:"#notice_item .notice_list a",adId:"16"},{locate:"\u5427\u76AE\u80A4",locateClass:".couplet_left, .couplet_right",adId:"17"},{locate:"\u8D34\u5427\u9876\u90E8\u5934\u56FE",locateClass:".star_banner .j_click_status",adId:"18"},{locate:"\u8D34\u5427\u5DE6\u4FA7\u6D6E\u6807",locateClass:".j_platform_float_content",adId:"19"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6D3B\u52A8\u7EC4\u4EF6",locateClass:".platforum_aside_images .platform_aside_images_img a",adId:"20"},{locate:"\u8D34\u5427\u53F3\u4E0B\u65B9\u89C6\u9891\u7EC4\u4EF6",locateClass:".platform_spread_video a",adId:"21"},{locate:"\u8D34\u5427\u5BFC\u822A\u4E0A\u65B9\u5F3A\u63A8\u5E7F\u6837\u5F0F",locateClass:"",adId:"22"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6587\u5B57\u94FE/\u56FE\u7247\u805A\u5408\u6A21\u5757",locateClass:"",adId:"23"},{locate:"\u8D34\u5427feed\u6D41\u7279\u578B\u62BD\u5956\u8D34",locateClass:".threadlist_detail .platact_lucky",adId:"24"}],adObjType:"\u5E73\u53F0\u5316",adTask:"\u5546\u5E7F\u4F4D\u7EDF\u8BA1",initial:function(){var a=this.adPositionConfig,t=this.adObjType,l=this.adTask;$.each(a,function(){var a=this;this.locateClass&&this.locateClass.length>0&&$("body").on("mousedown",this.locateClass,function(){var e=$(this);$.stats.track(a.locate,l,null,"click",{obj_url:e.tbattr("href")||"-",obj_name:a.adId||"-",obj_type:t})})})}}});_.Module.define({path:"common/widget/searchHandler",sub:{_staticUrl:{no_key:"http://tieba.baidu.com/","\u8D34\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u5E16\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new",tiebatousu:"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u5427":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u4E3E\u62A5":"http://tieba.baidu.com/tousu/new","\u77E5\u9053\u6295\u8BC9":"http://tousu.baidu.com/zhidao","\u7A7A\u95F4\u6295\u8BC9":"http://tousu.baidu.com/hi","\u767E\u79D1\u6295\u8BC9":"http://tousu.baidu.com/baike",zhidaotousu:"http://tousu.baidu.com/zhidao",kongjiantousu:"http://tousu.baidu.com/hi",baiketousu:"http://tousu.baidu.com/baike"},_sendStatistics:function(t){$.stats.sendRequest("st_mod=search&search_type="+t)},initial:function(){},toStaticUrl:function(t){var e=t.toLowerCase();return this._staticUrl.hasOwnProperty(e)?($.tb.location.setHref(this._staticUrl[e]),!1):void 0},enterBa:function(t,e){if(""==t)return $.tb.location.setHref(this._staticUrl.no_key),!1;this.toStaticUrl(t);var s=[];if(s=-1!=t.indexOf("\uFF1A")?t.split("\uFF1A"):t.split(":"),2==s.length){if("\u6807\u7B7E"==s[0])return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1;if(-1!=s[0].indexOf("\u5427\u5185")){var o=s[0].split("\u5427\u5185")[0];if(o)return this._sendStatistics("baneisearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(o))+"&qw="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1}}if(PageData.search_what&&"fromBtn"!=e){if("composite"==PageData.search_what)return this._sendStatistics("compositesearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1;if("forum"==PageData.search_what)return this._sendStatistics("forumsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1}return this._sendStatistics("enterba&from=search",t),$.tb.location.setHref("/f?ie=utf-8&kw="+encodeURIComponent(t)+"&fr=search"),!1},searchPost:function(t){return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("postsearch",t),setTimeout(function(){$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t)))},100),!1},searchPostInBa:function(t,e){var s="/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(e))+"&qw="+encodeURIComponent($.tb.escapeHTML(t));return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("baneisearch",t),setTimeout(function(){$.tb.location.setHref(s)},100),!1},searchPeople:function(t){return this._sendStatistics("peoplesearch",t),$.tb.location.setHref("/f/search/sure?ie=utf-8&only_user=1&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchTag:function(t){return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchForum:function(t){var e="/f/search/fm?ie=UTF-8&";return-1!=t.indexOf("\u6807\u7B7E\uFF1A")?(t=t.substr(t.indexOf("\u6807\u7B7E\uFF1A")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):-1!=t.indexOf("\u6807\u7B7E:")?(t=t.substr(t.indexOf("\u6807\u7B7E:")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):e=e+"qw="+encodeURIComponent($.tb.escapeHTML(t)),$.tb.location.setHref(e),!1}}});_.Module.define({path:"common/widget/suggestion",requires:["common/widget/suggestion/base"],sub:{options:{input:null,maxCount:12,skipTime:50,classes:{expand:"suggestion",expandList:"suggestion_list"}},initial:function(i){this.options=$.extend(this.options,i),this.initSug()},initSug:function(){this.options.input&&this.requireInstance("common/widget/suggestion/base",[this.options])}}});
;_.Module.define({path:"common/widget/suggestion/base",requires:["common/widget/suggestion/events"],sub:{runtime:{disabled:!1},initial:function(t){this.options=t,this.input=this.options.input,this.wrapper=this.options.fixWrapper,this.sug=null,this.dataList=[],this.create()},create:function(){var t=['<div class="#{expand}">','<ul class="#{expandList}">',"</ul>","</div>"].join(""),i=this.input,s=i.offset(),e=i.outerWidth()-2,n=i.outerHeight()+s.top-1,o=s.left,h=this.wrapper?this.wrapper:$("body");this.sug=$($.tb.format(t,this.options.classes)).css({left:o,width:e,top:n}).hide(),h.append(this.sug),this.ableControl(),this.bindEvents()},bindEvents:function(){this.requireInstance("common/widget/suggestion/events",[{input:this.input,sug:this.sug,options:this.options}])},ableControl:function(){var t=$('input.jointb[type="radio"]'),i=$('input.authortb[type="radio"]'),s=$('input.searchtb[type="radio"]');t.length>0&&t.bind("click",this.able()),i.length>0&&i.bind("click",this.able()),s.length>0&&s.bind("click",this.disable()),0!=t.length&&t.tbattr("checked")||this.disable()},able:function(){this.runtime.disabled=!1},disable:function(){this.runtime.disabled=!0,this.sug.hide()}}});
;_.Module.define({path:"common/widget/suggestion/events",requires:["common/widget/suggestion/data"],sub:{skippedType:["operation_title","often_forum_title","relation_forum_title","relation_game_title","more_title"],initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.wrapper=this.options.options.fixWrapper,this.skipTime=this.options.options.skipTime,this.target=null,this.toggleFlag=!1,this.mouseIn=!1,this.query="",this.bindEvents(),this.initRequest()},initRequest:function(){this.data=this.requireInstance("common/widget/suggestion/data",[{input:this.input,sug:this.sug,forumName:this.options.options.forumName,maxCount:this.options.options.maxCount}])},delayRequest:function(){return this.query=this.getQuery(),this.data.delayRequest(this.skipTime,this.query)},bindEvents:function(){if(this.options.searchFixed){var t=this.wrapper.offset().top,i=$(window).scrollTop();this.toggleFlag=t>i,this.fixSize(!0)}$(window).bind("scroll",$.proxy(this.fixSize,this)).bind("resize",$.proxy(this.fixSize,this)),this.input.bind("keyup",$.proxy(this.handleKeyup,this)).bind("keydown",$.proxy(this.handleKeydown,this)).bind("paste",$.proxy(this.handleElseEvents,this)).bind("focusin",$.proxy(this.handleElseEvents,this)).bind("click",$.proxy(this.handleElseEvents,this)).bind("focusout",$.proxy(this.handleFocusout,this)).bind("compositionend",$.proxy(this.handleElseEvents,this)),this.sug.on("mouseenter","li",$.proxy(this.handleMouseenter,this)).on("mouseleave","li",$.proxy(this.handleMouseleave,this)).on("click","li:not(.tbtopic)",$.proxy(this.handleFire,this))},handleKeyup:function(t){$.inArray(t.keyCode,[16,17,18,20,37,38,39,40])>=0||13!=t.keyCode&&this.delayRequest()},handleKeydown:function(t){if(!($.inArray(t.keyCode,[16,17,18,20,37,39])>=0))switch(t.keyCode){case 13:return this.handleFire();case 38:return this.prevActive(),!1;case 40:return this.nextActive(),!1;default:this.clearState()}},handleMouseenter:function(t){var i=$(t.currentTarget);this.mouseIn=!0,this.active(i)},handleMouseleave:function(){this.mouseIn=!1},handleFocusout:function(){this.mouseIn||(this.clearState(),this.sug.hide())},handleElseEvents:function(){this.delayRequest()},handleFire:function(){var t=this,i=this.input.getData();return i&&i.sugUrl?(this.clickStats(i),$.tb.location.setHref($.tb.unescapeHTML(i.sugUrl)),t.sug.hide(),!1):!0},clickStats:function(t){var i=t.sugType;switch(i){case"game_item":this.clickGameStats(t);break;case"operation_item":this.clickOperationItemStats(t)}},clickGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u70B9\u51FB",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u6E38\u620F"})},clickOperationItemStats:function(t){$.stats.track(t.sugValue,"\u641C\u7D22\u6846\u8FD0\u8425\u914D\u7F6E\u9879\u7EDF\u8BA1","","click",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u5E73\u53F0\u5316"}),$.stats.track("sug\u5165\u53E3","\u5427\u53CB\u70ED\u8BAE","","click"),$.stats.track("search_box_suggestion","ps_callback_statics")},fixSize:function(t){var i=this;this.fixTime&&clearTimeout(this.fixTime),this.fixTime=setTimeout(function(){var e=i.wrapper.offset().top,s=$(window).scrollTop(),n=i.input,a=n.offset(),o=n.outerHeight()+a.top-1,u=n.outerWidth()-2,h=a.left;if(e>s===i.toggleFlag){if(!t)return}else i.toggleFlag=e>s,i.sug.hide();i.wrapper.hasClass("search_main_fixed")&&(o=n.outerHeight()+5),i.sug.css({width:u,left:h,top:o})},0)},changeState:function(t){var i=t.getData().sugType,e=t.getData().sugUrl,s=t.getData().sugValue;this.input.bindData({sugType:i,sugUrl:e,sugValue:s})},clearState:function(){this.input.bindData({})},active:function(t){if(t.getData()){var i=t.getData().sugType,e=this.skippedType.slice(0,-1);if($.inArray(i,e)>-1)return this.clearState(),void 0;this.target=t,this.addOn(t),this.changeState(t)}},nextActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.next().length?this.target.next():this.sug.find("ul li").eq(0);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.nextActive()):this.active(i)}},prevActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.prev().length?this.target.prev():this.sug.find("ul li").eq(-1);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.prevActive()):this.active(i)}},addOn:function(t){t.siblings("li").removeClass("on"),t.addClass("on")},getQuery:function(){return this.input.tbattr("value")},setQuery:function(t){return this.input.tbattr("value",t)}}});
;_.Module.define({path:"common/widget/suggestion/data",requires:["common/widget/suggestion/render"],sub:{settings:{url:"/suggestion",isCache:!0,defaultQuery:"DEFAULTQUERY"},initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.forumName=this.options.forumName,this.maxCount=this.options.maxCount||10,this.curCount=0,this.query="",this.dataList=[],this.cache={}},handleResponse:function(t,e){if(0!==e.error)return!1;this.curCount=0,this.query=t;var s=e.hottopic_list.search_data,a=e.query_match.search_data,i=e.query_tag.search_data,r=e.suggest_game&&e.suggest_game.search_data;this.checkData(s)&&(this.formatData("operation_title"),this.formatOperateData(s)),this.checkData(a)&&(this.checkData(s)&&this.formatData("often_forum_title"),this.formatForumData(a)),this.checkData(r)?(this.formatData("relation_game_title"),this.formatGameData(r)):this.checkData(i)&&(this.formatData("relation_forum_title"),this.formatForumData(i)),!this.checkData(a)&&!this.checkData(i)||this.checkMore(t)||this.formatData("more_title","/f/search/fm?ie=UTF-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),this.renderItems(),this.viewStats()},formatOperateData:function(t){var e,s,a=this,i=a.requireInstance("common/widget/http_transform",[]);for(e=0;e<t.length&&5>e&&this.checkCount();e++){s=t[e];var r=i.httpTransform(this.replaceAmp(s.topic_url));this.dataList.push({sugType:"operation_item",position:e+1,name:s.topic_name,desc:"",sugUrl:r}),this.curCount++}},formatGameData:function(t){var e,s,a=[];for(e=0;e<t.length&&this.checkCount();e++)s=t[e],this.dataList.push({sugType:"game_item",name:s.game_name,title:this.highlightForumName(s.game_name),pic:s.icon_url,desc:s.description,sugUrl:s.link_href}),this.curCount++,a.push(s.game_name);a.length>0&&this.viewGameStats(a)},formatForumData:function(t){var e,s,a;for(e=0;e<t.length&&this.checkCount();e++)s=t[e],s.fname!==this.forumName&&(a="",s.stock_alias&&""!==s.stock_alias&&(a=s.stock_alias+" "+s.fname),this.dataList.push({sugType:"forum_item",name:s.fname,title:this.highlightForumName((a?a:s.fname)+"\u5427"),pic:s.fpic,desc:s.forum_desc?s.forum_desc:s.fclass2?"\u6240\u5C5E\u76EE\u5F55\uFF1A"+s.fclass1+"&nbsp; "+s.fclass2:"",member:s.member_num,thread:s.thread_num,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(s.fname))}),this.curCount++)},queryData:function(){var t=this.query;this.dataList.push({sugType:"reverse_query",name:t,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(t))})},formatData:function(t,e){var s=this.query;this.dataList.push({sugType:t,name:s,sugUrl:e})},getQuery:function(){return this.input.tbattr("value")},clearSuggestion:function(){this.dataList=[]},checkCount:function(){return this.curCount<this.maxCount},checkData:function(t){return $.isArray(t)&&t.length>0},checkMore:function(t){return!t||/^\s+$/.test(t)||t===this.forumName},replaceAmp:function(t){return t&&t.replace(/\&amp;/g,"&")},formatString:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},highlightForumName:function(t){var e="",s="",a=this.query,i=new RegExp(a.replace(/[\/\\]/g,""),"g");return e=$.tb.escapeHTML(t),s=a?e.replace(i,function(t){return'<em class="highlight">'+t+"</em>"}):e},renderItems:function(){var t="",e=this.requireInstance("common/widget/suggestion/render");this.dataList.length>0&&this.queryData(),t=e.renderSuggestion(this.dataList),""!==t?this.sug.show().find("ul").html(t):this.sug.hide(),this.clearSuggestion()},viewStats:function(){function t(t){$.stats.track(t.locate,t.task,t.page,t.type,{client_type:"pc_web"})}t({locate:"\u9996\u9875sug\u5165\u53E3",task:"\u5427\u53CB\u70ED\u8BAE",page:"index",type:"show"})},viewGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u5C55\u73B0",{obj_name:this.query,obj_game_name:t,obj_type:"\u6E38\u620F"})},request:function(t){var e=this;t===this.forumName&&(t="");var s=""===t?this.settings.defaultQuery:t;this.settings.isCache&&s in this.cache?this.handleResponse(t,this.cache[s]):(this.queryRequest&&this.queryRequest.abort(),this.queryRequest=$.ajax({url:this.settings.url,data:{query:t,ie:"utf-8"},dataType:"json",type:"get",cache:!1,success:function(s){e.responseSuccess(t,s)}}))},delayRequest:function(t,e){var s=this;this.requestTimer&&clearTimeout(this.requestTimer),this.requestTimer=setTimeout(function(){s.request(e),clearTimeout(s.requestTimer),s.requestTimer=null},t)},responseSuccess:function(t,e){if(this.settings.isCache){var s=""===t?this.settings.defaultQuery:t;this.cache[s]=e}this.handleResponse(t,e),this.queryRequest=null}}});
;_.Module.define({path:"common/widget/suggestion/render",requires:[],sub:{queryTemplate:'<li class="reserve_query" #{info}></li>',titleTemplate:['<li class="break_title #{special}" #{info}>','<span class="break_tip">#{title}</span>',"</li>"].join(""),forumTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}','<span title="\u4F1A\u5458\u6570" class="forum_member">#{member}</span>','<span title="\u4E3B\u9898\u6570" class="forum_thread">#{thread}</span>',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),gameTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),operationTemplate:["<li #{info}>",'<div class="operation_item item_top#{position}">',"<i></i>",'<div class="operation_title">#{name}</div>','<div class="operation_desc">#{desc}</div>',"</div>","</li>"].join(""),initial:function(){},renderQuery:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.queryTemplate,{info:i})},renderTitle:function(e){var i="",t="",r=e.name,s=$.tb.dataField({sugType:e.sugType,sugValue:r,sugUrl:e.sugUrl});switch(e.sugType){case"operation_title":i="\u5427\u53CB\u70ED\u8BAE";break;case"often_forum_title":i="\u6700\u8FD1\u5E38\u901B\u7684\u5427\uFF1A";break;case"relation_forum_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u5427\uFF1A";break;case"relation_game_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u6E38\u620F\uFF1A";break;case"more_title":i='\u5728\u8D34\u5427\u4E2D\u641C\u7D22\u66F4\u591A\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u76F8\u5173\u7684\u5427",t="special_title"}return $.tb.format(this.titleTemplate,{info:s,special:t,title:i})},renderForum:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.forumTemplate,e)},renderGame:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl+(e.sugUrl.indexOf("?")<0?"?":"&")+"gfr=search_suggestion"});return $.extend(e,{info:i}),$.tb.format(this.gameTemplate,e)},renderOperation:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.operationTemplate,e)},renderSuggestion:function(e){var i,t="",r=null,s=e.length;for(i=0;s>i;i++)switch(r=e[i],r.sugType){case"reverse_query":t+=this.renderQuery(r);break;case"operation_item":t+=r.str?r.str:this.renderOperation(r);break;case"forum_item":t+=this.renderForum(r);break;case"game_item":t+=this.renderGame(r);break;default:t+=this.renderTitle(r)}return t}}});_.Module.define({path:"common/widget/searchBright",requires:["common/widget/searchHandler","common/widget/suggestion"],sub:{_jq_wrap:null,_jq_input:null,_jq_input_box:null,_jq_form:null,_options:{defaultType:"tieba",style:"",forumName:"",page:null},_tip:null,_searchHandler:null,_switchRadios:{},_radioClasses:{tieba:"jointb",itieba:"authortb",post:"searchtb",benba:"nowtb",tag:"searchtag",forum:"searchforum"},_searchTypes:{tieba:1,itieba:2,post:3,benba:4,tag:5,forum:6},_searchFixed:null,initial:function(e,t){var i=this.requireInstance("common/widget/http_transform"),s=$(".j_search_nav").find("a[param=wd]");if(i.httpLinkHover(s),this._jq_wrap=e,this._jq_form=e.find(".j_search_form"),this._jq_input=e.find("#wd2"),this._jq_input_box=e.find(".j_search_input"),this._tip=PageUnit.load("search_input_tip"),this._searchFixed=t.searchFixed,this._searchWrapper=e.find(".search_main"),this._sugOn=t.sugOn,PageData.searchFixed=this._searchFixed,$.extend(this._options,t),this._initOptPage(),this._searchHandler=this.use("common/widget/searchHandler"),this._setSwitchRadios(),this._setDefaultType(),this._setSearchType(this._options.defaultType),this._initPlaceholder(),this._bindEvents(),$.browser.msie&&parseInt($.browser.version)<=7)return!1;if(this._searchScrollFixed(),"1"==this._sugOn){var t={input:this._jq_input_box,forumName:t.forumName,searchFixed:t.searchFixed,fixWrapper:this._searchWrapper};this.use("common/widget/suggestion",t)}else TbCom.process("Suggestion","createMainSearchSuggestion")},_setSwitchRadios:function(){var e=this;for(var t in this._searchTypes)this._switchRadios[t]=e._jq_wrap.find(".switch_radios ."+e._radioClasses[t]+":first")},_setDefaultType:function(){var e=$.tb.location.getHref();-1!=e.indexOf("/f/search/fm")?this._options.defaultType="forum":-1!=e.indexOf("/f/search/res")?this._options.defaultType="post":-1!=e.indexOf("/f/search/sure")&&(this._options.defaultType="itieba"),"bright_3"==this._options.style&&(this._options.defaultType="benba")},_getSearchType:function(){var e=null;if(this._options.theme&&"bright_pb"==this._options.theme)return e=this._searchTypes.benba;e=this._searchTypes.tieba;for(var t in this._switchRadios){var i=this._switchRadios[t];if(i.tbattr("checked")){e=this._searchTypes[t];break}}return e},_setSearchType:function(e){e in this._switchRadios&&("2"==this._searchTypes[e]&&this._switchRadios.tieba.tbattr("checked",!1),this._switchRadios[e].tbattr("checked",!0))},_bindEvents:function(){var e=this;this._jq_wrap.find("#search_button").on("click",function(){"frs"===PageData.product?$.stats.track("FRS_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"}):"pb"===PageData.product&&$.stats.track("PB_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"})}),this._jq_wrap.find(".j_search_nav a").click(function(){e._changeProduct($(this))}),this._jq_form.submit(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e.submit(),!1}),this._jq_wrap.find(".j_enter_ba").click(function(){return e.submit("fromBtn"),!1}),this._jq_wrap.find(".j_search_post").click(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e._searchPost(),!1}),this._jq_wrap.find(".j_benba_search").click(function(){"bright_pb"==e._options.theme&&e.handleSubmit(e._getSearchType(),e.getSearchWord())}),this._jq_input_box.bind("webkitspeechchange",function(){e.submit()}),$.browser.webkit?this._jq_input_box.click(function(){this.select()}):this._jq_input_box.focus(function(){this.select()})},submit:function(e){var t=this.getSearchWord();return $("#searchtag").tbattr("checked")?this._searchHandler.searchTag(t):this._searchHandler.enterBa(t,e),!1},handleSubmit:function(e,t){var i=!0;switch(e){case this._searchTypes.tieba:i=this._searchHandler.enterBa(t);break;case this._searchTypes.itieba:i=this._searchHandler.searchPeople(t);break;case this._searchTypes.post:i=this._searchHandler.searchPost(t);break;case this._searchTypes.benba:i=this._searchHandler.searchPostInBa(t,this._options.forumName);break;case this._searchTypes.tag:i=this._searchHandler.searchTag(t);break;case this._searchTypes.forum:i=this._searchHandler.searchForum(t);break;default:i=!0}return i},_initOptPage:function(){null==this._options.page&&(/^\w+:\/\/[^\/]+\/(index\.html?)|(i\/\d+)/.test($.tb.location.getHref())?this._options.page="index":/^\w+:\/\/[^\/]+\/tb\/picture\/(index\.html?)/.test($.tb.location.getHref())?this._options.page="picture_index":"itieba3"==PageData.product&&(this._options.page="itieba"))},_changeProduct:function(e){var t=this.getSearchWord(),i=$.tb.unescapeHTML(e.tbattr("href")),s=$.tb.unescapeHTML(e.tbattr("param"));if($.stats.track(e.text(),"pc\u7AEF\u8D34\u5427tab\u9875\u5BFC\u51FA\u7EDF\u8BA1",PageData?PageData.product:"","\u70B9\u51FB"),""==t){var a=i.match(/^(\w+:\/\/[^\/]+)/i),r=i.match(/fr=[^&]+/i),n=[],_="";null!=r&&r.length>0&&n.push(r[0]),n.length>0&&(_="/?"+n.join("&")),e.tbattr("href",a&&a[1]+_)}else if(null!=s&&""!=s){if(i.indexOf("www.baidu.com")>=0){var h="fr=tb01000&";$.tb.location.getHref().match("ftype=guide")&&(h="fr=tb01se0&");var o=i.indexOf("fr=");o>-1?e.tbattr("href",i.substring(0,index)+h):e.tbattr("href",i+h)}var c=e.tbattr("ie");t=null!=c&&null!=c.match(/utf-?8/gi)?encodeURIComponent(t):t.replace(/\%/gi,"%25").replace(/&/gi,"%26").replace(/\+/gi,"%2B").replace(/[\ \u3000]/gi,"%20").replace(/\//gi,"%2F").replace(/\#/gi,"%23").replace(/\=/gi,"%3D");var o=i.indexOf(s+"="),d="UTF-8"==PageData.charset?"&ie=utf-8":"";o>-1?e.tbattr("href",i.substring(0,o)+s+"="+t+d):e.tbattr("href",i+s+"="+t+d)}},_searchPost:function(){var e=this.getSearchWord(),t=$.extend({},this._options);t.defaultType="post",""==e?_.Module.use("common/widget/searchDialog",t):this._searchHandler.searchPost(e)},_initPlaceholder:function(){var e=this;$.inArray(e._options.page,["index","picture_index","itieba"])?"0"==e._tip&&_.Module.use("common/widget/Placeholder",[e._jq_input_box,e._tip,{color:"#bbb","font-size":"13px"}]):e._jq_input.bind("mousedown focus",function(){e._jq_input.val()===e._tip&&(e._jq_input.val(""),e._jq_input_box.val(""))})},_voiceInput:function(){var e=this.getSearchWord(),t=e.indexOf(this._tip);0===t&&(e=e.slice(this._tip.length),this._jq_input.val(e),this._jq_input_box.val(e)),this.submit()},getSearchWord:function(){return this._jq_input_box.val()},isDefaultTip:function(){return this._jq_input_box.val()===this._tip&&this._jq_input_box.hasClass("s_ipt_tip")||""===this._jq_input_box.val()},_searchScrollFixed:function(){if(this._searchFixed){var e=$("#head").find(".search_main"),t=$(".search_main").offset().top,i=$(".app_forum_top_nav").length>0?!0:!1;if(!i){var s=!1;$(window).scroll(function(){setTimeout(function(){var i=$(window).scrollTop();if(i>t){if(s)return;e.addClass("search_main_fixed").hide(),e.fadeIn(100),e.find(".search_form").addClass("search_form_fixed"),e.find(".search_ipt").addClass("search_ipt_fixed"),e.find(".search_btn").addClass("search_btn_fixed"),e.find(".search_btn_enter_ba").addClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").addClass("search_logo_fixed"),e.find("#tb_header_search_form").addClass("j_search_form_fixed"),$("#search_logo_small").addClass("search_logo_fixed"),$("#tb_header_search_form").addClass("j_search_form_fixed"),s=!0}else{if(!s)return;$(".senior-search-link").css({visibility:"visible"}),$("#search_baidu_promote").show(),$("#search_button_wrapper").show(),e.removeClass("search_main_fixed"),e.find(".search_form").removeClass("search_form_fixed"),e.find(".search_ipt").removeClass("search_ipt_fixed"),e.find(".search_btn").removeClass("search_btn_fixed"),e.find(".search_btn_enter_ba").removeClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").removeClass("search_logo_fixed"),e.find("#tb_header_search_form").removeClass("j_search_form_fixed"),s=!1}},1)})}}}}});F.module("props/widget/propsData",function(t,e){function n(){this._api={getProps:"/tbmall/get/userProps"}}var o=null,a={};n.prototype={getProps:function(t,e,n){if(arguments.length<2)throw"At least 2 arguments needed";"undefined"==typeof n?(n=e,e=!0):e=!!e,e&&a[t]?n(a[t]):$.get(this._api.getProps,{category:t,t:(new Date).getTime()},function(e){a[t]=e.data[t]||{},n(a[t])})}},n.getInstance=function(){return null===o&&(o=new n),o},e.getInstance=n.getInstance});_.Module.define({require:["props/widget/propsData"],path:"ihome/widget/skin",requires:[],sub:{initial:function(i){this.opts=i||{},this.skinList=this.opts.skinList||{},this.npcSkinList=this.skinList.npcSkinList||[],this.optionalSkinList=this.skinList.skinList||[];var t=this.require("props/widget/propsData");this.propsInstance=t.getInstance(),this.pageUnit=window.PageUnit,this.version=this.pageUnit.load("skin_version"),this.$wrap1=$(".wrap1"),this.template=$(' "<div id="skin_setting" class="skin_setting">     <ul class="skin_list"></ul>     <ul class="skin_pager"></ul>     <div class="skin_btns">         <a class="ui_btn ui_btn_m btn_bg_save" href="#"><span><em>\u4FDD\u5B58</em></span></a>         <a class="ui_btn ui_btn_sub_m btn_bg_cancel" href="#"><span><em>\u53D6\u6D88</em></span></a>     </div> </div> <div id="noMemberDialog" class="noMemberDialog">     <h4>\u4F7F\u7528\u5931\u8D25</h4>     <p>         \u60A8\u6682\u672A\u8D2D\u4E70\u9053\u5177\uFF0C         <a class="j_bMember" target="_blank"            href="http://tieba.baidu.com/tbmall/tshow?tab=privil">             \u6210\u4E3A\u4F1A\u5458,\u7ACB\u5373\u4EAB\u7528\u6D77\u91CF\u514D\u8D39\u9053\u5177         </a>     </p>      <p>         <a class="j_tobuy" target="_blank"            href="http://tieba.baidu.com/tbmall/propslist?category=113">             \u53BB\u8D2D\u4E70\u8BE5\u9053\u5177         </a>     </p> </div> <div class="error" style="text-align:center;font-size:14px;line-height:30px;"></div> " '.replace(/^ "|" $/g,"")),this.Dialog=$.dialog,this._setDefaultSkin(),this._bindEvents(),this.$wrap1.append($("<span>").addClass("fix-for-ie8")),this.opts.preview&&this._setPreview(this.opts.preview)},_setDefaultSkin:function(){this.opts.bgId||(this.opts.bgId=1001),this._setSkin(this.opts.bgId)},_setPreview:function(i){this.$wrap1.css({backgroundImage:"url("+i+")"})},_getImgSrc:function(i,t){var s="http://tb2.bdstatic.com/tb/static-ihome/img/",n={bg:"bg_v1_",thumb:"thum_",panel:"panel_"},e=s+n[t]+i+".jpg?t=20160117&v="+this.version;return"url("+e+")"},_setSkin:function(i){var t=this._getImgSrc(i,"bg");this.$wrap1.css({backgroundImage:t}),this._bgId=i},_bindEvents:function(){var i=this;$("#headinfo_wrap").on("click",".btn_editbg",function(){var t=$(this);return i.propsInstance.getProps(113,function(s){if(i._propsData=s,!t.data("hasinitial")){var n=$.map(i.npcSkinList,function(i){return s[i.id]?i:void 0});i._options=n.concat(i.optionalSkinList),t.data("hasinitial",1)}i._initSkinList(),i.pageTotal=Math.ceil(i._options.length/8),i.pageTotal>1&&i._initPager()}),!1})},_initSkinList:function(){var i=this,t=i.template.filter(".skin_setting");i._dialog=new i.Dialog({html:t,title:"\u80CC\u666F\u8BBE\u7F6E",width:478,height:245}),i._bindDialogEvents(),i._updateSkinList(i._options.slice(0,8))},_bindDialogEvents:function(){var i=this,t=$("#skin_setting");t.find(".skin_list").on("click",".skin_canset",function(){return $(".skin_canset").removeClass("cur_sel"),$(this).addClass("cur_sel"),i._setSkin($(this).data("bgid")),!1}),t.on("click",".btn_bg_save",function(){if($(".cur_sel").hasClass("need_buy"))return i._dialog.close(),i._showNoMenberDialog(),void 0;var t={tbs:i.opts.tbs};return t.bg_id=i._bgId,$.tb.post("/home/post/setbg",t,function(t){t?0===t.no?$.tb.location.reload():210009==t.no?i._showErrorDialog("\u6210\u529F\u5206\u4EAB\u60A8\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u201D\u8DB3\u8FF9\u201D\u540E\u53EF\u7528"):i._showErrorDialog("\u8BBE\u7F6E\u80CC\u666F\u5931\u8D25"):i._showErrorDialog("\u8BBE\u7F6E\u80CC\u666F\u5931\u8D25")}),!1}).on("click",".btn_bg_cancel",function(){return i._dialog.close(),!1}),i._dialog.bind("onclose",function(){i._setDefaultSkin()})},_showErrorDialog:function(i){this.template.filter(".error").html(i);var t=new this.Dialog({width:300,height:40,html:this.template.filter(".error")}),s=setTimeout(function(){t.close(),clearTimeout(s)},1500)},_showNoMenberDialog:function(){var i=new this.Dialog({width:478,height:200,title:"\u80CC\u666F\u8BBE\u7F6E",html:this.template.filter(".noMemberDialog")}),t=$("#noMemberDialog");t.on("click",".j_tobuy",function(){$.stats.track("","ihome","skin","click")}),t.on("click","j_bMember",function(){$.stats.track("","ihome","skin","click")});var s=setTimeout(function(){i.close(),clearTimeout(s)},3e3)},_updateSkinList:function(i,t){var s=$("#skin_setting"),n=s.find(".skin_list"),e=s.find(".skin_pager");n.html(this._getSkinListHtml(i)),t&&1!=t&&t!=this.pageTotal?e.css({width:30*this.pageTotal+214+"px"}):e.css({width:30*this.pageTotal+107+"px"})},_initPager:function(){var i=this,t=i.requireInstance("common/component/JsPager",{container:$("#skin_setting").find(".skin_pager"),current:1,amount:8,total:i.pageTotal});t.bind("pageChange",function(s,n){var e=i._options.slice(8*(n-1),8*(n-1)+8);i._updateSkinList(e,n),t.initial({current:n})})},_getSkinListHtml:function(i){for(var t=[],s="",n="",e=0;e<i.length;e++)t.push("<li>"),"113"!=String(i[e].id).substring(0,3)||this._propsData[i[e].id]&&this._propsData[i[e].id].end_time>+new Date/1e3?(s="",n=""):(s="need_buy",n="skin_buy"),t.push('<a class="skin_canset '+s+'" href="#" style="background:url(http://tb2.bdstatic.com/tb/static-ihome/img/thum_'+i[e].id+'.jpg?t=20150814) no-repeat;background-size:cover;" class="skin_item_'+i[e].id+'" data-bgid="'+i[e].id+'">'),t.push('<span class="skin_title">'+i[e].title+"</span>"),i[e].isnew?t.push('<span class="skin_angleicon skin_new"></span>'):i[e].isfree?t.push('<span class="skin_angleicon skin_free"></span>'):t.push('<span class="skin_angleicon '+n+'"></span>'),t.push("</a>"),t.push("</li>");return t.join("")}}});_.Module.define({path:"ihome/widget/Headinfo",sub:{initial:function(i){this.dataObj=i,this._bindEvents()},_bindEvents:function(){}}});