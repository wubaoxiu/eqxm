_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"tbmall/widget/gift_page_ctrl",sub:{giftMap:[],emptyListTpl:"<p>\u8BE5\u7C7B\u76EE\u4E0B\u8FD8\u6CA1\u6709\u793C\u7269\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u7C7B\u76EE~</p>",initial:function(t){this.giftList=t.giftList,this.$container=t.$container,this.rendTpl(),$.isEmptyObject(t.giftList)?this.emptyList():(this.formateData(),this.rendList(),this.rendPoint(),this.updateCursor(),this.updateView(),this.addEvents())},emptyList:function(){var t=this.emptyListTpl;this.$container.html(t)},pointTpl:function(t){var i=0,e="";for(i;t>i;i++)e+='<a href="javascript:;" class="btn-point j-gift-page" id="btn-point-'+i+'" data-page="'+i+'"><i></i></a>';return e},formateData:function(){var t=this,i=0;$.each(t.giftList,function(e,a){i++;var s=i%10,r=Math.floor(i/10);if(0==s&&r--,t.giftMap[r]||(t.giftMap[r]=[]),1==a.activity_type){var n=a.begin_time,p=a.end_time,c=Math.round((new Date).getTime()/1e3);a.is_time_limit=n>c?1:c>p?2:0}t.giftMap[r].push(a)});var e=t.giftMap[t.giftMap.length-1],a=e.length,s=5-a%5;if(5!=s)for(s;s>0;s--)e.push({})},rendTpl:function(){var t=_.template('<div class="gift-center-page">     <div class="gift-center-page-list"></div> </div> <a href="javascript:;" class="gift-center-box-cursor left j-gift-page" data-page="left"></a> <a href="javascript:;" class="gift-center-box-cursor right j-gift-page" data-page="right"></a> <div class="gift-center-box-point"></div>')();this.$container.html(t),this.$pageList=this.$container.find(".gift-center-page-list"),this.$pageCursor=this.$container.find(".j-gift-page")},rendList:function(){var t=_.template("<% for (var itemList in list) {     var len = list[itemList].length;     var type = len/5;     var height = type * 126;     %> <ul class=\"gift-center-list\" id=\"gift-center-list-<%=itemList%>\" style=\"height:<%=height%>px\">     <% for (var i in list[itemList]) {          var item = list[itemList][i];         var type = '';         var timeLimit = 0;         switch (Number(item['activity_type'])) {             case 1 : {                 type = 'time';                 break;             }             case 2 : {                 type = 'num';                 break;             }             case 3 : {                 type = 'sale';                 break;             }             case 4 : {                 type = 'member';                 break;             }             case 5 : {                 type = 'free';                 break;             }         }         if (type == 'time') {             if (item['is_time_limit'] != 0) {                 type = 'time-limit';                 timeLimit = item['is_time_limit'];             }         }         if (item['large_thumbnail_url']) {             var category_id = item['category_id']['category_id'] || item['category_id'];             var tdouNum = 0;             if (item['activity_type'] == 3) {                 tdouNum = item['discount'];             } else {                 tdouNum = item['price'];             }     %>     <li class=\"gift-center-list-item\">         <a href=\"javascript:;\" class=\"gift-center-list-item-link\" id=\"gift-center-list-item-<%=item['gift_id']%>\" data-gift={\"gift_id\":\"<%=item['gift_id']%>\",\"category_id\":\"<%=category_id%>\",\"tdou\":\"<%=tdouNum%>\",\"active\":\"<%=item['activity_type']%>\",\"timeLimit\":\"<%=timeLimit%>\"}>             <img class=\"gift-center-list-item-link-img\" alt=\"<%=item['gift_desc']%>\" src=\"<%=item['large_thumbnail_url']%>\">             <p class=\"gift-center-list-item-link-name\"><%=item['gift_name']%></p>             <div class=\"gift-center-list-item-link-detail\">                 <p class=\"text-overflow\">\u5BF9\u65B9\u83B7\u5F97<%=item['gift_name']%></p>                 <p class=\"text-overflow\">                     <i class=\"icon-tbean\"></i>                     <% if (item['activity_type'] == 3) {%>                     <span class=\"del\"><%=item['price']%></span><span><%=item['discount']%></span>                     <% } else { %>                     <span><%=item['price']%></span>                     <% } %>                 </p>             </div>             <i class=\"icon-select\"></i>             <i class=\"icon-type <%=type%>\"></i>         </a>     </li>     <%} else {%>     <li class=\"gift-center-list-item empty\"></li>     <% } %>     <% } %> </ul> <% } %>")({list:this.giftMap});this.$pageList.html(t),this.setAnimation(),this.page=0},rendPoint:function(){var t=this.giftMap.length;this.total=t-1;var i=this.pointTpl(t);this.$container.find(".gift-center-box-point").html(i),this.$pageList.css({width:631*t})},updateCursor:function(){var t=this.giftMap.length;1==t?this.$pageCursor.remove():this.$pageCursor.eq(0).hide()},updateView:function(){var t=this.page;this.$container.find(".btn-point.active").removeClass("active"),this.$container.find(".btn-point").eq(t).addClass("active"),0==this.page?(this.$pageCursor.eq(0).hide(),this.$pageCursor.eq(1).show()):this.page==this.total?(this.$pageCursor.eq(1).hide(),this.$pageCursor.eq(0).show()):this.$pageCursor.show()},moveToPage:function(){var t=this.page;this.$pageList.animate({"margin-left":631*t*-1})},pagerCtrl:function(t){var i=this;switch(t){case"left":if(0==i.page)return;i.page--,i.updateView(),i.moveToPage();break;case"right":if(i.page==i.total)return;i.page++,i.updateView(),i.moveToPage();break;default:var e=Number(t);if(e>=0){if(e==i.page)return;i.page=e,i.updateView(),i.moveToPage()}}},setAnimation:function(){var t=this.$container.find(".gift-center-list-item"),i=100;$.each(t,function(t,e){i+=50,setTimeout(function(){$(e).addClass("show")},i)})},addEvents:function(){var t=this;t.$container.on("click",".j-gift-page",function(i){var e=$(i.currentTarget),a=e.data("page");t.pagerCtrl(a)})}}});_.Module.define({path:"tbmall/widget/gift_loading_css",sub:{initial:function(){},getTpl:function(){return _.template('<div class="gift-loading">     <div class="object object_one"></div>     <div class="object object_two"></div>     <div class="object object_three"></div>     <div class="object object_four"></div> </div>')()}}});_.Module.define({path:"tbmall/widget/send_gift_dialog",requires:["tbmall/widget/gift_page_ctrl","user/widget/userApi","common/widget/TchargeDialog","common/widget/tdou/tdouViewPay","common/widget/baseUserData","tbmall/widget/gift_loading_css"],sub:{URL:{getGiftTab:"/present/show/getGiftList",getGiftForTab:"/present/show/getGiftListByCategoryId",getFreeGift:"/present/show/getUserFreeChance",sendGift:"/present/pay/placeOrder"},dialogHeight:560,giftMap:{},initial:function(t){return this.toUser=t.userId,this.toUserName=t.userName,this.scene_from=t.scene_from,this.threadId=t.threadId||null,this.postId=t.postId||null,this.fromUser=window.PageData.user.id,this.canSendToSelf=t.canSendToSelf,this.onFail=t.onFail||function(){},this.onSucess=t.onSucess||function(){},this.getUserTdou(),this.$loadingTpl=this.requireInstance("tbmall/widget/gift_loading_css").getTpl(),this.userLevel=this.requireInstance("user/widget/userApi").checkSuperMemberShipOf(PageData.user),this.fromUser?t.toUser!=this.fromUser||this.canSendToSelf?(this.initDialog(),void 0):(this.onFail({no:1,msg:"\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u9001\u793C\u7269\u54E6~"}),void 0):(this.onFail({no:210009,msg:"\u8BF7\u767B\u5F55~"}),void 0)},getUserTdou:function(t){this.baseUserData||(this.baseUserData=this.requireInstance("common/widget/baseUserData")),this.baseUserData.getTdou(function(i){this.userTdou=i.data.Parr_scores.scores_total,t&&t()},this)},getDialogTpl:function(){var t=this,i=_.template('<div class="gift-center-dialog-container">     <div class="gift-center-title">         <h4>\u9001\u7ED9<%=name%></h4>         <a href="javascript:;" class="dialogJclose j-gift-center-title-close"></a>     </div>     <div class="gift-center-box">         <div class="gift-center-box-tab">         </div>         <div class="gift-center-box-list">             <div class="gift-loading"><span></span></div>         </div>     </div> </div> <div class="gift-center-dialog-cashier">     <div class="gift-tr gift-center-dialog-cashier-num">         <p>\u9009\u62E9\u6570\u91CF\uFF1A</p>         <div class="gift-cashier-num-item">             <a href="javascript:;" class="j-gift-num" data-num="1">1</a>             <a href="javascript:;" class="j-gift-num" data-num="99">99</a>             <a href="javascript:;" class="j-gift-num" data-num="520">520</a>             <a href="javascript:;" class="j-gift-num" data-num="999">999</a>             <a href="javascript:;" class="j-gift-num" data-num="1314">1314</a>             <a href="javascript:;" class="j-gift-num gift-num-input" data-num="0">                 <input type="text" class="j-gift-num-input" maxlength="4" placeholder="\u81EA\u5B9A\u4E49" />             </a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-price">         <p>\u6240\u9700T\u8C46\uFF1A</p>         <div class="gift-center-price">             <i class="icon-tbean"></i>             <span class="gift-center-price-tbean j-gift-price">0</span>             <span class="gift-center-price-detail">\uFF08\u5BF9\u65B9\u83B7\u5F97<i class="icon_tbean"></i><span>0</span>\uFF09</span>             <a href="/f?ie=utf-8&kw=\u84DD\u94BB&fr=gift" target="_blank" class="gift-center-price-tips">\u84DD\u94BB\u7528\u9014</a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-btn">         <a href="javascript:;" class="btn-gift-send disabled">\u8D60\u9001</a>         <span class="error-tips"></span>         <span class="txt-tips"></span>     </div> </div> <div class="gift-center-dialog-alert">     <div class="mask"></div>     <div class="loading">         <span></span>         <p>\u5151\u6362\u793C\u7269\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </div>     <div class="alert update-tdou">         <p>\u8D2D\u4E70T\u8C46\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u3002</p>         <a href="javascript:;" class="j-update-tdou">\u5237\u65B0</a>         <a href="javascript:;" class="j-close-alert">\u5173\u95ED</a>     </div>     <div class="alert toast toast-error">         <i></i>         <span>\u8D60\u9001\u5931\u8D25\uFF01</span>     </div>     <div class="alert toast toast-suc">         <i></i>         <span>\u8D60\u9001\u6210\u529F\uFF01</span>     </div> </div>')({name:t.toUserName});return i},initDialog:function(){var t=this,i=t.getDialogTpl(),e={modal:!0,fixed:!0,width:690,height:t.dialogHeight,hideOnclose:!1,holderClassName:"gift-center-dialog",draggable:!1,html:i,closeable:!1,showTitle:!1};t._gift_dialog=new $.dialog(e),t.$_gift_dialog=t._gift_dialog.element,t.$inputCtrl=t.$_gift_dialog.find(".j-gift-num-input"),t.$numCtrl=t.$_gift_dialog.find(".j-gift-num"),t.$btnCtrl=t.$_gift_dialog.find(".btn-gift-send"),t.$tdouView=t.$_gift_dialog.find(".j-gift-price"),t.$blueView=t.$_gift_dialog.find(".gift-center-price-detail span"),t.$blueIcon=t.$_gift_dialog.find(".gift-center-price-detail i"),t.$errorTips=t.$_gift_dialog.find(".error-tips"),t.$txtTips=t.$_gift_dialog.find(".txt-tips"),t.$alertCenter=t.$_gift_dialog.find(".gift-center-dialog-alert"),t.$blueTips=t.$_gift_dialog.find(".gift-center-price-tips"),t.showDialog(function(){t.getGiftList(function(){t.setDefaultGift()})}),t.bindEvent()},setDefaultGift:function(){var t=this;setTimeout(function(){t.$_gift_dialog.find(".gift-center-box-list .gift-center-list-item-link").eq(0).click(),t.$_gift_dialog.find(".j-gift-num").eq(0).click()},1e3)},showDialog:function(t){var i=this;i.top||(i.top=Number(i.$_gift_dialog.css("top").replace("px",""))),i.$_gift_dialog.css({height:0,top:(i.top+i.dialogHeight)/2}).animate({height:i.dialogHeight,top:i.top,display:"block"},function(){i.$_gift_list||(i.$_gift_list=i.$_gift_dialog.find(".gift-center-dialog-container")),t&&t()})},closeDialog:function(t){var i=this;i.$_gift_dialog.animate({height:0,top:(i.top+i.dialogHeight)/2,display:"none"},function(){t&&t()})},getGiftList:function(t){var i=this;$.ajax({url:i.URL.getGiftTab,data:{scene_from:i.scene_from},type:"GET",dataType:"json",success:function(e){0==e.no?(i.rendGiftTpl(e.data),i.addFreeUrl=e.data.addfree_url,i.currency=e.data.currency,t&&t()):i.errorTips()},error:function(){i.errorTips()}})},errorTips:function(t){var i=this;switch(t){case"member":i.$txtTips.html('\u53EA\u6709\u4F1A\u5458\u624D\u53EF\u4EE5\u8D2D\u4E70<a href="javascript:;" class="j-get-member">\u8D2D\u4E70\u4F1A\u5458</a>');break;case"timeLimit":1==i.timeLimit?i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u8FD8\u672A\u4E0A\u67B6"):2==i.timeLimit&&i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u5DF2\u4E0B\u67B6");break;case"tdou":i.$txtTips.html('\u60A8\u7684T\u8C46\u4E0D\u8DB3<a href="javascript:;" class="j-get-tdou">\u83B7\u53D6T\u8C46</a>');break;case"timeIn":var e=i.curGift.end_time,a=Math.round((new Date).getTime()/1e3),s=e-a,r=Math.floor(s/86400),n=Math.floor(s%86400/3600),d=Math.floor(s%86400%3600/60);i.$txtTips.html("\u9650\u65F6\u9500\u552E\uFF1A\u8FD8\u6709"+r+"\u5929"+n+"\u5C0F\u65F6"+d+"\u5206\u949F\u7ED3\u675F");break;case"free":$.ajax({url:i.URL.getFreeGift,data:{scene_from:i.scene_from},type:"GET",success:function(t){0==t.no?(i.limitNum=t.data.free_chance,i.freeCtrl(),i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+t.data.free_chance+'</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')):i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')},error:function(){i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')}});break;case"num":var o=i.curGift.gift_count;i.$txtTips.html('\u8BE5\u793C\u7269\u9650\u91CF<i class="num">'+o+"</i>\u4E2A")}},rendGiftTpl:function(t){var i=t.list,e=t.list[0].category_id,a=t.gift_list;this.rendTab(i),this.setTab(e),this.giftListRend(e,a)},setTab:function(t){this.$tabList.removeClass("current"),$("#gift-center-tab-"+t).addClass("current")},giftListRend:function(t,i){this.setData(t,i),this.requireInstance("tbmall/widget/gift_page_ctrl",{giftList:i,$container:$(".gift-center-box-list")})},setData:function(t,i){this.categoryId=t,this.giftMap[t]||(this.giftMap[t]={}),this.giftMap[t]=this.formateList(i)},formateList:function(t){var i={};return $.each(t,function(t,e){i[e.gift_id]=e}),i},rendTab:function(t){var i=this,e=_.template('<ul class="gift-center-tab-list">     <% var len = list.length;         var width = (630 - len) / len;         for (var i in list) {         var item = list[i];     %>     <li class="gift-center-tab-item-tr"></li>     <li class="gift-center-tab-item" style="width:<%=width%>px">         <a href="javascript:;" id ="gift-center-tab-<%=item.category_id%>" data-tab={"id":"<%=item.category_id%>"}>             <%=item.category_name%>         </a>     </li>     <%}%> </ul>')({list:t});i.$_gift_dialog.find(".gift-center-box-tab").html(e),i.$tabList=i.$_gift_dialog.find(".gift-center-box-tab").find(".gift-center-tab-item a")},selectGift:function(){var t=this;t.updateGift()},updateGift:function(){$(".gift-center-list-item-link").removeClass("select"),$("#gift-center-list-item-"+this.curGiftId).addClass("select")},setLoading:function(){this.$_gift_dialog.find(".gift-center-box-list").html(this.$loadingTpl)},changeTab:function(t){var i=this;i.setLoading(),i.giftMap&&i.giftMap[t]?(i.setTab(t),i.giftListRend(t,i.giftMap[t])):$.ajax({url:i.URL.getGiftForTab,data:{category_id:t},type:"GET",dataType:"json",success:function(e){if(0==e.no){var a=e.data.gift_list||{};i.setTab(t),i.giftListRend(t,a),i.giftMap[t]=i.formateList(a)}else i.errorTips()},error:function(){i.errorTips()}})},inputCtrl:function(t){var i=parseInt(t,10)||0;0==i?this.$inputCtrl.val(""):t!=i&&this.$inputCtrl.val(i),this.orderNum=i,this.updateBtn()},updateBtn:function(){return this.$txtTips.html(""),this.$errorTips.html(""),this.curGiftId&&this.curCategoryId?this.orderNum?(this.checkOrder()?this.$btnCtrl.removeClass("disabled"):this.$btnCtrl.addClass("disabled"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0)},setNum:function(t){this.$tdouView.html(t);var i=this.curGift,e=Math.floor((t-(i.tbkey_price||0))*(100-i.proportion)/100);this.$blueView.html(e),0==this.currency?(this.$blueIcon.removeClass().addClass("icon_tbean"),this.$blueTips.hide()):(this.$blueIcon.removeClass().addClass("icon-blue"),this.$blueTips.show())},checkOrder:function(){var t=Number(this.curTdouNum)*Number(this.orderNum);return this.setNum(t),4!=this.activeId||this.userLevel?1!=this.activeId||this.timeLimitCtrl()?t>this.userTdou?(this.tdouNotEnough(),!1):(2==this.activeId&&this.numLimitCtrl(),3==this.activeId&&this.saleCtrl(),5==this.activeId&&this.errorTips("free"),!0):!1:(this.notMember(),!1)},freeCtrl:function(){var t=this.limitNum,i=this.orderNum;i>t&&this.$btnCtrl.addClass("disabled")},notMember:function(){this.errorTips("member")},timeLimitCtrl:function(){return 0!=this.timeLimit?(this.errorTips("timeLimit"),!1):(this.errorTips("timeIn"),!0)},numLimitCtrl:function(){var t=this.curGift,i=t.gift_count;return this.errorTips("num"),i<this.orderNum?!1:!0},saleCtrl:function(){var t=this.curGift.price*Number(this.orderNum),i=Number(this.curTdouNum)*Number(this.orderNum);return this.$txtTips.html('\u6298\u6263\u4FC3\u9500\uFF1A\u539F\u4EF7<i class="del">'+t+'</i>T\u8C46\uFF0C\u73B0\u4EF7<i class="num">'+i+"</i>T\u8C46"),!0},tdouNotEnough:function(){this.errorTips("tdou")},sendGifterror:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-error").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-error").hide()},1e3)},sendGiftSuc:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-suc").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-suc").hide()},1e3)},getOrder:function(){var t=this;t.$btnCtrl.addClass("disabled"),t.$alertCenter.show().find(".loading").show(),$.ajax({url:t.URL.sendGift,data:{scene_from:t.scene_from,gift_id:t.curGiftId,num:t.orderNum,benefit_userid:t.toUser,benefit_username:t.toUserName,thread_id:t.threadId,post_id:t.postId},type:"POST",dataType:"json",success:function(i){if(0==i.no)if(5==t.activeId)t.sendGiftSuc(),t.limitNum=i.data.free_chance,t.freeCtrl(),t.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+i.data.free_chance+'</i>\u4E2A<a href="'+t.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>'),t.$btnCtrl.removeClass("disabled");else{var e=i.data;$.extend(e,{chargeType:"platform",notShowSucTips:!0});var a=t.requireInstance("common/widget/tdou/tdouViewPay",function(e){if("encourage_dialog_closed"==e.command?t.$alertCenter.hide().find(".loading").hide():"encourage_paid"==e.command?0==e.data.no?t.sendGiftSuc():t.sendGifterror():t.sendGifterror(),2==t.activeId){var a=i.data.gift_count;t.curGift.gift_count=a,t.numLimitCtrl()?t.$btnCtrl.removeClass("disabled"):t.$btnCtrl.addClass("disabled")}else t.$btnCtrl.removeClass("disabled")});a.createMain(e)}else t.$btnCtrl.removeClass("disabled"),t.sendGifterror()},error:function(){t.$btnCtrl.removeClass("disabled"),t.sendGifterror()}})},updateTdou:function(){var t=this.orderNum*this.curTdouNum-this.userTdou,i={consumption_path:"send-gift",fr:"send-gift",current_need_tdou:t,is_direct_cashier:!0};this.requireInstance("common/widget/TchargeDialog",i),setTimeout(function(){this.$alertCenter.show().find(".update-tdou").show()},1e3)},bindEvent:function(){var t=this;t.$_gift_dialog.on("click",".j-gift-center-title-close",function(){t.closeDialog(function(){t._gift_dialog.close()})}).on("click",".gift-center-list-item-link",function(i){var e=$(i.currentTarget),a=e.data("gift");t.curGiftId=a.gift_id,t.curCategoryId=a.category_id,t.curTdouNum=a.tdou,t.activeId=a.active,t.timeLimit=a.timeLimit,t.curGift=t.giftMap[t.curCategoryId][t.curGiftId],t.selectGift(),t.updateBtn()}).on("click",".gift-center-tab-item a",function(i){var e=$(i.currentTarget),a=e.data("tab"),s=a.id;t.changeTab(s),t.curCategoryId=null,t.curGiftId=null,t.curTdouNum=null,t.activeId=null,t.timeLimit=null,t.updateBtn()}).on("input",".j-gift-num-input",function(i){var e=$(i.currentTarget),a=e.val();t.inputCtrl(a)}).on("click",".j-gift-num",function(i){var e=$(i.currentTarget);t.$numCtrl.removeClass("select"),e.addClass("select");var a=Number(e.data("num"))||0;t.orderNum=a,0==a?(t.$inputCtrl.focus(),t.inputCtrl(t.$inputCtrl.val())):(t.$inputCtrl.val(""),t.updateBtn())}).on("click",".btn-gift-send",function(i){var e=$(i.target);e.hasClass("disabled")||t.getOrder()}).on("click",".j-get-tdou",function(){t.updateTdou()}).on("click",".j-close-alert",function(){t.$alertCenter.hide().find(".alert").hide()}).on("click",".j-update-tdou",function(){t.getUserTdou(function(){t.checkOrder(),t.$alertCenter.hide().find(".alert").hide()})})}}});_.Module.define({path:"tbmall/widget/show_my_gift_list",requires:["tbmall/widget/send_gift_dialog","tbmall/widget/gift_loading_css"],sub:{URL:{getUserGiftList:"/present/home/myGiftList",getMyGiftList:"/present/home/sendGiftList"},$emptyTpl:'<p class="tips">\u8FD8\u6CA1\u6709\u793C\u7269\u54E6~</p>',$errorTpl:'<p class="tips">\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u540E\u518D\u8BD5~</p>',emptyObject:{},giftData:{},initial:function(t){this.$loadingTpl=this.requireInstance("tbmall/widget/gift_loading_css").getTpl(),this.homeUserId=t.homeUserId,this.callBack=t.callBack,this.isUserHome=t.homeUserId==window.PageData.user.id||t.userId==window.PageData.user.user_id?!0:!1,this.initDialog(),this.addEvents()},getDialogTpl:function(){var t=this.getDialogTitle(!0),i='<div class="gift-list-dialog-container-box"></div>',e='<div class="gift-list-dialog-container-pager"></div>';return'<div class="gift-list-dialog-container">'+t+i+e+"</div>"},getDialogTitle:function(t){return _.template('<div class="gift-list-dialog-container-title">     <% if(isUserHome) { %>      <a href="javascript:;" class="j-my-list receive title" data-type="receive">\u6211\u6536\u5230\u7684\u793C\u7269</a>     <a href="javascript:;" class="j-my-list send" data-type="send">\u6211\u9001\u51FA\u7684\u793C\u7269</a>      <% } else { %>     <a href="javascript:;" class="title">TA\u6536\u5230\u7684\u793C\u7269</a>     <% } %> </div> <a href="javascript:;" class="dialogJclose j-gift-list-dialog-close"></a>')({isUserHome:this.isUserHome,isMyReceiveList:t})},initDialog:function(){var t=this,i=t.getDialogTpl(),e={modal:!0,fixed:!0,width:670,height:530,hideOnclose:!1,holderClassName:"gift-list-dialog",draggable:!1,html:i,closeable:!1,showTitle:!1};t._gift_dialog=new $.dialog(e),t.$_gift_dialog=t._gift_dialog.element,t.$pager=t.$_gift_dialog.find(".gift-list-dialog-container-pager"),t.showDialog(function(){t.initList("receive")})},showDialog:function(t){var i=this;i.top||(i.top=Number(i.$_gift_dialog.css("top").replace("px",""))),i.$_gift_dialog.css({height:0,top:(i.top+550)/2}).animate({height:550,top:i.top,display:"block"},function(){i.$_gift_list||(i.$_gift_list=i.$_gift_dialog.find(".gift-list-dialog-container-box")),t&&t()})},closeDialog:function(t){var i=this;i.$_gift_dialog.animate({height:0,top:(i.top+550)/2,display:"none"},function(){t&&t()})},setLoading:function(){this.$_gift_list.html(this.$loadingTpl)},getGiftListPager:function(t){var i=this,e=t.page;i.pager=i.requireInstance("common/component/JsPager",{container:i.$pager,current:e.pn,amount:6,total:e.total_pn})},getGiftList:function(t,i,e){var a,s=this,l="receive"===t?s.URL.getUserGiftList:s.URL.getMyGiftList;s.giftData[t]&&s.giftData[t][i]&&!s.shouldReload?(a=s.giftData[t][i],e&&e(a),s.rendList(t,a.gift_list)):$.ajax({url:l,data:{user_id:s.homeUserId,pn:i||0,ps:10},type:"GET",dataType:"json",success:function(a){if(0==a.no){if(s.shouldReload=!1,$.isEmptyObject(a.data.gift_list))return s.errorTips("empty"),void 0;e&&e(a.data),s.rendList(t,a.data.gift_list),s.setData(t,i,a.data)}else s.errorTips("error")},error:function(){s.errorTips("error")}})},setData:function(t,i,e){$.isEmptyObject(this.giftData[t])&&(this.giftData[t]={}),this.giftData[t][i]=e},errorTips:function(t){var i="empty"===t?this.$emptyTpl:this.$errorTpl;this.$_gift_list.html(i)},rendList:function(t,i){var e=this,a=_.template('<ul class="gift-list">     <% for (var i in list) {          var item = list[i];         if (item[\'large_thumbnail_url\']) {     %>     <li class="gift-list-item">         <div class="gift-list-item-gift">             <img class="gift-list-item-img" src="<%=item[\'large_thumbnail_url\']%>"/>             <div class="gift-list-item-info">                 <p class="gift-list-item-info-detail">                     <span class="text-overflow gift-name" title="<%=item[\'gift_name\']%>"><%=item[\'gift_name_formate\']%></span>                     <span class="num" title="<%=item[\'num\']%>">x <%=item[\'num\']%></span></p>                 <% if (type === \'receive\') { %>                 <p class="gift-list-item-info-sender">                     <a href="/home/main?id=<%=item[\'pay_portrait\']%>" class="text-overflow receive-name" title="<%=item[\'pay_username\']%>"><%=item[\'pay_username\']%></a>                     <span class="txt">\u8D60\u9001</span></p>                 <% } else { %>                 <p class="gift-list-item-info-sender">                     <span class="txt send">\u9001\u7ED9</span>                     <a href="/home/main?id=<%=item[\'benefit_portrait\']%>" class="text-overflow sender-name" title="<%=item[\'benefit_username\']%>"><%=item[\'benefit_username\']%></a>                 </p>                 <% } %>             </div>             <span class="gift-list-item-date"><%=item[\'formate_date\']%></span>             <% if (isUserHome && type === \'receive\') { %>             <a class="gift-list-item-send j-send-gift" href="javascript:;" data-gift={"id":"<%=item[\'pay_userid\']%>","name":"<%=item[\'pay_username\']%>"}>\u56DE\u8D60</a>             <% } %>         </div>     </li>     <% } else { %>     <li class="gift-list-item gift-list-item-empty">     </li>     <% } %>     <% } %> </ul>')({list:e.formatData(i),isUserHome:e.isUserHome,type:t});e.$_gift_list.html(a),e.setAnimation()},initList:function(t){var i=this;i.setLoading(),i.getGiftList(t,0,function(e){i.getGiftListPager(e),i.pager.bind("pageChange",function(e,a){i.pager.initial({current:a}),i.setLoading(),i.getGiftList(t,a-1)})})},setAnimation:function(){var t=this.$_gift_list.find(".gift-list-item .gift-list-item-gift"),i=100;$.each(t,function(t,e){i+=50,setTimeout(function(){$(e).addClass("show")},i)})},formatData:function(t){var i=t.length;return $.each(t,function(t,i){if(i.create_time){var e=new Date(1e3*Number(i.create_time));i.formate_date=e.toISOString().split("T")[0]}if(i.gift_name){var a=i.gift_name;a=a.length>6?a.slice(0,5)+"...":a,i.gift_name_formate=a}}),i%2===1&&t.push(this.emptyObject),t},changeTab:function(t){var i=this;i.closeDialog(function(){i.$pager.html(""),i.$_gift_list.html(""),i.showDialog(),i.initList(t);var e="send"===t?".receive":".send";$("."+t).addClass("title"),$(e).removeClass("title")})},addEvents:function(){var t=this;t.$_gift_dialog.on("click",".j-gift-list-dialog-close",function(){t.closeDialog(function(){t.$_gift_dialog.remove(),t._gift_dialog.close(),t.callBack&&t.callBack({msg:"close"})})}).on("click",".j-my-list",function(i){var e=$(i.target),a=e.data("type");e.hasClass("title")||t.changeTab(a)}).on("click",".j-send-gift",function(i){var e=$(i.target),a=e.data("gift");t.requireInstance("tbmall/widget/send_gift_dialog",{userId:a.id,userName:a.name,scene_from:"pc_home",onSuccess:function(){t.shouldReload=!0},onFail:function(){$.tb.location.reload()}})})}}});_.Module.define({path:"ihome/widget/gift",requires:["tbmall/widget/show_my_gift_list","tbmall/widget/send_gift_dialog"],sub:{URL:{getUserGiftList:"/present/home/myGiftList"},dialogPs:9,initial:function(i){this.opts=i,this.isUserHome=i.userId==window.PageData.user.id||i.userId==window.PageData.user.user_id?!0:!1,this.$container=$(i.$container),this.getGiftList(),this.bindEvents()},getGiftList:function(){var i=this,t={user_id:i.opts.userId,pn:0,ps:i.dialogPs,type:1};$.get(i.URL.getUserGiftList,t,function(t){if(t&&0==t.no){var e=t.data.gift_list;i.hideLoadingTips(),$.isEmptyObject(e)||0==e.length?(i.isUserHome&&i.$container.find(".mygift-more").show(),i.otherNoGift()):i.renderGiftList(e);var s=$("[j-gift-item-detail-orange]"),a=s.find("span em").html(),n=0;a>999&&(n=a/1e3,n=parseFloat(n).toFixed(3),s.find("span em").html(n.substring(0,n.lastIndexOf(".")+2)+"k"))}})},hideLoadingTips:function(){this.$container.find(".ihome-aside-gift-center-tips").remove(),this.$container.find(".ihome-aside-gift-center-container").show()},formateData:function(i){var t=this,e=[];$.each(i,function(i,t){e.push(t)});var s=e.length;return t.isUserHome?s>9?e.length=9:s%3!==0&&(e=this.fullData(e)):s>4&&(e.length=4),e},fullData:function(i){var t={num:0},e=i.length%3;switch(e){case 1:i.push(t),i.push(t);break;case 2:i.push(t)}return i},renderGiftList:function(i){var t=this;i=t.formateData(i);var e=_.template('<% for (var i in list) {      var item = list[i];      if (item.num == 0 ) {  %>  <li class="gift-item">      <span class="gift-item-img"></span>      <p class="gift-item-info"></p>  </li>  <%} else {%>  <li class="gift-item">      <a href="javascript:;" class="gift-item-link j-gift-item" title="<%=item.pay_username%>\u8D60\u9001\u7684<%=item.gift_name%>">          <div class="gift-item-txt">              <img src="<%=item.large_thumbnail_url %>" class="gift-item-img">              <p class="gift-item-info">x                  <span class="gift-item-info-num"><%=item.num %></span>              </p>          </div>          <div class="gift-item-detail">              <p class="gift-item-detail-txt"><span class="name"><%=name%></span>\u8D60\u9001</p>              <p class="gift-item-detail-orange" j-gift-item-detail-orange><span class="gift-item-detail-orange-name"><%=item.gift_name%></span><span>x<em><%=item.num%></em></span></p>          </div>      </a>  </li>  <% }   }%>')({list:i}),s=_.template('<% for (var i in list) {      var item = list[i];      if (item.num == 0 ) {  %>  <li class="offsate-gift-item">      <span class="offsate-gift-item-img"></span>      <p class="offsate-gift-item-info"></p>  </li>  <%} else {%>  <li class="offsate-gift-item">      <a href="javascript:;" class="offsate-gift-item-link j-gift-item" title="<%=item.pay_username%>\u8D60\u9001\u7684<%=item.gift_name%>">          <img src="http://tb.himg.baidu.com/sys/portrait/item/<%=item.pay_portrait %>" alt="\u5934\u50CF" class="offsate-gift-item-username"/>          <p class="offsate-gift-item-txt"><span class="name" title=\'<%=item.pay_username%>\'><%=item.pay_username%></span>\u8D60\u9001</p>          <img src="<%=item.large_thumbnail_url %>" class="offsate-gift-item-img">          <p class="offsate-gift-item-info">x              <span class="offsate-gift-item-info-num"><%=item.num %></span>          </p>      </a>  </li>  <% }   }%>')({list:i});t.isUserHome?t.$container.find(".ihome-aside-gift-center-container-list").show().append(e):t.dialogPs=4,t.$container.find(".ihome-aside-gift-center-container-offstatelist").show().append(s),t.$container.find(".ihome-aside-gift-center-container-no-gift").hide(),t.$container.find(".mygift-more").show()},otherNoGift:function(){this.$container.find(".btn-send-gift").html("\u9001TA\u7B2C\u4E00\u4EFD\u793C\u7269")},bindEvents:function(){var i=this;i.$container.on("click","[j-gift-more]",function(t){var e=$(t.target).data("userId");i.requireInstanceAsync("tbmall/widget/show_my_gift_list",{homeUserId:e})}).on("click",".j-send-gift",function(t){var e=$(t.target),s=e.data("gift");i.requireInstance("tbmall/widget/send_gift_dialog",{userId:s.id,userName:s.name,scene_from:"pc_home",account:"",onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})})}}});_.Module.define({path:"ihome/widget/my_grab_treasure",sub:{URL:{treasureInfo:"/diamondmall/center/user/treasureInfo"},initial:function(){this.$root=$(".ihome-aside-grab-treasure"),this.getUserTreasure(),this.bindEvent()},bindEvent:function(){this.$root.on("click","[data-locate]",function(){var t=$(this).data("locate");$.stats.track(t,"\u8D34\u5427\u593A\u5B9D")})},getUserTreasure:function(){var t=this,a=t.$root.find(".home-aside-grab-treasure-info");$.ajax({url:t.URL.treasureInfo,data:{tbs:window.PageData.tbs}}).done(function(t){var e=t.data&&t.data.total_num||0;0===t.no&&(0===e?a.html("\u6682\u65F6\u6CA1\u6709\u53C2\u4E0E\u593A\u5B9D"):a.html("\u5DF2\u53C2\u4E0E\u4E86"+e+"\u6B21\u593A\u5B9D"))})}}});_.Module.define({path:"ihome/widget/visitor",requires:[],sub:{initial:function(){this._cardWrap=$("#visitor_card_wrap"),this._delCardBtn=this._cardWrap.find(".j_del_card_btn"),this.bindEvent()},bindEvent:function(){var t=this;this._delCardBtn.click(function(i){var a=i.target;return t.delVisitHistory($(a)),!1}),this._cardWrap.find(".icon_tbworld").on("click",function(){t._postTrack()})},delVisitHistory:function(t){var i=this;$.dialog.ask("\u662F\u5426\u5220\u9664\u672C\u6B21\u8BBF\u95EE\u8BB0\u5F55\uFF1F",["\u662F","\u5426"],function(a){if(0===a){var n=t.parent(".visitor_card"),r=n.getData().un;$.ajax({type:"post",url:"/home/post/delvisite",data:{ie:"utf-8",un:r,tbs:PageData.tbs},dataType:"json"}).success(function(t){0===t.no&&n.animate({width:0},200,function(){n.remove(),i.checkEmpty()})})}},{title:"\u6E29\u99A8\u63D0\u793A"})},checkEmpty:function(){var t=$("#visitor_card_wrap").find(".visitor_card").length;0===t&&this._cardWrap.closest(".ihome_visitor").slideUp(200)},_postTrack:function(){$.stats.track("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u6700\u8FD1\u6765\u8BBF\u7684\u7687\u51A0\u70B9\u51FB"})}}});_.Module.define({path:"ihome/widget/concern",requires:[],sub:{initial:function(){this.$concernArea=$("#concern_wrap_concern"),this.$fansArea=$("#concern_wrap_fans"),this._bindEvents()},_bindEvents:function(){var n=this;this.$concernArea.find(".icon_tbworld").on("click",function(){n._postTrack("TA\u5173\u6CE8\u7684\u4EBA\u7684\u7687\u51A0\u70B9\u51FB")}),this.$fansArea.find(".icon_tbworld").on("click",function(){n._postTrack("\u5173\u6CE8TA\u7684\u4EBA\u7684\u7687\u51A0\u70B9\u51FB")})},_postTrack:function(n){$.stats.track("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:n})}}});_.Module.define({path:"ihome/widget/my_forbid_speech",sub:{initial:function(){}}});_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog","tbmall/widget/send_gift_dialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(a,i){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=a,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),i||this.bindEvents())},bindEvents:function(){var a=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return a.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card&&a._visit_card.closeCard({type:"delayClose",time:200}),a._visit_card=null,!1}),this._wrap.on("click","[j-user-visit-card-marriage-propose]",function(){var i=$(this);a.marryDialog={},a.marryDialog.hide=a.marryDialog.show=function(){};var t=i.tbattr("data-username");a.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:t},function(i){a.marryDialog=i})}),this._wrap.on("click","[j-user-visit-card-send-gift]",function(i){var t=$(i.target),e=t.data("userid"),r=t.data("username");a.requireInstance("tbmall/widget/send_gift_dialog",{userId:e,userName:r,scene_from:"pc_home",account:"",onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(a){var i=this;i._visit_card&&(i._visit_card.closeCard(),i._visit_card=null);var t='<div class="user_card_loading"><img src="http://tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:a,attr:"id='user_visit_card'",wrap:$("body")};i._visit_card=i.use("common/widget/Card",e),i._visit_card.showCard({type:"delayShow",time:200}),i.buildVisitCard(a)},getVisitCardContent:function(a){var i=this,t={ie:"utf-8"};a.un?t.un=a.un:t.id=a.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=a.bg_id;var r=i._util.getVisitCardTpl(1,e,!0);a.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a.wrap.html(r)}a.callBack&&$.isFunction(a.callBack)&&a.callBack()})},buildVisitCard:function(a){var i=this,t={ie:"utf-8"};a.getData().un?t.un=a.getData().un:t.id=a.getData().id,i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==i.dataObj.uname,s=i._util.getVisitCardTpl(r,e,!0);i._visit_card.setContent(s),i._visit_card._j_card.bindData({un:e.name}),i._visit_card.showCard(),i._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),i._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),i._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(a){a.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return i.buildCard(a),!1})}})},bindVisitCardEvent:function(){var a=this;a._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,r){var i=PageData.product||"",t=this.use("user/widget/Icons"),n=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:"0"==a.can_followed?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:r?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:i,icon_pre:t.getPreIconHtml(a.mParr_props,a),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon_tbvip:t.getTbvipIconHtml(a.tb_vip),icon:t.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="";a.tb_vip&&a.tb_vip.type&&(l='<span class="userinfo_split"></span><span>\u7C89\u4E1D:'+a.followed_count+"</span>");var m="",d="",f="";!a.marriage||1!=a.marriage.status&&3!=a.marriage.status&&4!=a.marriage.status?a.marriage&&0!=a.marriage.length&&2!=a.marriage.status||(f='<a class="btn-attention btn-small  user-visit-card-marriage-propose" data-username="'+a.name+'" data-userid="'+a.id+'" j-user-visit-card-send-gift><i></i>\u7ED9\u4ED6\u9001\u793C</a>'):(c.marriage_date=$.dateFormat(new Date(1e3*a.marriage.time),"yyyy-MM-dd"),c.marriage_user_name=a.marriage.user_name,m=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_lover">\u7231\u4EBA:#{marriage_user_name}</span>',"</div>"].join(""),d=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_date">\u7ED3\u5A5A\u7EAA\u5FF5\u65E5: #{marriage_date}</span>',"</div>"].join(""));var u="";e||(u='<div class="interaction_wrap interaction_wrap_theme2">'+f+'<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">#{concernText}</a><a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a></div>');var v=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',u,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>','<a href="javascript:" class="marriage" j-user-visit-card-marriage-propose target="_blank"><i></i>\u5411\u4ED6\u6C42\u5A5A</a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon_tbvip}',"</div>",m,'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>",l,"</div>",d,'<div class="card_userinfo_tbvip clearfix">',"#{icon}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(v,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var r=e.can_begcard,i="";0==r?i='<a class="btn_begcard j_begcard" href="#"></a>':1==r?i='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==r&&(i='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:i};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},r=e.manager,i=null,t="",n="";this.countLen=0;for(var s in r){i=r[s];var o=i.forum_list.join("\u3001"),_=a[s];o=i.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,t+=this.getHonorItem(_.level,i.count,o),this.countLen+=String(i.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){i=c[l[d]];var o=i.forum_list.join("\u3001");i.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[d],i.count,o),this.countLen+=String(i.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,r){var i={level:e,title:r,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,i)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},r=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),i=0;i<e.length;i++)a.verify_forums+=this.getVForumItem(i,e[i].forum_name);return $.tb.format(r,a)},getVForumItem:function(e,a){var r="",i={},t=[];return a.length>5?(r=a.substring(0,5),r+="..."):r=a,i={index:e,verify_forum_name:r,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="http://tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,i)},getVipTips:function(e){var a="",r=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>r&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});